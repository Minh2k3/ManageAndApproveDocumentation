import{b as n,O as q,_ as B,c as O,a as c,r as u,d as i,x as j,I as z,g as f,B as A,i as H,G as x,H as M,D as I,o as v,N as C,q as R}from"./index-HU749lUt.js";import{M as E}from"./MailOutlined-BnwLs6Bd.js";var F={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"};function S(s){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},t=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(t=t.concat(Object.getOwnPropertySymbols(a).filter(function(o){return Object.getOwnPropertyDescriptor(a,o).enumerable}))),t.forEach(function(o){D(s,o,a[o])})}return s}function D(s,e,a){return e in s?Object.defineProperty(s,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):s[e]=a,s}var V=function(e,a){var t=S({},e,a.attrs);return n(q,S({},t,{icon:F}),null)};V.displayName="ArrowLeftOutlined";V.inheritAttrs=!1;var U={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"lock",theme:"outlined"};function T(s){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},t=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(t=t.concat(Object.getOwnPropertySymbols(a).filter(function(o){return Object.getOwnPropertyDescriptor(a,o).enumerable}))),t.forEach(function(o){Y(s,o,a[o])})}return s}function Y(s,e,a){return e in s?Object.defineProperty(s,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):s[e]=a,s}var N=function(e,a){var t=T({},e,a.attrs);return n(q,T({},t,{icon:U}),null)};N.displayName="LockOutlined";N.inheritAttrs=!1;const G={name:"ResetPassword",components:{MailOutlined:E,LockOutlined:N,ArrowLeftOutlined:V},setup(){const s=I(),e=f(!1),a=f(!0),t=f(!1),o=f(""),b=f(""),d=f(""),m=f(""),p=A({password:"",password_confirmation:""}),k={password:[{required:!0,message:"Vui lòng nhập mật khẩu mới!"},{min:8,message:"Mật khẩu phải có ít nhất 8 ký tự!"}],password_confirmation:[{required:!0,message:"Vui lòng xác nhận mật khẩu!"},{validator:(r,l)=>!l||p.password===l?Promise.resolve():Promise.reject(new Error("Mật khẩu xác nhận không khớp!"))}]},P=()=>{const r=new URLSearchParams(window.location.search);d.value=r.get("email")||"",m.value=r.get("token")||""},L=async()=>{if(!m.value||!d.value){t.value=!0,a.value=!1;return}await x.get("/sanctum/csrf-cookie");try{(await x.post("/verify-reset-token",{token:m.value,email:d.value})).data.valid?(t.value=!1,a.value=!1):(t.value=!0,a.value=!1)}catch(r){console.error("Token verification failed:",r),t.value=!0,a.value=!1}console.log("token invalid: "+t.value),console.log("token verifying: "+a.value)},g=async r=>{var l,h;e.value=!0,b.value="",o.value="";try{const y=await x.post("/api/reset-password",{token:m.value,email:d.value,password:r.password,password_confirmation:r.password_confirmation});o.value=y.data.message||"Mật khẩu đã được cập nhật thành công!",M.success("Đặt lại mật khẩu thành công!"),p.password="",p.password_confirmation="",setTimeout(()=>{_()},2e3)}catch(y){console.error("Reset password error:",y),b.value=((h=(l=y.response)==null?void 0:l.data)==null?void 0:h.message)||"Có lỗi xảy ra, vui lòng thử lại!",M.error("Cập nhật mật khẩu thất bại!")}finally{e.value=!1}},_=()=>{s.push("/login")},w=async()=>{var r,l;try{const h=await x.post("/api/forgot-password",{email:d.value});M.success(h.data.message||"Yêu cầu quên mật khẩu đã được gửi thành công. Vui lòng kiểm tra email của bạn."),modalForgotPassword.value=!1}catch(h){M.error(((l=(r=h.response)==null?void 0:r.data)==null?void 0:l.message)||"Có lỗi xảy ra khi gửi yêu cầu quên mật khẩu. Vui lòng thử lại sau.")}};return H(()=>{P(),L()}),{form:p,rules:k,loading:e,verifyingToken:a,tokenInvalid:t,successMessage:o,errorMessage:b,email:d,handleSubmit:g,goToLogin:_,handleRequestNewForgotPassword:w}}},Q={class:"container-fluid vh-100 d-flex align-items-center justify-content-center",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}},X={class:"row w-100"},J={class:"col-md-8 col-lg-6 mx-auto"},W={class:"card shadow-lg border-0",style:{"border-radius":"15px"}},Z={class:"card-body p-5"},K={key:0,class:"text-center py-5"},$={key:1,class:"text-center py-4"},ee={key:2},te={class:"text-center"};function ae(s,e,a,t,o,b){const d=u("a-spin"),m=u("a-button"),p=u("a-result"),k=u("a-alert"),P=u("MailOutlined"),L=u("a-input"),g=u("a-form-item"),_=u("LockOutlined"),w=u("a-input-password"),r=u("a-form");return v(),O("div",Q,[c("div",X,[c("div",J,[c("div",W,[c("div",Z,[e[7]||(e[7]=c("div",{class:"text-center mb-4"},[c("h2",{class:"fw-bold text-primary mb-2"},"Đặt lại mật khẩu"),c("p",{class:"text-muted"},"Nhập mật khẩu mới cho tài khoản của bạn")],-1)),t.verifyingToken?(v(),O("div",K,[n(d,{size:"large"}),e[4]||(e[4]=c("p",{class:"mt-3 text-muted"},"Đang xác thực token...",-1))])):t.tokenInvalid?(v(),O("div",$,[n(p,{status:"error",title:"Token không hợp lệ","sub-title":"Token đã hết hạn hoặc không tồn tại. Vui lòng yêu cầu link mới."},{extra:i(()=>[n(m,{type:"primary",onClick:t.handleRequestNewForgotPassword},{default:i(()=>e[5]||(e[5]=[C(" Yêu cầu link mới ")])),_:1},8,["onClick"])]),_:1})])):(v(),O("div",ee,[t.successMessage?(v(),j(k,{key:0,message:t.successMessage,type:"success","show-icon":"",closable:"",class:"mb-3",onClose:e[0]||(e[0]=l=>t.successMessage="")},null,8,["message"])):z("",!0),t.errorMessage?(v(),j(k,{key:1,message:t.errorMessage,type:"error","show-icon":"",closable:"",class:"mb-3",onClose:e[1]||(e[1]=l=>t.errorMessage="")},null,8,["message"])):z("",!0),n(r,{model:t.form,rules:t.rules,onFinish:t.handleSubmit,layout:"vertical"},{default:i(()=>[n(g,{label:"Email",class:"mb-3"},{default:i(()=>[n(L,{value:t.email,size:"large",readonly:"",disabled:""},{prefix:i(()=>[n(P,{class:"text-muted"})]),_:1},8,["value"])]),_:1}),n(g,{label:"Mật khẩu mới",name:"password",class:"mb-3"},{default:i(()=>[n(w,{value:t.form.password,"onUpdate:value":e[2]||(e[2]=l=>t.form.password=l),size:"large",placeholder:"Nhập mật khẩu mới (tối thiểu 8 ký tự)",disabled:t.loading},{prefix:i(()=>[n(_,{class:"text-muted"})]),_:1},8,["value","disabled"])]),_:1}),n(g,{label:"Xác nhận mật khẩu",name:"password_confirmation",class:"mb-4"},{default:i(()=>[n(w,{value:t.form.password_confirmation,"onUpdate:value":e[3]||(e[3]=l=>t.form.password_confirmation=l),size:"large",placeholder:"Nhập lại mật khẩu mới",disabled:t.loading},{prefix:i(()=>[n(_,{class:"text-muted"})]),_:1},8,["value","disabled"])]),_:1}),n(g,{class:"mb-3"},{default:i(()=>[n(m,{type:"primary","html-type":"submit",size:"large",block:"",loading:t.loading,class:"fw-bold"},{default:i(()=>[C(R(t.loading?"Đang cập nhật...":"Cập nhật mật khẩu"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules","onFinish"]),c("div",te,[n(m,{type:"link",onClick:t.goToLogin,disabled:t.loading},{default:i(()=>e[6]||(e[6]=[c("span",null,[c("i",{class:"bi bi-arrow-left me-1"}),C("Quay lại đăng nhập ")],-1)])),_:1},8,["onClick","disabled"])])]))])])])])])}const oe=B(G,[["render",ae],["__scopeId","data-v-b189ff31"]]);export{oe as default};
