import{_ as O,e as N,c as k,b as u,d as n,r as f,F as S,y as V,g as _,i as E,M as T,G as U,H as $,D as G,o as a,a as s,I as r,x as m,q as p,J as y}from"./index-u6IXU-LR.js";import{u as K}from"./use-menu-CupLMQve.js";import{u as F}from"./certificate-store-DT_9dkam.js";const Q=N({setup(){K().onSelectedKeys(["admin-users"]);const e=V(),t=F();G();let v=_([]);const D=[{title:"Họ tên",dataIndex:"name",key:"name",width:200,sorter:(l,i)=>{const o=l.name.split(" ").slice(-1).join(" "),b=i.name.split(" ").slice(-1).join(" ");return o.localeCompare(b)},sortDirections:["ascend","descend"],customHeaderCell:()=>({style:{textAlign:"center"}})},{title:"Email",dataIndex:"email",key:"email",width:200,customHeaderCell:()=>({style:{textAlign:"center"}})},{title:"Chức vụ",dataIndex:"roll",key:"roll",responsive:["xl"],width:250,align:"center"},{title:"Trạng thái",dataIndex:"status",key:"status",width:150,sorter:(l,i)=>{const o={active:1,banned:2,pending:3,inactive:4};return o[l.status]-o[i.status]},sortDirections:["ascend","descend"],align:"center"},{title:"Thao tác",key:"action",fixed:"right",width:100,customHeaderCell:()=>({style:{textAlign:"center"}})}];E(async()=>{await e.fetchUsers(),v.value=e.users});const g=_(!1),h=_(null);return{users:v,columns:D,showModalDetail:g,currentUser:h,viewDetail:l=>{g.value=!0,h.value=l},showConfirm:(l,i)=>{T.confirm({title:`Bạn có chắc chắn muốn ${i==="ban"?"cấm":"kích hoạt tài khoản cho"} ${l.name}?`,async onOk(){i==="ban"?(await U.post("/api/users/banned",{id:l.id}),$.success(`Đã cấm ${l.name}!`)):(await U.post("/api/users/active",{id:l.id}),await t.issueCertificate(l.id),$.success(`Đã kích hoạt ${l.name}!`));const o=v.value.findIndex(b=>b.id===l.id);o!==-1&&(v.value[o].status=i==="ban"?"banned":"active")},onCancel(){}})},showConfirmUnban:l=>{T.confirm({title:`Bạn có chắc chắn muốn bỏ cấm cho ${l.name}?`,async onOk(){await U.post("/api/users/unban",{id:l.id});const i=v.value.findIndex(o=>o.id===l.id);i!==-1&&(v.value[i].status="active"),$.success("Bỏ cám thành công!")},onCancel(){}})}}}}),q={class:"row mb-3"},x={class:"col-12 align-items-center justify-content-end d-flex"},z={class:"row mb-3"},J={class:"col-12"},R={class:"row g-2"},X={class:"col-12 col-md-4 align-items-center"},L={class:"col-12 col-md-8"},P={class:"row g-2"},W={class:"col-6 col-md-4"},Y={class:"col-6 col-md-4"},Z={class:"col-6 col-md-3"},tt={class:"col-6 col-md-1 d-flex align-items-center justify-content-end"},st={class:"row"},et={class:"col-12"},nt={key:0},lt={class:""},ot=["href"],at={key:0},it={class:"row mb-3"},dt={class:"col-12 col-md-6"},rt={class:"col-12 col-md-6"},ut={class:"row mb-3"},ct={class:"col-12 col-md-6"},mt={class:"col-12 col-md-6"},pt={class:"row mb-3"},ft={class:"col-12 col-md-6"},vt={class:"col-12 col-md-6"},wt={class:"row mb-3"},bt={class:"col-12"},kt={class:"row mb-3"},yt={class:"col-12"};function gt(e,t,v,D,g,h){const B=f("router-link"),w=f("a-button"),I=f("a-input-search"),l=f("a-select"),i=f("a-tooltip"),o=f("a-tag"),b=f("a-space"),H=f("a-table"),M=f("a-card"),j=f("a-modal");return a(),k(S,null,[u(M,{title:"",style:{width:"100%"},class:"rounded-0 mt-1"},{default:n(()=>[t[20]||(t[20]=s("h2",{class:""},"Quản lý người dùng",-1)),t[21]||(t[21]=s("span",{class:"text-secondary fst-italic"},"Quản lý thông tin tài khoản người dùng",-1)),s("div",q,[s("div",x,[u(w,{type:"primary"},{default:n(()=>[u(B,{to:{name:"admin-users-create"},class:"text-white"},{default:n(()=>t[5]||(t[5]=[s("i",{class:"fa-solid fa-plus"},null,-1)])),_:1})]),_:1})])]),s("div",z,[s("div",J,[s("div",R,[s("div",X,[u(I,{placeholder:"Tìm kiếm","allow-clear":"","enter-button":"",class:"w-100"})]),s("div",L,[s("div",P,[s("div",W,[u(l,{value:e.status_id,"onUpdate:value":t[0]||(t[0]=c=>e.status_id=c),"show-search":"",placeholder:"Tất cả trạng thái",options:e.users_status,"filter-option":e.filterOption,"allow-clear":"",class:"w-100"},null,8,["value","options","filter-option"])]),s("div",Y,[u(l,{value:e.role_id,"onUpdate:value":t[1]||(t[1]=c=>e.role_id=c),"show-search":"",placeholder:"Tất cả vai trò",options:e.users_role,"filter-option":e.filterOption,"allow-clear":"",class:"w-100"},null,8,["value","options","filter-option"])]),s("div",Z,[u(l,{value:e.department_id,"onUpdate:value":t[2]||(t[2]=c=>e.department_id=c),"show-search":"",placeholder:"Tất cả đơn vị",options:e.users_department,"filter-option":e.filterOption,"allow-clear":"",class:"w-100"},null,8,["value","options","filter-option"])]),s("div",tt,[u(w,{type:"primary",class:""},{default:n(()=>t[6]||(t[6]=[s("i",{class:"fa-solid fa-filter"},null,-1)])),_:1})])])])])])]),s("div",st,[s("div",et,[u(H,{dataSource:e.users,columns:e.columns,scroll:{x:576}},{bodyCell:n(({column:c,index:A,record:d})=>[c.key==="index"?(a(),k("span",nt,p(A+1),1)):r("",!0),c.key==="name"?(a(),m(i,{key:1},{title:n(()=>[s("span",lt,p(d.roll),1)]),default:n(()=>[s("span",null,p(d.name),1)]),_:2},1024)):r("",!0),c.key==="email"?(a(),m(i,{key:2},{title:n(()=>t[7]||(t[7]=[s("span",null,"Click để gửi mail",-1)])),default:n(()=>[s("a",{href:`mailto:${d.email}?subject=Gửi tới ${d.name}&body=Chào ${d.name},%0D%0A%0D%0A`,class:"text-decoration-none fst-italic"},p(d.email),9,ot)]),_:2},1024)):r("",!0),c.key==="status"?(a(),k(S,{key:3},[d.status==="active"?(a(),m(o,{key:0,color:"green"},{default:n(()=>t[8]||(t[8]=[s("span",null,"Hoạt động",-1)])),_:1})):r("",!0),d.status==="inactive"?(a(),m(o,{key:1,color:"gray"},{default:n(()=>t[9]||(t[9]=[s("span",null,"Chưa kích hoạt mail",-1)])),_:1})):r("",!0),d.status==="pending"?(a(),m(o,{key:2,color:"orange"},{default:n(()=>t[10]||(t[10]=[s("span",null,"Chờ duyệt",-1)])),_:1})):r("",!0),d.status==="banned"?(a(),m(o,{key:3,color:"red"},{default:n(()=>t[11]||(t[11]=[s("span",null,"Bị cấm",-1)])),_:1})):r("",!0)],64)):r("",!0),c.key==="action"?(a(),m(b,{key:4,class:"d-flex justify-content-center gap-3"},{default:n(()=>[u(i,null,{title:n(()=>t[12]||(t[12]=[s("span",{class:""},"Xem chi tiết",-1)])),default:n(()=>[u(w,{onClick:C=>e.viewDetail(d),class:"bg-primary text-white"},{default:n(()=>t[13]||(t[13]=[s("i",{class:"bi bi-eye"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024),d.status==="pending"?(a(),m(i,{key:0},{title:n(()=>t[14]||(t[14]=[s("span",{class:""},"Kích hoạt tài khoản",-1)])),default:n(()=>[u(w,{onClick:C=>e.showConfirm(d,"activate"),class:"bg-success text-white"},{default:n(()=>t[15]||(t[15]=[s("i",{class:"bi bi-check"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024)):r("",!0),d.status==="active"?(a(),m(i,{key:1},{title:n(()=>t[16]||(t[16]=[s("span",{class:""},"Khóa tài khoản",-1)])),default:n(()=>[u(w,{onClick:C=>e.showConfirm(d,"ban"),class:"bg-danger text-white"},{default:n(()=>t[17]||(t[17]=[s("i",{class:"bi bi-ban"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024)):r("",!0),d.status==="banned"?(a(),m(i,{key:2},{title:n(()=>t[18]||(t[18]=[s("span",{class:""},"Gỡ khóa tài khoản",-1)])),default:n(()=>[u(w,{onClick:C=>e.showConfirmUnban(d),class:"bg-danger-subtle border-danger text-white"},{default:n(()=>t[19]||(t[19]=[s("i",{class:"bi bi-ban"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024)):r("",!0)]),_:2},1024)):r("",!0)]),_:1},8,["dataSource","columns"])])])]),_:1}),u(j,{visible:e.showModalDetail,"onUpdate:visible":t[3]||(t[3]=c=>e.showModalDetail=c),title:"Thông tin chi tiết người dùng",width:"80%",footer:null,onCancel:t[4]||(t[4]=c=>e.showModalDetail=!1),zIndex:1e4},{default:n(()=>[e.currentUser?(a(),k("div",at,[s("div",it,[s("div",dt,[t[22]||(t[22]=s("span",{class:"fw-bold"},"Họ tên:",-1)),s("span",null,p(e.currentUser.name),1)]),s("div",rt,[t[23]||(t[23]=s("span",{class:"fw-bold"},"Email:",-1)),s("span",null,p(e.currentUser.email),1)])]),s("div",ut,[s("div",ct,[t[24]||(t[24]=s("span",{class:"fw-bold"},"Vai trò:",-1)),s("span",null,p(e.currentUser.roll),1)]),s("div",mt,[t[29]||(t[29]=s("span",{class:"fw-bold"},"Trạng thái:",-1)),s("span",null,[e.currentUser.status==="active"?(a(),m(o,{key:0,color:"green"},{default:n(()=>t[25]||(t[25]=[y("Hoạt động")])),_:1})):r("",!0),e.currentUser.status==="inactive"?(a(),m(o,{key:1,color:"gray"},{default:n(()=>t[26]||(t[26]=[y("Chưa kích hoạt mail")])),_:1})):r("",!0),e.currentUser.status==="pending"?(a(),m(o,{key:2,color:"orange"},{default:n(()=>t[27]||(t[27]=[y("Chờ duyệt")])),_:1})):r("",!0),e.currentUser.status==="banned"?(a(),m(o,{key:3,color:"red"},{default:n(()=>t[28]||(t[28]=[y("Bị cấm")])),_:1})):r("",!0)])])]),s("div",pt,[s("div",ft,[t[30]||(t[30]=s("span",{class:"fw-bold"},"Đơn vị:",-1)),s("span",null,p(e.currentUser.department),1)]),s("div",vt,[t[31]||(t[31]=s("span",{class:"fw-bold"},"Số điện thoại:",-1)),s("span",null,p(e.currentUser.phone),1)])]),s("div",wt,[s("div",bt,[t[32]||(t[32]=s("span",{class:"fw-bold"},"Địa chỉ:",-1)),s("span",null,p(e.currentUser.address),1)])]),s("div",kt,[s("div",yt,[t[33]||(t[33]=s("span",{class:"fw-bold"},"Ngày đăng ký:",-1)),s("span",null,p(e.currentUser.created_at),1)])])])):r("",!0)]),_:1},8,["visible"])],64)}const Ut=O(Q,[["render",gt]]);export{Ut as default};
