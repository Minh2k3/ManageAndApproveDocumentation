import{_ as I,g as d,i as W,k as O,j as S,c as m,I as M,a as o,q as b,N as p,H as D,o as x}from"./index-WEoVCage.js";const q={name:"PDFViewer",props:{pdfUrl:{type:String,required:!0},initialPage:{type:Number,default:1},initialScale:{type:Number,default:1.2}},setup(i,{emit:e}){const P=d(null),t=d(null),u=d(!0),w=d(null),n=d(i.initialPage),g=d(0),a=d(i.initialScale);let s=null,f=!1,k=null,v=null;const T=async()=>{try{if(window.pdfjsLib){v=window.pdfjsLib;return}const r=document.createElement("script");r.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js",r.async=!0,await new Promise((l,c)=>{r.onload=()=>{v=window.pdfjsLib,v.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js",l()},r.onerror=c,document.head.appendChild(r)})}catch(r){throw console.error("Error loading PDF.js:",r),new Error("Không thể tải thư viện PDF")}},y=r=>{s&&(f=!0,s.getPage(r).then(l=>{const c=l.getViewport({scale:a.value}),j=P.value,E=j.getContext("2d");j.height=c.height,j.width=c.width;const R={canvasContext:E,viewport:c};l.render(R).promise.then(()=>{f=!1,k!==null&&(y(k),k=null),e("pageRendered",{page:r,scale:a.value})}).catch(V=>{console.error("Error rendering page:",V),f=!1})}).catch(l=>{console.error("Error getting page:",l),f=!1}),e("pageChange",r))},h=r=>{f?k=r:y(r)},L=()=>{n.value<=1||(n.value--,h(n.value))},N=()=>{n.value>=g.value||(n.value++,h(n.value))},U=()=>{a.value>=3||(a.value=Math.min(a.value+.25,3),h(n.value))},z=()=>{a.value<=.5||(a.value=Math.max(a.value-.25,.5),h(n.value))},F=()=>{const r=t.value;if(!r||!s)return;const l=r.clientWidth-40;a.value=Math.min(l/600,2),h(n.value)},B=()=>{},_=()=>{C()},C=async()=>{try{u.value=!0,w.value=null,v||await T();const l=`http://localhost:8000/api/pdf-proxy?file=${encodeURIComponent(i.pdfUrl)}`;console.log("Loading PDF via proxy:",l),console.log("Original PDF URL:",i.pdfUrl),s=await v.getDocument({url:l,httpHeaders:{Accept:"application/pdf"},withCredentials:!1}).promise,g.value=s.numPages,n.value=Math.min(n.value,g.value),y(n.value),u.value=!1,D.success(`Đã tải thành công tài liệu ${g.value} trang`)}catch(r){console.error("Error loading PDF:",r),w.value=`Không thể tải file PDF: ${r.message||"Lỗi không xác định"}`,u.value=!1,D.error("Không thể tải file PDF")}};return W(()=>{i.pdfUrl&&C()}),O(()=>i.pdfUrl,r=>{r&&(n.value=1,C())}),S(()=>{s&&s.destroy()}),{pdfCanvas:P,pdfContainer:t,loading:u,error:w,pageNum:n,totalPages:g,scale:a,previousPage:L,nextPage:N,zoomIn:U,zoomOut:z,fitToWidth:F,downloadPdf:B,retryLoad:_}}},H={class:"pdf-viewer-container"},K={key:0,class:"loading-spinner"},A={key:1,class:"error-message"},G={key:2,class:"pdf-controls"},J=["disabled"],Q={class:"page-info"},X=["disabled"],Y={class:"zoom-controls"},Z=["disabled"],$={class:"zoom-info"},oo=["disabled"],eo={class:"additional-controls"},to={class:"pdf-canvas-container",ref:"pdfContainer"},no={ref:"pdfCanvas"};function ro(i,e,P,t,u,w){return x(),m("div",H,[t.loading?(x(),m("div",K,e[7]||(e[7]=[o("div",{class:"spinner"},null,-1),o("p",null,"Đang tải PDF...",-1)]))):M("",!0),t.error?(x(),m("div",A,[o("p",null,b(t.error),1),o("button",{onClick:e[0]||(e[0]=(...n)=>t.retryLoad&&t.retryLoad(...n)),class:"retry-btn"},e[8]||(e[8]=[o("i",{class:"anticon anticon-reload"},null,-1),p(" Thử lại ")]))])):M("",!0),!t.loading&&!t.error?(x(),m("div",G,[o("button",{onClick:e[1]||(e[1]=(...n)=>t.previousPage&&t.previousPage(...n)),disabled:t.pageNum<=1,class:"nav-btn"},e[9]||(e[9]=[o("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[o("path",{d:"M15 18l-6-6 6-6","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),p(" Trang trước ")]),8,J),o("span",Q," Trang "+b(t.pageNum)+" / "+b(t.totalPages),1),o("button",{onClick:e[2]||(e[2]=(...n)=>t.nextPage&&t.nextPage(...n)),disabled:t.pageNum>=t.totalPages,class:"nav-btn"},e[10]||(e[10]=[p(" Trang sau "),o("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[o("path",{d:"M9 18l6-6-6-6","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]),8,X),o("div",Y,[o("button",{onClick:e[3]||(e[3]=(...n)=>t.zoomOut&&t.zoomOut(...n)),disabled:t.scale<=.5,class:"zoom-btn"},e[11]||(e[11]=[o("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[o("circle",{cx:"11",cy:"11",r:"8","stroke-width":"2"}),o("path",{d:"M21 21l-4.35-4.35M8 11h6","stroke-width":"2","stroke-linecap":"round"})],-1)]),8,Z),o("span",$,b(Math.round(t.scale*100))+"%",1),o("button",{onClick:e[4]||(e[4]=(...n)=>t.zoomIn&&t.zoomIn(...n)),disabled:t.scale>=3,class:"zoom-btn"},e[12]||(e[12]=[o("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[o("circle",{cx:"11",cy:"11",r:"8","stroke-width":"2"}),o("path",{d:"M21 21l-4.35-4.35M11 8v6M8 11h6","stroke-width":"2","stroke-linecap":"round"})],-1)]),8,oo)]),o("div",eo,[o("button",{onClick:e[5]||(e[5]=(...n)=>t.fitToWidth&&t.fitToWidth(...n)),class:"control-btn"},e[13]||(e[13]=[o("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[o("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2","stroke-width":"2"}),o("line",{x1:"9",y1:"9",x2:"15",y2:"15","stroke-width":"2"})],-1),p(" Vừa khung ")])),o("button",{onClick:e[6]||(e[6]=(...n)=>t.downloadPdf&&t.downloadPdf(...n)),class:"control-btn"},e[14]||(e[14]=[o("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[o("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4","stroke-width":"2"}),o("polyline",{points:"7,10 12,15 17,10","stroke-width":"2"}),o("line",{x1:"12",y1:"15",x2:"12",y2:"3","stroke-width":"2"})],-1),p(" Tải xuống ")]))])])):M("",!0),o("div",to,[o("canvas",no,null,512)],512)])}const io=I(q,[["render",ro],["__scopeId","data-v-613c1e5d"]]);export{io as P};
