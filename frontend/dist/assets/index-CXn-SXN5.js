import{u as R}from"./use-menu-Ch1M1A0s.js";import{_ as U,e as O,c as m,b as p,d as a,r as g,F as A,R as F,A as M,y as P,g as f,i as E,C as H,D as K,o as r,a as t,I as d,x as c,q as i,N as k}from"./index-CoRCteip.js";import{u as q}from"./department-store-DfyYNekg.js";const z=O({components:{EyeOutlined:F},setup(){R().onSelectedKeys(["admin-documents"]);const s=K(),e=M(),I=P(),N=q(),T=f([]),B=f([]),b=f([]),w=f([]),v=[{label:"Bản nháp",value:"draft"},{label:"Chờ duyệt",value:"in_review"},{label:"Đã duyệt",value:"approved"},{label:"Bị từ chối",value:"rejected"}];E(async()=>{await e.fetchAll(),b.value=e.documents,w.value=e.document_types,console.log(b.value),console.log(w.value),T.value=I.users,await N.fetchDepartments(),B.value=N.departments.filter(l=>l.group!=="Khác")});const h=f(!1),_=f({}),S=l=>{_.value=l,h.value=!0,console.log(_.value.id)},L=[{title:"Tên văn bản",key:"title",dataIndex:"title",width:200,sorter:(l,o)=>l.title.localeCompare(o.title),sortDirections:["ascend","descend"],customHeaderCell:()=>({style:{textAlign:"center"}})},{title:"Loại văn bản",key:"type",dataIndex:"type",width:150,sorter:(l,o)=>l.type.localeCompare(o.type),sortDirections:["ascend","descend"],customHeaderCell:()=>({style:{textAlign:"center"}})},{title:"Người đề xuất",key:"creator_name",dataIndex:"creator_name",width:200,sorter:(l,o)=>l.creator_name.localeCompare(o.creator_name),sortDirections:["ascend","descend"],align:"center"},{title:"Trạng thái",key:"status",dataIndex:"status",width:120,sorter:(l,o)=>{const y={draft:1,in_review:2,approved:3,rejected:4};return y[l.status]-y[o.status]},sortDirections:["ascend","descend"],align:"center"},{title:"Ngày tạo",key:"created_at",dataIndex:"created_at",width:150,sorter:(l,o)=>{const y=l.created_at.split(" ")[1].split("/").reverse().join("-")+" "+l.created_at.split(" ")[0],j=o.created_at.split(" ")[1].split("/").reverse().join("-")+" "+o.created_at.split(" ")[0];return y.localeCompare(j)},sortDirections:["ascend","descend"],align:"center"},{title:"Lần duyệt cuối",key:"updated_at",dataIndex:"updated_at",width:150,sorter:(l,o)=>{const y=l.updated_at.split(" ")[1].split("/").reverse().join("-")+" "+l.updated_at.split(" ")[0],j=o.updated_at.split(" ")[1].split("/").reverse().join("-")+" "+o.updated_at.split(" ")[0];return y.localeCompare(j)},sortDirections:["ascend","descend"],align:"center"}],V=l=>({onClick:()=>{S(l)},style:{cursor:"pointer"}}),D=f(""),n=f(void 0),C=f(void 0),u=f(void 0),$=H(()=>{let l=[...b.value];if(D.value){const o=D.value.toLowerCase();l=l.filter(y=>y.title.toLowerCase().includes(o)||y.type.toLowerCase().includes(o)||y.creator_name.toLowerCase().includes(o))}return n.value&&(l=l.filter(o=>o.status===n.value)),C.value&&(l=l.filter(o=>o.type_id===C.value)),u.value&&(l=l.filter(o=>o.department_id===u.value)),l});return{users:T,documents:b,document_types:w,document_status:v,departments:B,columns:L,detailVisible:h,selectedDocument:_,search:D,status_filter:n,type_filter:C,department_filter:u,filterData:$,customRow:V,viewDetail:S,goToDetailPage:l=>{s.push({name:"admin-documents-detail",params:{id:l}})}}}}),Q={class:"row mb-3"},X={class:"col-12"},G={class:"row g-2"},J={class:"col-12 col-lg-4"},W={class:"col-12 col-lg-8"},Y={class:"row g-2"},Z={class:"col-6 col-lg-4"},x={class:"col-6 col-lg-4"},ee={class:"col-6 col-lg-4"},te={class:"row"},se={class:"col-12"},ne={key:0},le={class:""},oe={key:2},ae={key:4},re={key:0},ie={key:1},de={key:2},ue={key:3},pe=["href"];function ce(s,e,I,N,T,B){const b=g("a-input"),w=g("a-select"),v=g("a-tooltip"),h=g("a-tag"),_=g("a-button"),S=g("a-table"),L=g("a-card"),V=g("a-divider"),D=g("a-modal");return r(),m(A,null,[p(L,{title:"",style:{width:"100%"}},{default:a(()=>[e[13]||(e[13]=t("h2",{class:"fw-bold mb-3"},"Quản Lý Văn Bản",-1)),t("div",Q,[t("div",X,[t("div",G,[t("div",J,[p(b,{placeholder:"Tìm kiếm",value:s.search,"onUpdate:value":e[0]||(e[0]=n=>s.search=n),"allow-clear":"","enter-button":"",class:"w-100"},null,8,["value"])]),t("div",W,[t("div",Y,[t("div",Z,[p(w,{value:s.status_filter,"onUpdate:value":e[1]||(e[1]=n=>s.status_filter=n),"show-search":"",placeholder:"Trạng thái",options:s.document_status,"filter-option":s.filterOption,"allow-clear":"",class:"w-100",onChange:s.handleStatusFilter},null,8,["value","options","filter-option","onChange"])]),t("div",x,[p(w,{value:s.type_filter,"onUpdate:value":e[2]||(e[2]=n=>s.type_filter=n),"show-search":"",placeholder:"Loại văn bản",options:s.document_types,"filter-option":s.filterOption,"allow-clear":"",class:"w-100"},null,8,["value","options","filter-option"])]),t("div",ee,[p(w,{value:s.department_filter,"onUpdate:value":e[3]||(e[3]=n=>s.department_filter=n),"show-search":"",placeholder:"Đơn vị đề xuất",options:s.departments,"filter-option":s.filterOption,"allow-clear":"",class:"w-100"},null,8,["value","options","filter-option"])])])])])])]),t("div",te,[t("div",se,[p(S,{"data-source":s.filterData,columns:s.columns,scroll:{x:576},bordered:"",customRow:s.customRow,showSorterTooltip:!1,locale:{triggerDesc:"Nhấn để sắp xếp giảm dần",triggerAsc:"Nhấn để sắp xếp tăng dần",cancelSort:"Nhấn để hủy sắp xếp"}},{headerCell:a(({column:n})=>[n.key==="title"?(r(),c(v,{key:0,title:"Sắp xếp theo tên văn bản"},{default:a(()=>[t("span",null,i(n.title),1)]),_:2},1024)):n.key==="type"?(r(),c(v,{key:1,title:"Sắp xếp theo loại văn bản"},{default:a(()=>[t("span",null,i(n.title),1)]),_:2},1024)):n.key==="creator_name"?(r(),c(v,{key:2,title:"Sắp xếp theo người đề xuất"},{default:a(()=>[t("span",null,i(n.title),1)]),_:2},1024)):n.key==="status"?(r(),c(v,{key:3,title:"Sắp xếp theo trạng thái"},{default:a(()=>[t("span",null,i(n.title),1)]),_:2},1024)):n.key==="created_at"?(r(),c(v,{key:4,title:"Sắp xếp theo ngày tạo"},{default:a(()=>[t("span",null,i(n.title),1)]),_:2},1024)):n.key==="updated_at"?(r(),c(v,{key:5,title:"Sắp xếp theo lần duyệt cuối"},{default:a(()=>[t("span",null,i(n.title),1)]),_:2},1024)):d("",!0)]),bodyCell:a(({column:n,index:C,record:u})=>[n.key==="index"?(r(),m("span",ne,i(C+1),1)):d("",!0),n.key==="creator_name"?(r(),c(v,{key:1},{title:a(()=>[t("span",le,i(u.roll),1)]),default:a(()=>[t("span",null,i(u.creator_name),1)]),_:2},1024)):d("",!0),n.key==="type"?(r(),m("span",oe,i(u.type),1)):d("",!0),n.key==="status"?(r(),m(A,{key:3},[u.status==="approved"?(r(),c(h,{key:0,color:"green"},{default:a(()=>e[7]||(e[7]=[t("span",null,"Đã duyệt",-1)])),_:1})):d("",!0),u.status==="draft"?(r(),c(h,{key:1,color:"blue"},{default:a(()=>e[8]||(e[8]=[t("span",null,"Bản nháp",-1)])),_:1})):d("",!0),u.status==="in_review"?(r(),c(h,{key:2,color:"orange"},{default:a(()=>e[9]||(e[9]=[t("span",null,"Chờ duyệt",-1)])),_:1})):d("",!0),u.status==="rejected"?(r(),c(h,{key:3,color:"red"},{default:a(()=>e[10]||(e[10]=[t("span",null,"Bị từ chối",-1)])),_:1})):d("",!0)],64)):d("",!0),n.key==="created_at"?(r(),m("span",ae,i(u.created_at),1)):d("",!0),n.key==="action"?(r(),m(A,{key:5},[p(_,{class:"btn border"},{default:a(()=>e[11]||(e[11]=[t("i",{class:"bi bi-eye"},null,-1)])),_:1}),p(_,{class:"btn border"},{default:a(()=>e[12]||(e[12]=[t("i",{class:"bi bi-eye"},null,-1)])),_:1})],64)):d("",!0)]),_:1},8,["data-source","columns","customRow"])])])]),_:1}),p(D,{open:s.detailVisible,"onUpdate:open":e[6]||(e[6]=n=>s.detailVisible=n),title:"Chi tiết văn bản",width:"600px","z-index":"10000"},{footer:a(()=>[p(_,{onClick:e[4]||(e[4]=n=>s.detailVisible=!1)},{default:a(()=>e[23]||(e[23]=[k("Đóng")])),_:1}),p(_,{type:"primary",onClick:e[5]||(e[5]=n=>s.goToDetailPage(s.selectedDocument.id))},{default:a(()=>e[24]||(e[24]=[k("Chi tiết")])),_:1})]),default:a(()=>[t("div",null,[e[22]||(e[22]=t("h5",null,"📄 Thông tin văn bản",-1)),t("p",null,[e[14]||(e[14]=t("strong",null,"Tiêu đề:",-1)),k(" "+i(s.selectedDocument.title),1)]),t("p",null,[e[15]||(e[15]=t("strong",null,"Mô tả:",-1)),k(" "+i(s.selectedDocument.description),1)]),t("p",null,[e[16]||(e[16]=t("strong",null,"Loại văn bản:",-1)),k(" "+i(s.selectedDocument.type),1)]),t("p",null,[e[17]||(e[17]=t("strong",null,"Người đề xuất:",-1)),k(" "+i(s.selectedDocument.creator_name),1)]),t("p",null,[e[18]||(e[18]=t("strong",null,"Trạng thái:",-1)),s.selectedDocument.status=="draft"?(r(),m("span",re," Nháp")):d("",!0),s.selectedDocument.status=="pending"?(r(),m("span",ie," Chờ phê duyệt")):d("",!0),s.selectedDocument.status=="approved"?(r(),m("span",de," Đã phê duyệt")):d("",!0),s.selectedDocument.status=="rejected"?(r(),m("span",ue," Bị từ chối")):d("",!0)]),t("p",null,[e[19]||(e[19]=t("strong",null,"Ngày tạo:",-1)),k(" "+i(s.selectedDocument.created_at),1)]),t("p",null,[e[20]||(e[20]=t("strong",null,"Ngày cập nhật:",-1)),k(" "+i(s.selectedDocument.updated_at),1)]),t("p",null,[e[21]||(e[21]=t("strong",null,"Tệp:",-1)),t("a",{href:`http://localhost:8000/documents/${s.selectedDocument.file_path}`,target:"_blank"}," Xem tệp ",8,pe)]),p(V)])]),_:1},8,["open"])],64)}const ge=U(z,[["render",ce]]);export{ge as default};
