import{_ as V,e as x,c as B,b as u,d as n,r as g,F as j,y as E,g as b,C as K,i as F,M as L,G as A,H as R,D as G,o as r,a as e,I as d,x as p,q as f,J as U}from"./index-CRJSQdz7.js";import{u as Q}from"./use-menu-BRyuwgc6.js";import{u as q}from"./certificate-store-BpnteTNF.js";import{u as z}from"./use-register-DAZeG_EL.js";const J=x({setup(){Q().onSelectedKeys(["admin-users"]);const s=E(),t=q(),$=z();G();let h=b([]);const T=[{title:"Họ tên",dataIndex:"name",key:"name",width:200,sorter:(l,o)=>{const c=l.name.split(" ").slice(-1).join(" "),O=o.name.split(" ").slice(-1).join(" ");return c.localeCompare(O)},sortDirections:["ascend","descend"],customHeaderCell:()=>({style:{textAlign:"center"}})},{title:"Email",dataIndex:"email",key:"email",width:200,customHeaderCell:()=>({style:{textAlign:"center"}})},{title:"Chức vụ",dataIndex:"roll",key:"roll",responsive:["xl"],width:250,align:"center"},{title:"Trạng thái",dataIndex:"status",key:"status",width:150,sorter:(l,o)=>{const c={pending:1,active:2,banned:3,inactive:4};return c[l.status]-c[o.status]},sortDirections:["ascend","descend"],align:"center"},{title:"Thao tác",key:"action",fixed:"right",width:100,customHeaderCell:()=>({style:{textAlign:"center"}})}],H=b(!1),D=b(null),v=l=>{H.value=!0,D.value=l},I=(l,o)=>{L.confirm({title:`Bạn có chắc chắn muốn ${o==="ban"?"cấm":"kích hoạt tài khoản cho"} ${l.name}?`,async onOk(){o==="ban"?(await A.post("/api/users/banned",{id:l.id}),R.success(`Đã cấm ${l.name}!`)):(await A.post("/api/users/active",{id:l.id}),await t.issueCertificate(l.id),R.success(`Đã kích hoạt ${l.name}!`));const c=h.value.findIndex(O=>O.id===l.id);c!==-1&&(h.value[c].status=o==="ban"?"banned":"active")},onCancel(){}})},k=l=>{L.confirm({title:`Bạn có chắc chắn muốn bỏ cấm cho ${l.name}?`,async onOk(){await A.post("/api/users/unban",{id:l.id});const o=h.value.findIndex(c=>c.id===l.id);o!==-1&&(h.value[o].status="active"),R.success("Bỏ cám thành công!")},onCancel(){}})},w=b(""),m=b(null),y=b(null),C=b(null),M=(l,o)=>o.label.toLowerCase().indexOf(l.toLowerCase())>=0,N=K(()=>[{label:"Tất cả trạng thái",value:null},{label:"Hoạt động",value:"active"},{label:"Chưa kích hoạt mail",value:"inactive"},{label:"Chờ duyệt",value:"pending"},{label:"Bị cấm",value:"banned"}]),a=b(),S=b(),i=K(()=>{let l=[...h.value];if(w.value){const o=w.value.toLowerCase();l=l.filter(c=>c.name.toLowerCase().includes(o)||c.email.toLowerCase().includes(o)||c.phone&&c.phone.includes(o))}return y.value&&(l=l.filter(o=>o.role===y.value)),m.value&&(l=l.filter(o=>o.status===m.value)),C.value&&(l=l.filter(o=>o.department_id===C.value)),l}),_=l=>({onClick:()=>{T.find(o=>o.key==="action")||v(l)},style:{cursor:"pointer"}});return F(async()=>{await s.fetchUsers(),h.value=s.users,await $.fetchRegisterForm(),S.value=$.departments,a.value=$.rolls}),{users:h,columns:T,filterData:i,search:w,status_filter:m,users_status:N,role_filter:y,users_role:a,department_filter:C,users_department:S,showModalDetail:H,currentUser:D,filterOption:M,viewDetail:v,customRow:_,showConfirm:I,showConfirmUnban:k}}}),X={class:"row mb-3"},P={class:"col-12 align-items-center justify-content-end d-flex"},W={class:"row mb-3"},Y={class:"col-12"},Z={class:"row g-2"},tt={class:"col-12 col-md-4 align-items-center"},et={class:"col-12 col-md-8"},st={class:"row g-2"},nt={class:"col-6 col-md-4"},lt={class:"col-6 col-md-4"},ot={class:"col-6 col-md-3"},at={class:"col-6 col-md-1 d-flex align-items-center justify-content-end"},it={class:"row"},rt={class:"col-12"},dt={key:0},ut={class:""},ct=["href"],pt={key:0},mt={class:"row mb-3"},ft={class:"col-12 col-md-6"},vt={class:"col-12 col-md-6"},wt={class:"row mb-3"},gt={class:"col-12 col-md-6"},bt={class:"col-12 col-md-6"},ht={class:"row mb-3"},kt={class:"col-12 col-md-6"},yt={class:"col-12 col-md-6"},Ct={class:"row mb-3"},_t={class:"col-12"},Ut={class:"row mb-3"},$t={class:"col-12"};function Dt(s,t,$,h,T,H){const D=g("router-link"),v=g("a-button"),I=g("a-input-search"),k=g("a-select"),w=g("a-tooltip"),m=g("a-tag"),y=g("a-space"),C=g("a-table"),M=g("a-card"),N=g("a-modal");return r(),B(j,null,[u(M,{title:"",style:{width:"100%"},class:"rounded-0 mt-1"},{default:n(()=>[t[21]||(t[21]=e("h2",{class:""},"Quản lý người dùng",-1)),t[22]||(t[22]=e("span",{class:"text-secondary fst-italic"},"Quản lý thông tin tài khoản người dùng",-1)),e("div",X,[e("div",P,[u(v,{type:"primary"},{default:n(()=>[u(D,{to:{name:"admin-users-create"},class:"text-white"},{default:n(()=>t[6]||(t[6]=[e("i",{class:"fa-solid fa-plus"},null,-1)])),_:1})]),_:1})])]),e("div",W,[e("div",Y,[e("div",Z,[e("div",tt,[u(I,{value:s.search,"onUpdate:value":t[0]||(t[0]=a=>s.search=a),placeholder:"Tìm kiếm","allow-clear":"","enter-button":"",class:"w-100"},null,8,["value"])]),e("div",et,[e("div",st,[e("div",nt,[u(k,{value:s.status_id,"onUpdate:value":t[1]||(t[1]=a=>s.status_id=a),"show-search":"",placeholder:"Tất cả trạng thái",options:s.users_status,"filter-option":s.filterOption,"allow-clear":"",class:"w-100"},null,8,["value","options","filter-option"])]),e("div",lt,[u(k,{value:s.role_id,"onUpdate:value":t[2]||(t[2]=a=>s.role_id=a),"show-search":"",placeholder:"Tất cả vai trò",options:s.users_role,"filter-option":s.filterOption,"allow-clear":"",class:"w-100"},null,8,["value","options","filter-option"])]),e("div",ot,[u(k,{value:s.department_id,"onUpdate:value":t[3]||(t[3]=a=>s.department_id=a),"show-search":"",placeholder:"Tất cả đơn vị",options:s.users_department,"filter-option":s.filterOption,"allow-clear":"",class:"w-100"},null,8,["value","options","filter-option"])]),e("div",at,[u(v,{type:"primary",class:""},{default:n(()=>t[7]||(t[7]=[e("i",{class:"fa-solid fa-filter"},null,-1)])),_:1})])])])])])]),e("div",it,[e("div",rt,[u(C,{dataSource:s.filterData,columns:s.columns,scroll:{x:576},bordered:"",customRow:s.customRow,locale:{triggerDesc:"Nhấn để sắp xếp giảm dần",triggerAsc:"Nhấn để sắp xếp tăng dần",cancelSort:"Nhấn để hủy sắp xếp"}},{bodyCell:n(({column:a,index:S,record:i})=>[a.key==="index"?(r(),B("span",dt,f(S+1),1)):d("",!0),a.key==="name"?(r(),p(w,{key:1},{title:n(()=>[e("span",ut,f(i.roll),1)]),default:n(()=>[e("span",null,f(i.name),1)]),_:2},1024)):d("",!0),a.key==="email"?(r(),p(w,{key:2},{title:n(()=>t[8]||(t[8]=[e("span",null,"Click để gửi mail",-1)])),default:n(()=>[e("a",{href:`mailto:${i.email}?subject=Gửi tới ${i.name}&body=Chào ${i.name},%0D%0A%0D%0A`,class:"text-decoration-none fst-italic"},f(i.email),9,ct)]),_:2},1024)):d("",!0),a.key==="status"?(r(),B(j,{key:3},[i.status==="active"?(r(),p(m,{key:0,color:"green"},{default:n(()=>t[9]||(t[9]=[e("span",null,"Hoạt động",-1)])),_:1})):d("",!0),i.status==="inactive"?(r(),p(m,{key:1,color:"gray"},{default:n(()=>t[10]||(t[10]=[e("span",null,"Chưa kích hoạt mail",-1)])),_:1})):d("",!0),i.status==="pending"?(r(),p(m,{key:2,color:"orange"},{default:n(()=>t[11]||(t[11]=[e("span",null,"Chờ duyệt",-1)])),_:1})):d("",!0),i.status==="banned"?(r(),p(m,{key:3,color:"red"},{default:n(()=>t[12]||(t[12]=[e("span",null,"Bị cấm",-1)])),_:1})):d("",!0)],64)):d("",!0),a.key==="action"?(r(),p(y,{key:4,class:"d-flex justify-content-center gap-3"},{default:n(()=>[u(w,null,{title:n(()=>t[13]||(t[13]=[e("span",{class:""},"Xem chi tiết",-1)])),default:n(()=>[u(v,{onClick:_=>s.viewDetail(i),class:"bg-primary text-white"},{default:n(()=>t[14]||(t[14]=[e("i",{class:"bi bi-eye"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024),i.status==="pending"?(r(),p(w,{key:0},{title:n(()=>t[15]||(t[15]=[e("span",{class:""},"Kích hoạt tài khoản",-1)])),default:n(()=>[u(v,{onClick:_=>s.showConfirm(i,"activate"),class:"bg-success text-white"},{default:n(()=>t[16]||(t[16]=[e("i",{class:"bi bi-check"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024)):d("",!0),i.status==="active"?(r(),p(w,{key:1},{title:n(()=>t[17]||(t[17]=[e("span",{class:""},"Khóa tài khoản",-1)])),default:n(()=>[u(v,{onClick:_=>s.showConfirm(i,"ban"),class:"bg-danger text-white"},{default:n(()=>t[18]||(t[18]=[e("i",{class:"bi bi-ban"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024)):d("",!0),i.status==="banned"?(r(),p(w,{key:2},{title:n(()=>t[19]||(t[19]=[e("span",{class:""},"Gỡ khóa tài khoản",-1)])),default:n(()=>[u(v,{onClick:_=>s.showConfirmUnban(i),class:"bg-danger-subtle border-danger text-white"},{default:n(()=>t[20]||(t[20]=[e("i",{class:"bi bi-ban"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024)):d("",!0)]),_:2},1024)):d("",!0)]),_:1},8,["dataSource","columns","customRow"])])])]),_:1}),u(N,{open:s.showModalDetail,"onUpdate:open":t[5]||(t[5]=a=>s.showModalDetail=a),title:"Thông tin chi tiết người dùng",width:"80%",zIndex:1e4},{footer:n(()=>[u(v,{onClick:t[4]||(t[4]=a=>s.showModalDetail=!1)},{default:n(()=>t[23]||(t[23]=[U("Đóng")])),_:1})]),default:n(()=>[s.currentUser?(r(),B("div",pt,[e("div",mt,[e("div",ft,[t[24]||(t[24]=e("span",{class:"fw-bold"},"Họ tên: ",-1)),e("span",null,f(s.currentUser.name),1)]),e("div",vt,[t[25]||(t[25]=e("span",{class:"fw-bold"},"Email: ",-1)),e("span",null,f(s.currentUser.email),1)])]),e("div",wt,[e("div",gt,[t[26]||(t[26]=e("span",{class:"fw-bold"},"Vai trò: ",-1)),e("span",null,f(s.currentUser.roll),1)]),e("div",bt,[t[31]||(t[31]=e("span",{class:"fw-bold"},"Trạng thái: ",-1)),e("span",null,[s.currentUser.status==="active"?(r(),p(m,{key:0,color:"green"},{default:n(()=>t[27]||(t[27]=[U("Hoạt động")])),_:1})):d("",!0),s.currentUser.status==="inactive"?(r(),p(m,{key:1,color:"gray"},{default:n(()=>t[28]||(t[28]=[U("Chưa kích hoạt mail")])),_:1})):d("",!0),s.currentUser.status==="pending"?(r(),p(m,{key:2,color:"orange"},{default:n(()=>t[29]||(t[29]=[U("Chờ duyệt")])),_:1})):d("",!0),s.currentUser.status==="banned"?(r(),p(m,{key:3,color:"red"},{default:n(()=>t[30]||(t[30]=[U("Bị cấm")])),_:1})):d("",!0)])])]),e("div",ht,[e("div",kt,[t[32]||(t[32]=e("span",{class:"fw-bold"},"Đơn vị: ",-1)),e("span",null,f(s.currentUser.department_name),1)]),e("div",yt,[t[33]||(t[33]=e("span",{class:"fw-bold"},"Số điện thoại: ",-1)),e("span",null,f(s.currentUser.phone??"Không có"),1)])]),e("div",Ct,[e("div",_t,[t[34]||(t[34]=e("span",{class:"fw-bold"},"Địa chỉ: ",-1)),e("span",null,f(s.currentUser.address??"Không có"),1)])]),e("div",Ut,[e("div",$t,[t[35]||(t[35]=e("span",{class:"fw-bold"},"Ngày đăng ký: ",-1)),e("span",null,f(s.currentUser.created_at),1)])])])):d("",!0)]),_:1},8,["open"])],64)}const It=V(J,[["render",Dt]]);export{It as default};
