import{_ as y,c as d,o as c,a as e,I as f,n as m,w as g,$ as w,F as v,u as p,q as a,Y as D,N as u,J as b,G as _}from"./index-ixtV8ZqQ.js";const k={name:"PublicDocuments",data(){return{documents:[],filteredDocuments:[],loading:!1,viewMode:"card",currentPage:1,itemsPerPage:12,selectedDocument:null,filters:{documentType:"",department:"",search:""},documentTypes:[],departments:[],sortField:"created_at",sortOrder:"desc",searchTimer:null,apiUrl:"https://tminh.id.vn"}},computed:{paginatedDocuments(){const n=(this.currentPage-1)*this.itemsPerPage,t=n+this.itemsPerPage;return this.filteredDocuments.slice(n,t)},totalPages(){return Math.ceil(this.filteredDocuments.length/this.itemsPerPage)},visiblePages(){const n=[];let o=Math.max(1,this.currentPage-2),r=Math.min(this.totalPages,this.currentPage+2);this.currentPage<=2&&(r=Math.min(this.totalPages,2*2+1)),this.currentPage>this.totalPages-2&&(o=Math.max(1,this.totalPages-2*2));for(let l=o;l<=r;l++)n.push(l);return n}},mounted(){this.fetchDocuments(),this.loadViewMode()},methods:{async fetchDocuments(){this.loading=!0;try{const n=await _.get("/api/documents/public");this.documents=n.data.documents||[],this.filteredDocuments=[...this.documents],this.extractFilterOptions()}catch(n){console.error("Error fetching documents:",n),this.$toast.error("Không thể tải danh sách văn bản")}finally{this.loading=!1}},extractFilterOptions(){const n=new Map;this.documents.forEach(o=>{o.document_type&&o.document_type.id&&n.set(o.document_type.id,o.document_type)}),this.documentTypes=Array.from(n.values());const t=new Set;this.documents.forEach(o=>{const r=this.getDepartmentFromPosition(o.creator.position);r&&t.add(r)}),this.departments=Array.from(t).map((o,r)=>({id:r+1,name:o}))},applyFilters(){let n=[...this.documents];if(this.filters.documentType&&(n=n.filter(t=>t.document_type.id===parseInt(this.filters.documentType))),this.filters.department){const t=this.departments.find(o=>o.id===parseInt(this.filters.department));t&&(n=n.filter(o=>o.creator.position.includes(t.name)))}if(this.filters.search){const t=this.filters.search.toLowerCase();n=n.filter(o=>o.title.toLowerCase().includes(t)||o.description.toLowerCase().includes(t)||o.creator.name.toLowerCase().includes(t))}this.filteredDocuments=this.sortDocuments(n),this.currentPage=1},sortDocuments(n){return n.sort((t,o)=>{let r=this.getNestedValue(t,this.sortField),l=this.getNestedValue(o,this.sortField);return this.sortField==="created_at"&&(r=new Date(r),l=new Date(l)),this.sortOrder==="asc"?r>l?1:-1:r<l?1:-1})},getNestedValue(n,t){return t.split(".").reduce((o,r)=>o&&o[r],n)},sortBy(n){this.sortField===n?this.sortOrder=this.sortOrder==="asc"?"desc":"asc":(this.sortField=n,this.sortOrder="asc"),this.applyFilters()},getSortIcon(n){return this.sortField!==n?"fas fa-sort":this.sortOrder==="asc"?"fas fa-sort-up":"fas fa-sort-down"},debounceSearch(){clearTimeout(this.searchTimer),this.searchTimer=setTimeout(()=>{this.applyFilters()},300)},clearFilters(){this.filters={documentType:"",department:"",search:""},this.applyFilters()},viewDocument(n){this.selectedDocument=n},closeModal(){this.selectedDocument=null},async downloadDocument(n){try{const t=await _.get(`/api/documents/${n.id}/download`,{responseType:"blob"}),o=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=o,r.setAttribute("download",n.file_path.split("/").pop()),document.body.appendChild(r),r.click(),r.remove(),this.$toast.success("Đã tải xuống văn bản")}catch(t){console.error("Error downloading document:",t),this.$toast.error("Không thể tải xuống văn bản")}},viewFullDocument(n){window.open(`/documents/${n.id}/view`,"_blank")},formatDate(n){return n},truncateText(n,t){return!n||n.length<=t?n:n.substring(0,t)+"..."},getDepartmentFromPosition(n){const t=n.split(" - ");return t.length>1?t[1]:""},loadViewMode(){const n=localStorage.getItem("documentViewMode");n&&(this.viewMode=n)},saveViewMode(){localStorage.setItem("documentViewMode",this.viewMode)},randomAvatar(n){const t=["adventurer","avataaars","big-ears","bottts","croodles","fun-emoji","identicon","initials","lorelei","micah","miniavs","open-peeps","personas","pixel-art"],o=n%t.length,r=t[o],l=`user-${n}`;return`https://api.dicebear.com/7.x/${r}/svg?seed=${l}&size=150`},getAvatarUrl(n){const t="https://tminh.id.vn";return n.avatar===null?this.randomAvatar(n.id):`${t}/images/avatars/${n.avatar}`}},watch:{viewMode(){this.saveViewMode()}}},P={class:"public-documents"},C={class:"page-header"},M={class:"header-actions"},F={class:"view-toggle"},T={class:"filter-section"},x={class:"filter-group"},V={class:"filter-item"},N=["value"],S={class:"filter-item"},I=["value"],U={class:"filter-item search-box"},A={class:"search-input-wrapper"},L={key:0,class:"loading-wrapper"},B={key:1,class:"empty-state"},O={key:2,class:"card-view"},E={class:"documents-grid"},K=["onClick"],R={class:"card-header"},j={class:"document-type-badge"},z={class:"card-actions"},H=["onClick"],X={class:"card-body"},q={class:"document-title"},G={class:"document-description"},J={class:"creator-info"},Y=["src","alt"],Q={class:"creator-details"},W={class:"creator-name"},Z={class:"creator-position"},$={class:"card-footer"},tt={class:"document-date"},et={key:3,class:"table-view"},st={class:"documents-table"},nt=["onClick"],lt={class:"document-title-cell"},it={class:"title-wrapper"},ot={class:"type-badge"},rt={class:"creator-cell"},at=["src","alt"],dt={class:"table-actions"},ct=["onClick"],ut=["onClick"],mt={key:4,class:"pagination"},ht=["disabled"],vt={class:"page-numbers"},pt=["onClick"],ft=["disabled"],gt={class:"modal-header"},bt={class:"modal-body"},wt={class:"document-info-section"},_t={class:"document-title-modal"},yt={class:"document-type-badge-modal"},Dt={class:"document-details"},kt={class:"detail-row"},Pt={class:"creator-info-modal"},Ct=["src","alt"],Mt={class:"creator-name-text"},Ft={class:"creator-position-text"},Tt={class:"detail-row"},xt={class:"detail-value"},Vt={class:"detail-row description-row"},Nt={class:"description-content"},St={class:"detail-row description-row"},It=["href"],Ut={class:"modal-actions"},At=["href"];function Lt(n,t,o,r,l,i){return c(),d("div",P,[e("div",C,[t[20]||(t[20]=e("h1",null,"Văn bản công khai",-1)),e("div",M,[e("div",F,[e("button",{onClick:t[0]||(t[0]=s=>l.viewMode="card"),class:m(["view-btn",{active:l.viewMode==="card"}]),title:"Hiển thị dạng thẻ"},t[18]||(t[18]=[e("i",{class:"fas fa-th-large"},null,-1)]),2),e("button",{onClick:t[1]||(t[1]=s=>l.viewMode="table"),class:m(["view-btn",{active:l.viewMode==="table"}]),title:"Hiển thị dạng bảng"},t[19]||(t[19]=[e("i",{class:"fas fa-table"},null,-1)]),2)])])]),e("div",T,[e("div",x,[e("div",V,[t[22]||(t[22]=e("label",null,"Loại văn bản:",-1)),g(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>l.filters.documentType=s),onChange:t[3]||(t[3]=(...s)=>i.applyFilters&&i.applyFilters(...s)),class:"filter-select"},[t[21]||(t[21]=e("option",{value:""},"Tất cả loại",-1)),(c(!0),d(v,null,p(l.documentTypes,s=>(c(),d("option",{key:s.id,value:s.id},a(s.name),9,N))),128))],544),[[w,l.filters.documentType]])]),e("div",S,[t[24]||(t[24]=e("label",null,"Đơn vị ban hành:",-1)),g(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>l.filters.department=s),onChange:t[5]||(t[5]=(...s)=>i.applyFilters&&i.applyFilters(...s)),class:"filter-select"},[t[23]||(t[23]=e("option",{value:""},"Tất cả đơn vị",-1)),(c(!0),d(v,null,p(l.departments,s=>(c(),d("option",{key:s.id,value:s.id},a(s.name),9,I))),128))],544),[[w,l.filters.department]])]),e("div",U,[t[26]||(t[26]=e("label",null,"Tìm kiếm theo tên:",-1)),e("div",A,[t[25]||(t[25]=e("i",{class:"fas fa-search"},null,-1)),g(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>l.filters.search=s),onInput:t[7]||(t[7]=(...s)=>i.debounceSearch&&i.debounceSearch(...s)),type:"text",placeholder:"Nhập từ khóa...",class:"search-input"},null,544),[[D,l.filters.search]])])]),e("button",{onClick:t[8]||(t[8]=(...s)=>i.clearFilters&&i.clearFilters(...s)),class:"btn-clear-filter"},t[27]||(t[27]=[e("i",{class:"fas fa-times"},null,-1),u(" Xóa bộ lọc ")]))])]),l.loading?(c(),d("div",L,t[28]||(t[28]=[e("div",{class:"spinner"},null,-1),e("p",null,"Đang tải dữ liệu...",-1)]))):l.filteredDocuments.length===0?(c(),d("div",B,t[29]||(t[29]=[e("i",{class:"fas fa-folder-open"},null,-1),e("p",null,"Không tìm thấy văn bản nào",-1)]))):l.viewMode==="card"?(c(),d("div",O,[e("div",E,[(c(!0),d(v,null,p(i.paginatedDocuments,s=>(c(),d("div",{key:s.id,class:"document-card",onClick:h=>i.viewDocument(s)},[e("div",R,[e("div",j,a(s.document_type.name),1),e("div",z,[e("button",{onClick:b(h=>i.downloadDocument(s),["stop"]),class:"btn-icon",title:"Tải xuống"},t[30]||(t[30]=[e("i",{class:"fas fa-download"},null,-1)]),8,H)])]),e("div",X,[e("h3",q,a(s.title),1),e("p",G,a(i.truncateText(s.description,100)),1),e("div",J,[e("img",{src:i.getAvatarUrl(s.creator),alt:s.creator.name,class:"creator-avatar"},null,8,Y),e("div",Q,[e("p",W,a(s.creator.name),1),e("p",Z,a(s.creator.position),1)])])]),e("div",$,[e("span",tt,[t[31]||(t[31]=e("i",{class:"far fa-calendar"},null,-1)),u(" "+a(i.formatDate(s.created_at)),1)])])],8,K))),128))])])):l.viewMode==="table"?(c(),d("div",et,[e("table",st,[e("thead",null,[e("tr",null,[e("th",{onClick:t[9]||(t[9]=s=>i.sortBy("title")),class:"sortable"},[t[32]||(t[32]=u(" Tiêu đề ")),e("i",{class:m(i.getSortIcon("title"))},null,2)]),e("th",{onClick:t[10]||(t[10]=s=>i.sortBy("document_type.name")),class:"sortable"},[t[33]||(t[33]=u(" Loại văn bản ")),e("i",{class:m(i.getSortIcon("document_type.name"))},null,2)]),t[35]||(t[35]=e("th",null,"Người ban hành",-1)),t[36]||(t[36]=e("th",null,"Đơn vị",-1)),e("th",{onClick:t[11]||(t[11]=s=>i.sortBy("created_at")),class:"sortable"},[t[34]||(t[34]=u(" Ngày ban hành ")),e("i",{class:m(i.getSortIcon("created_at"))},null,2)]),t[37]||(t[37]=e("th",null,"Thao tác",-1))])]),e("tbody",null,[(c(!0),d(v,null,p(i.paginatedDocuments,s=>(c(),d("tr",{key:s.id,onClick:h=>i.viewDocument(s),class:"table-row"},[e("td",lt,[e("div",it,[t[38]||(t[38]=e("i",{class:"fas fa-file-alt"},null,-1)),u(" "+a(s.title),1)])]),e("td",null,[e("span",ot,a(s.document_type.name),1)]),e("td",null,[e("div",rt,[e("img",{src:i.getAvatarUrl(s.creator),alt:s.creator.name,class:"creator-avatar-small"},null,8,at),u(" "+a(s.creator.name),1)])]),e("td",null,a(i.getDepartmentFromPosition(s.creator.position)),1),e("td",null,a(i.formatDate(s.created_at)),1),e("td",{onClick:t[12]||(t[12]=b(()=>{},["stop"]))},[e("div",dt,[e("button",{onClick:h=>i.viewDocument(s),class:"btn-action",title:"Xem chi tiết"},t[39]||(t[39]=[e("i",{class:"fas fa-eye"},null,-1)]),8,ct),e("button",{onClick:h=>i.downloadDocument(s),class:"btn-action",title:"Tải xuống"},t[40]||(t[40]=[e("i",{class:"fas fa-download"},null,-1)]),8,ut)])])],8,nt))),128))])])])):f("",!0),i.totalPages>1?(c(),d("div",mt,[e("button",{onClick:t[13]||(t[13]=s=>l.currentPage=l.currentPage-1),disabled:l.currentPage===1,class:"page-btn"},t[41]||(t[41]=[e("i",{class:"fas fa-chevron-left"},null,-1)]),8,ht),e("div",vt,[(c(!0),d(v,null,p(i.visiblePages,s=>(c(),d("button",{key:s,onClick:h=>l.currentPage=s,class:m(["page-number",{active:l.currentPage===s}])},a(s),11,pt))),128))]),e("button",{onClick:t[14]||(t[14]=s=>l.currentPage=l.currentPage+1),disabled:l.currentPage===i.totalPages,class:"page-btn"},t[42]||(t[42]=[e("i",{class:"fas fa-chevron-right"},null,-1)]),8,ft)])):f("",!0),l.selectedDocument?(c(),d("div",{key:5,class:"modal-overlay",onClick:t[17]||(t[17]=(...s)=>i.closeModal&&i.closeModal(...s))},[e("div",{class:"modal-content",onClick:t[16]||(t[16]=b(()=>{},["stop"]))},[e("div",gt,[t[44]||(t[44]=e("h2",null,"Chi tiết văn bản",-1)),e("button",{onClick:t[15]||(t[15]=(...s)=>i.closeModal&&i.closeModal(...s)),class:"btn-close"},t[43]||(t[43]=[e("i",{class:"fas fa-times"},null,-1)]))]),e("div",bt,[e("div",wt,[e("h3",_t,a(l.selectedDocument.title),1),e("div",yt,a(l.selectedDocument.document_type.name),1)]),e("div",Dt,[e("div",kt,[t[45]||(t[45]=e("label",null,"Người ban hành:",-1)),e("div",Pt,[e("img",{src:i.getAvatarUrl(l.selectedDocument.creator),alt:l.selectedDocument.creator.name,class:"creator-avatar-modal"},null,8,Ct),e("div",null,[e("span",Mt,a(l.selectedDocument.creator.name),1),e("span",Ft,a(l.selectedDocument.creator.position),1)])])]),e("div",Tt,[t[46]||(t[46]=e("label",null,"Ngày ban hành:",-1)),e("span",xt,a(i.formatDate(l.selectedDocument.created_at)),1)]),e("div",Vt,[t[47]||(t[47]=e("label",null,"Mô tả:",-1)),e("p",Nt,a(l.selectedDocument.description),1)]),e("div",St,[t[48]||(t[48]=e("label",null,"Chứng chỉ số:",-1)),e("a",{href:`${l.apiUrl}/documents/certificates/${l.selectedDocument.certificate_path}`,target:"_blank",class:"text-decoration-none fst-italic"}," Mở ",8,It)])]),e("div",Ut,[e("a",{href:`${l.apiUrl}/documents/${l.selectedDocument.file_path}`,target:"_blank",class:"btn-view-external"},t[49]||(t[49]=[e("i",{class:"fas fa-external-link-alt"},null,-1),u(" Mở trong tab mới ")]),8,At)])])])])):f("",!0)])}const Ot=y(k,[["render",Lt],["__scopeId","data-v-c255ddf8"]]);export{Ot as N};
