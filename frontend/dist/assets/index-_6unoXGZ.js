import{_ as I,d as j,A as f,w as s,r as m,u as O,e as S,f as T,M as g,B as y,C as b,z as H,o as l,b as e,a as c,c as _,D as d,l as k,F as M}from"./index-Ba8l0gpi.js";import{u as N}from"./use-menu-CIRKYwAT.js";import"./pdfjs-CqkleIqs.js";const K=j({setup(){const n=O();H(),N().onSelectedKeys(["admin-users"]);let t=S([]);const w=[{title:"Họ tên",dataIndex:"name",key:"name",width:200,sorter:(a,o)=>{const r=a.name.split(" ").slice(-1).join(" "),p=o.name.split(" ").slice(-1).join(" ");return r.localeCompare(p)},sortDirections:["ascend","descend"],customHeaderCell:()=>({style:{textAlign:"center"}})},{title:"Email",dataIndex:"email",key:"email",width:200,customHeaderCell:()=>({style:{textAlign:"center"}})},{title:"Chức vụ",dataIndex:"roll",key:"roll",responsive:["xl"],width:250,align:"center"},{title:"Trạng thái",dataIndex:"status",key:"status",width:150,sorter:(a,o)=>{const r={active:1,banned:2,pending:3,inactive:4};return r[a.status]-r[o.status]},sortDirections:["ascend","descend"],align:"center"},{title:"Thao tác",key:"action",fixed:"right",customHeaderCell:()=>({style:{textAlign:"center"}})}];return T(async()=>{await n.fetchUsers(),t.value=n.users}),{users:t,columns:w,viewDetail:a=>{console.log("Chi tiết:",a)},showConfirm:(a,o)=>{g.confirm({title:`Bạn có chắc chắn muốn ${o==="ban"?"cấm":"kích hoạt tài khoản cho"} ${a.name}?`,async onOk(){o==="ban"?(await y.post("/api/users/banned",{id:a.id}),b.success(`Đã cấm ${a.name}!`)):(await y.post("/api/users/active",{id:a.id}),b.success(`Đã kích hoạt ${a.name}!`));const r=t.value.findIndex(p=>p.id===a.id);r!==-1&&(t.value[r].status=o==="ban"?"banned":"active")},onCancel(){}})},showConfirmUnban:a=>{g.confirm({title:`Bạn có chắc chắn muốn bỏ cấm cho ${a.name}?`,async onOk(){await y.post("/api/users/unban",{id:a.id});const o=t.value.findIndex(r=>r.id===a.id);o!==-1&&(t.value[o].status="active"),b.success("Bỏ cám thành công!")},onCancel(){}})}}}}),V={class:"row mb-3"},E={class:"col-12 align-items-center justify-content-end d-flex"},F={class:"row mb-3"},G={class:"col-12"},z={class:"row g-2"},L={class:"col-12 col-md-4 align-items-center"},Q={class:"col-12 col-md-8"},R={class:"row g-2"},X={class:"col-6 col-md-4"},q={class:"col-6 col-md-4"},J={class:"col-6 col-md-3"},P={class:"col-6 col-md-1 d-flex align-items-center justify-content-end"},W={class:"row"},Y={class:"col-12"},Z={key:0},tt={class:""},et=["href"],st={key:0,class:"text-secondary"},nt={key:1,class:"text-primary"},at={key:2,class:"text-success"},ot={key:3,class:"text-danger"};function it(n,t,w,C,x,$){const a=m("router-link"),o=m("a-button"),r=m("a-input-search"),p=m("a-select"),h=m("a-tooltip"),B=m("a-space"),D=m("a-table"),U=m("a-card");return l(),f(U,{title:"",style:{width:"100%"},class:"rounded-0 mt-1"},{default:s(()=>[t[14]||(t[14]=e("h2",{class:"fw-bold mb-5"},"Quản Lý Người Dùng",-1)),e("div",V,[e("div",E,[c(o,{type:"primary"},{default:s(()=>[c(a,{to:{name:"admin-users-create"},class:"text-white"},{default:s(()=>t[3]||(t[3]=[e("i",{class:"fa-solid fa-plus"},null,-1)])),_:1})]),_:1})])]),e("div",F,[e("div",G,[e("div",z,[e("div",L,[c(r,{placeholder:"Tìm kiếm","allow-clear":"","enter-button":"",class:"w-100"})]),e("div",Q,[e("div",R,[e("div",X,[c(p,{value:n.status_id,"onUpdate:value":t[0]||(t[0]=u=>n.status_id=u),"show-search":"",placeholder:"Tất cả trạng thái",options:n.users_status,"filter-option":n.filterOption,"allow-clear":"",class:"w-100"},null,8,["value","options","filter-option"])]),e("div",q,[c(p,{value:n.role_id,"onUpdate:value":t[1]||(t[1]=u=>n.role_id=u),"show-search":"",placeholder:"Tất cả vai trò",options:n.users_role,"filter-option":n.filterOption,"allow-clear":"",class:"w-100"},null,8,["value","options","filter-option"])]),e("div",J,[c(p,{value:n.department_id,"onUpdate:value":t[2]||(t[2]=u=>n.department_id=u),"show-search":"",placeholder:"Tất cả đơn vị",options:n.users_department,"filter-option":n.filterOption,"allow-clear":"",class:"w-100"},null,8,["value","options","filter-option"])]),e("div",P,[c(o,{type:"primary",class:""},{default:s(()=>t[4]||(t[4]=[e("i",{class:"fa-solid fa-filter"},null,-1)])),_:1})])])])])])]),e("div",W,[e("div",Y,[c(D,{dataSource:n.users,columns:n.columns,scroll:{x:576}},{bodyCell:s(({column:u,index:A,record:i})=>[u.key==="index"?(l(),_("span",Z,k(A+1),1)):d("",!0),u.key==="name"?(l(),f(h,{key:1},{title:s(()=>[e("span",tt,k(i.roll),1)]),default:s(()=>[e("span",null,k(i.name),1)]),_:2},1024)):d("",!0),u.key==="email"?(l(),f(h,{key:2},{title:s(()=>t[5]||(t[5]=[e("span",null,"Click để gửi mail",-1)])),default:s(()=>[e("a",{href:`mailto:${i.email}?subject=Gửi tới ${i.name}&body=Chào ${i.name},%0D%0A%0D%0A`,class:"text-decoration-none fst-italic"},k(i.email),9,et)]),_:2},1024)):d("",!0),u.key==="status"?(l(),_(M,{key:3},[i.status==="inactive"?(l(),_("span",st,"Chưa kích hoạt")):d("",!0),i.status==="pending"?(l(),_("span",nt,"Chờ kích hoạt")):d("",!0),i.status==="active"?(l(),_("span",at,"Hoạt động")):d("",!0),i.status==="banned"?(l(),_("span",ot,"Bị cấm")):d("",!0)],64)):d("",!0),u.key==="action"?(l(),f(B,{key:4,class:"d-flex justify-content-center gap-3"},{default:s(()=>[c(h,null,{title:s(()=>t[6]||(t[6]=[e("span",{class:""},"Xem chi tiết",-1)])),default:s(()=>[c(o,{onClick:v=>n.viewDetail(i),class:"bg-primary text-white"},{default:s(()=>t[7]||(t[7]=[e("i",{class:"bi bi-eye"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024),i.status==="pending"?(l(),f(h,{key:0},{title:s(()=>t[8]||(t[8]=[e("span",{class:""},"Kích hoạt tài khoản",-1)])),default:s(()=>[c(o,{onClick:v=>n.showConfirm(i,"activate"),class:"bg-success text-white"},{default:s(()=>t[9]||(t[9]=[e("i",{class:"bi bi-check"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024)):d("",!0),i.status==="active"?(l(),f(h,{key:1},{title:s(()=>t[10]||(t[10]=[e("span",{class:""},"Khóa tài khoản",-1)])),default:s(()=>[c(o,{onClick:v=>n.showConfirm(i,"ban"),class:"bg-danger text-white"},{default:s(()=>t[11]||(t[11]=[e("i",{class:"bi bi-ban"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024)):d("",!0),i.status==="banned"?(l(),f(h,{key:2},{title:s(()=>t[12]||(t[12]=[e("span",{class:""},"Gỡ khóa tài khoản",-1)])),default:s(()=>[c(o,{onClick:v=>n.showConfirmUnban(i),class:"bg-danger-subtle border-danger text-white"},{default:s(()=>t[13]||(t[13]=[e("i",{class:"bi bi-ban"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024)):d("",!0)]),_:2},1024)):d("",!0)]),_:1},8,["dataSource","columns"])])])]),_:1})}const rt=I(K,[["render",it]]);export{rt as default};
