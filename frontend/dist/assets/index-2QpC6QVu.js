import{u as R}from"./use-menu-Cj1HeZoS.js";import{_ as O,e as F,c as v,b as p,d as a,r as g,F as $,R as M,A as P,y as E,g as f,i as H,C as K,D as q,o as r,a as t,I as d,x as m,q as i,N as k}from"./index-CEDxyVvI.js";import{u as z}from"./department-store-hdTO0MvJ.js";const Q=F({components:{EyeOutlined:M},setup(){const s="https://tminh.id.vn";R().onSelectedKeys(["admin-documents"]);const e=q(),C=P(),A=E(),T=z(),B=f([]),S=f([]),_=f([]),c=f([]),h=[{label:"Bản nháp",value:"draft"},{label:"Chờ duyệt",value:"in_review"},{label:"Đã duyệt",value:"approved"},{label:"Bị từ chối",value:"rejected"}];H(async()=>{await C.fetchAll(),_.value=C.documents,c.value=C.document_types,console.log(_.value),console.log(c.value),B.value=A.users,await T.fetchDepartments(),S.value=T.departments.filter(l=>l.group!=="Khác")});const w=f(!1),b=f({}),N=l=>{b.value=l,w.value=!0,console.log(b.value.id)},L=[{title:"Tên văn bản",key:"title",dataIndex:"title",width:200,sorter:(l,o)=>l.title.localeCompare(o.title),sortDirections:["ascend","descend"],customHeaderCell:()=>({style:{textAlign:"center"}})},{title:"Loại văn bản",key:"type",dataIndex:"type",width:150,sorter:(l,o)=>l.type.localeCompare(o.type),sortDirections:["ascend","descend"],customHeaderCell:()=>({style:{textAlign:"center"}})},{title:"Người đề xuất",key:"creator_name",dataIndex:"creator_name",width:200,sorter:(l,o)=>l.creator_name.localeCompare(o.creator_name),sortDirections:["ascend","descend"],align:"center"},{title:"Trạng thái",key:"status",dataIndex:"status",width:120,sorter:(l,o)=>{const y={draft:1,in_review:2,approved:3,rejected:4};return y[l.status]-y[o.status]},sortDirections:["ascend","descend"],align:"center"},{title:"Ngày tạo",key:"created_at",dataIndex:"created_at",width:150,sorter:(l,o)=>{const y=l.created_at.split(" ")[1].split("/").reverse().join("-")+" "+l.created_at.split(" ")[0],U=o.created_at.split(" ")[1].split("/").reverse().join("-")+" "+o.created_at.split(" ")[0];return y.localeCompare(U)},sortDirections:["ascend","descend"],align:"center"},{title:"Lần duyệt cuối",key:"updated_at",dataIndex:"updated_at",width:150,sorter:(l,o)=>{const y=l.updated_at.split(" ")[1].split("/").reverse().join("-")+" "+l.updated_at.split(" ")[0],U=o.updated_at.split(" ")[1].split("/").reverse().join("-")+" "+o.updated_at.split(" ")[0];return y.localeCompare(U)},sortDirections:["ascend","descend"],align:"center"}],V=l=>({onClick:()=>{N(l)},style:{cursor:"pointer"}}),n=f(""),D=f(void 0),u=f(void 0),j=f(void 0),I=K(()=>{let l=[..._.value];if(n.value){const o=n.value.toLowerCase();l=l.filter(y=>y.title.toLowerCase().includes(o)||y.type.toLowerCase().includes(o)||y.creator_name.toLowerCase().includes(o))}return D.value&&(l=l.filter(o=>o.status===D.value)),u.value&&(l=l.filter(o=>o.type_id===u.value)),j.value&&(l=l.filter(o=>o.department_id===j.value)),l});return{apiUrl:s,users:B,documents:_,document_types:c,document_status:h,departments:S,columns:L,detailVisible:w,selectedDocument:b,search:n,status_filter:D,type_filter:u,department_filter:j,filterData:I,customRow:V,viewDetail:N,goToDetailPage:l=>{e.push({name:"admin-documents-detail",params:{id:l}})}}}}),X={class:"row mb-3"},G={class:"col-12"},J={class:"row g-2"},W={class:"col-12 col-lg-4"},Y={class:"col-12 col-lg-8"},Z={class:"row g-2"},x={class:"col-6 col-lg-4"},ee={class:"col-6 col-lg-4"},te={class:"col-6 col-lg-4"},se={class:"row"},ne={class:"col-12"},le={key:0},oe={class:""},ae={key:2},re={key:4},ie={key:0},de={key:1},ue={key:2},pe={key:3},ce=["href"];function me(s,e,C,A,T,B){const S=g("a-input"),_=g("a-select"),c=g("a-tooltip"),h=g("a-tag"),w=g("a-button"),b=g("a-table"),N=g("a-card"),L=g("a-divider"),V=g("a-modal");return r(),v($,null,[p(N,{title:"",style:{width:"100%"}},{default:a(()=>[e[13]||(e[13]=t("h2",{class:"fw-bold mb-3"},"Quản Lý Văn Bản",-1)),t("div",X,[t("div",G,[t("div",J,[t("div",W,[p(S,{placeholder:"Tìm kiếm",value:s.search,"onUpdate:value":e[0]||(e[0]=n=>s.search=n),"allow-clear":"","enter-button":"",class:"w-100"},null,8,["value"])]),t("div",Y,[t("div",Z,[t("div",x,[p(_,{value:s.status_filter,"onUpdate:value":e[1]||(e[1]=n=>s.status_filter=n),"show-search":"",placeholder:"Trạng thái",options:s.document_status,"filter-option":s.filterOption,"allow-clear":"",class:"w-100",onChange:s.handleStatusFilter},null,8,["value","options","filter-option","onChange"])]),t("div",ee,[p(_,{value:s.type_filter,"onUpdate:value":e[2]||(e[2]=n=>s.type_filter=n),"show-search":"",placeholder:"Loại văn bản",options:s.document_types,"filter-option":s.filterOption,"allow-clear":"",class:"w-100"},null,8,["value","options","filter-option"])]),t("div",te,[p(_,{value:s.department_filter,"onUpdate:value":e[3]||(e[3]=n=>s.department_filter=n),"show-search":"",placeholder:"Đơn vị đề xuất",options:s.departments,"filter-option":s.filterOption,"allow-clear":"",class:"w-100"},null,8,["value","options","filter-option"])])])])])])]),t("div",se,[t("div",ne,[p(b,{"data-source":s.filterData,columns:s.columns,scroll:{x:576},bordered:"",customRow:s.customRow,showSorterTooltip:!1,locale:{triggerDesc:"Nhấn để sắp xếp giảm dần",triggerAsc:"Nhấn để sắp xếp tăng dần",cancelSort:"Nhấn để hủy sắp xếp"}},{headerCell:a(({column:n})=>[n.key==="title"?(r(),m(c,{key:0,title:"Sắp xếp theo tên văn bản"},{default:a(()=>[t("span",null,i(n.title),1)]),_:2},1024)):n.key==="type"?(r(),m(c,{key:1,title:"Sắp xếp theo loại văn bản"},{default:a(()=>[t("span",null,i(n.title),1)]),_:2},1024)):n.key==="creator_name"?(r(),m(c,{key:2,title:"Sắp xếp theo người đề xuất"},{default:a(()=>[t("span",null,i(n.title),1)]),_:2},1024)):n.key==="status"?(r(),m(c,{key:3,title:"Sắp xếp theo trạng thái"},{default:a(()=>[t("span",null,i(n.title),1)]),_:2},1024)):n.key==="created_at"?(r(),m(c,{key:4,title:"Sắp xếp theo ngày tạo"},{default:a(()=>[t("span",null,i(n.title),1)]),_:2},1024)):n.key==="updated_at"?(r(),m(c,{key:5,title:"Sắp xếp theo lần duyệt cuối"},{default:a(()=>[t("span",null,i(n.title),1)]),_:2},1024)):d("",!0)]),bodyCell:a(({column:n,index:D,record:u})=>[n.key==="index"?(r(),v("span",le,i(D+1),1)):d("",!0),n.key==="creator_name"?(r(),m(c,{key:1},{title:a(()=>[t("span",oe,i(u.roll),1)]),default:a(()=>[t("span",null,i(u.creator_name),1)]),_:2},1024)):d("",!0),n.key==="type"?(r(),v("span",ae,i(u.type),1)):d("",!0),n.key==="status"?(r(),v($,{key:3},[u.status==="approved"?(r(),m(h,{key:0,color:"green"},{default:a(()=>e[7]||(e[7]=[t("span",null,"Đã duyệt",-1)])),_:1})):d("",!0),u.status==="draft"?(r(),m(h,{key:1,color:"blue"},{default:a(()=>e[8]||(e[8]=[t("span",null,"Bản nháp",-1)])),_:1})):d("",!0),u.status==="in_review"?(r(),m(h,{key:2,color:"orange"},{default:a(()=>e[9]||(e[9]=[t("span",null,"Chờ duyệt",-1)])),_:1})):d("",!0),u.status==="rejected"?(r(),m(h,{key:3,color:"red"},{default:a(()=>e[10]||(e[10]=[t("span",null,"Bị từ chối",-1)])),_:1})):d("",!0)],64)):d("",!0),n.key==="created_at"?(r(),v("span",re,i(u.created_at),1)):d("",!0),n.key==="action"?(r(),v($,{key:5},[p(w,{class:"btn border"},{default:a(()=>e[11]||(e[11]=[t("i",{class:"bi bi-eye"},null,-1)])),_:1}),p(w,{class:"btn border"},{default:a(()=>e[12]||(e[12]=[t("i",{class:"bi bi-eye"},null,-1)])),_:1})],64)):d("",!0)]),_:1},8,["data-source","columns","customRow"])])])]),_:1}),p(V,{open:s.detailVisible,"onUpdate:open":e[6]||(e[6]=n=>s.detailVisible=n),title:"Chi tiết văn bản",width:"600px","z-index":"10000"},{footer:a(()=>[p(w,{onClick:e[4]||(e[4]=n=>s.detailVisible=!1)},{default:a(()=>e[23]||(e[23]=[k("Đóng")])),_:1}),p(w,{type:"primary",onClick:e[5]||(e[5]=n=>s.goToDetailPage(s.selectedDocument.id))},{default:a(()=>e[24]||(e[24]=[k("Chi tiết")])),_:1})]),default:a(()=>[t("div",null,[e[22]||(e[22]=t("h5",null,"📄 Thông tin văn bản",-1)),t("p",null,[e[14]||(e[14]=t("strong",null,"Tiêu đề:",-1)),k(" "+i(s.selectedDocument.title),1)]),t("p",null,[e[15]||(e[15]=t("strong",null,"Mô tả:",-1)),k(" "+i(s.selectedDocument.description),1)]),t("p",null,[e[16]||(e[16]=t("strong",null,"Loại văn bản:",-1)),k(" "+i(s.selectedDocument.type),1)]),t("p",null,[e[17]||(e[17]=t("strong",null,"Người đề xuất:",-1)),k(" "+i(s.selectedDocument.creator_name),1)]),t("p",null,[e[18]||(e[18]=t("strong",null,"Trạng thái:",-1)),s.selectedDocument.status=="draft"?(r(),v("span",ie," Nháp")):d("",!0),s.selectedDocument.status=="pending"?(r(),v("span",de," Chờ phê duyệt")):d("",!0),s.selectedDocument.status=="approved"?(r(),v("span",ue," Đã phê duyệt")):d("",!0),s.selectedDocument.status=="rejected"?(r(),v("span",pe," Bị từ chối")):d("",!0)]),t("p",null,[e[19]||(e[19]=t("strong",null,"Ngày tạo:",-1)),k(" "+i(s.selectedDocument.created_at),1)]),t("p",null,[e[20]||(e[20]=t("strong",null,"Ngày cập nhật:",-1)),k(" "+i(s.selectedDocument.updated_at),1)]),t("p",null,[e[21]||(e[21]=t("strong",null,"Tệp:",-1)),t("a",{href:`${s.apiUrl}/documents/${s.selectedDocument.file_path}`,target:"_blank"}," Xem tệp ",8,ce)]),p(L)])]),_:1},8,["open"])],64)}const _e=O(Q,[["render",me]]);export{_e as default};
