import{_ as A,c as d,o as c,a as e,I as g,n as m,w as b,$ as k,F as h,u as v,q as a,Y as T,N as u,b as _,d as f,r as y,J as w,G as D}from"./index-HU749lUt.js";const x={name:"PublicDocuments",data(){return{documents:[],filteredDocuments:[],loading:!1,viewMode:"card",currentPage:1,itemsPerPage:12,selectedDocument:null,filters:{documentType:"",department:"",search:""},documentTypes:[],departments:[],sortField:"created_at",sortOrder:"desc",searchTimer:null,apiUrl:"https://tminh.id.vn"}},computed:{paginatedDocuments(){const n=(this.currentPage-1)*this.itemsPerPage,t=n+this.itemsPerPage;return this.filteredDocuments.slice(n,t)},totalPages(){return Math.ceil(this.filteredDocuments.length/this.itemsPerPage)},visiblePages(){const n=[];let o=Math.max(1,this.currentPage-2),r=Math.min(this.totalPages,this.currentPage+2);this.currentPage<=2&&(r=Math.min(this.totalPages,2*2+1)),this.currentPage>this.totalPages-2&&(o=Math.max(1,this.totalPages-2*2));for(let l=o;l<=r;l++)n.push(l);return n}},mounted(){this.fetchDocuments(),this.loadViewMode()},methods:{async fetchDocuments(){this.loading=!0;try{const n=await D.get("/api/documents/public");this.documents=n.data.documents||[],this.filteredDocuments=[...this.documents],this.extractFilterOptions()}catch(n){console.error("Error fetching documents:",n),this.$toast.error("Không thể tải danh sách văn bản")}finally{this.loading=!1}},extractFilterOptions(){const n=new Map;this.documents.forEach(o=>{o.document_type&&o.document_type.id&&n.set(o.document_type.id,o.document_type)}),this.documentTypes=Array.from(n.values());const t=new Set;this.documents.forEach(o=>{const r=this.getDepartmentFromPosition(o.creator.position);r&&t.add(r)}),this.departments=Array.from(t).map((o,r)=>({id:r+1,name:o}))},applyFilters(){let n=[...this.documents];if(this.filters.documentType&&(n=n.filter(t=>t.document_type.id===parseInt(this.filters.documentType))),this.filters.department){const t=this.departments.find(o=>o.id===parseInt(this.filters.department));t&&(n=n.filter(o=>o.creator.position.includes(t.name)))}if(this.filters.search){const t=this.filters.search.toLowerCase();n=n.filter(o=>o.title.toLowerCase().includes(t)||o.description.toLowerCase().includes(t)||o.creator.name.toLowerCase().includes(t))}this.filteredDocuments=this.sortDocuments(n),this.currentPage=1},sortDocuments(n){return n.sort((t,o)=>{let r=this.getNestedValue(t,this.sortField),l=this.getNestedValue(o,this.sortField);return this.sortField==="created_at"&&(r=new Date(r),l=new Date(l)),this.sortOrder==="asc"?r>l?1:-1:r<l?1:-1})},getNestedValue(n,t){return t.split(".").reduce((o,r)=>o&&o[r],n)},sortBy(n){this.sortField===n?this.sortOrder=this.sortOrder==="asc"?"desc":"asc":(this.sortField=n,this.sortOrder="asc"),this.applyFilters()},getSortIcon(n){return this.sortField!==n?"fas fa-sort":this.sortOrder==="asc"?"fas fa-sort-up":"fas fa-sort-down"},debounceSearch(){clearTimeout(this.searchTimer),this.searchTimer=setTimeout(()=>{this.applyFilters()},300)},clearFilters(){this.filters={documentType:"",department:"",search:""},this.applyFilters()},viewDocument(n){this.selectedDocument=n},closeModal(){this.selectedDocument=null},async downloadDocument(n){try{const t=await D.get(`/api/documents/${n.id}/download`,{responseType:"blob"}),o=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=o,r.setAttribute("download",n.file_path.split("/").pop()),document.body.appendChild(r),r.click(),r.remove(),this.$toast.success("Đã tải xuống văn bản")}catch(t){console.error("Error downloading document:",t),this.$toast.error("Không thể tải xuống văn bản")}},viewFullDocument(n){window.open(`/documents/${n.id}/view`,"_blank")},formatDate(n){return n},truncateText(n,t){return!n||n.length<=t?n:n.substring(0,t)+"..."},getDepartmentFromPosition(n){const t=n.split(" - ");return t.length>1?t[1]:""},loadViewMode(){const n=localStorage.getItem("documentViewMode");n&&(this.viewMode=n)},saveViewMode(){localStorage.setItem("documentViewMode",this.viewMode)},randomAvatar(n){const t=["adventurer","avataaars","big-ears","bottts","croodles","fun-emoji","identicon","initials","lorelei","micah","miniavs","open-peeps","personas","pixel-art"],o=n%t.length,r=t[o],l=`user-${n}`;return`https://api.dicebear.com/7.x/${r}/svg?seed=${l}&size=150`},getAvatarUrl(n){const t="https://tminh.id.vn";return n.avatar===null?this.randomAvatar(n.id):`${t}/images/avatars/${n.avatar}`}},watch:{viewMode(){this.saveViewMode()}}},F={class:"public-documents"},V={class:"page-header"},N={class:"header-actions"},S={class:"view-toggle"},I={class:"filter-section"},U={class:"filter-group"},L={class:"filter-item"},B=["value"],O={class:"filter-item"},E=["value"],j={class:"filter-item search-box"},R={class:"search-input-wrapper"},H={key:0,class:"loading-wrapper"},z={key:1,class:"empty-state"},J={key:2,class:"card-view"},K={class:"documents-grid"},Q=["onClick"],X={class:"card-header"},q={class:"document-type-badge"},G={class:"card-actions"},Y=["onClick"],W={class:"card-body"},Z={class:"document-title"},$={class:"document-description"},tt={class:"creator-info"},et=["src","alt"],st={class:"creator-details"},nt={class:"creator-name"},lt={class:"creator-position"},it={class:"card-footer"},ot={class:"document-date"},rt={key:3,class:"table-view"},at={class:"documents-table"},dt=["onClick"],ct={class:"document-title-cell"},ut={class:"title-wrapper"},mt={class:"type-badge"},pt={class:"creator-cell"},ht=["src","alt"],vt={class:"table-actions"},ft=["onClick"],gt=["onClick"],bt={key:4,class:"pagination"},_t=["disabled"],yt={class:"page-numbers"},wt=["onClick"],kt=["disabled"],Dt={class:"modal-header"},Ct={class:"modal-body"},Pt={class:"document-info-section"},Mt={class:"document-title-modal"},At={class:"document-type-badge-modal"},Tt={class:"document-details"},xt={class:"detail-row"},Ft={class:"creator-info-modal"},Vt=["src","alt"],Nt={class:"creator-name-text"},St={class:"creator-position-text"},It={class:"detail-row"},Ut={class:"detail-value"},Lt={class:"detail-row description-row"},Bt={class:"description-content"},Ot={class:"detail-row description-row"},Et=["href"],jt={class:"modal-actions"},Rt=["href"];function Ht(n,t,o,r,l,i){const C=y("router-link"),P=y("a-button"),M=y("a-empty");return c(),d("div",F,[e("div",V,[t[20]||(t[20]=e("h1",null,"Văn bản công khai",-1)),e("div",N,[e("div",S,[e("button",{onClick:t[0]||(t[0]=s=>l.viewMode="card"),class:m(["view-btn",{active:l.viewMode==="card"}]),title:"Hiển thị dạng thẻ"},t[18]||(t[18]=[e("i",{class:"fas fa-th-large"},null,-1)]),2),e("button",{onClick:t[1]||(t[1]=s=>l.viewMode="table"),class:m(["view-btn",{active:l.viewMode==="table"}]),title:"Hiển thị dạng bảng"},t[19]||(t[19]=[e("i",{class:"fas fa-table"},null,-1)]),2)])])]),e("div",I,[e("div",U,[e("div",L,[t[22]||(t[22]=e("label",null,"Loại văn bản:",-1)),b(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>l.filters.documentType=s),onChange:t[3]||(t[3]=(...s)=>i.applyFilters&&i.applyFilters(...s)),class:"filter-select"},[t[21]||(t[21]=e("option",{value:""},"Tất cả loại",-1)),(c(!0),d(h,null,v(l.documentTypes,s=>(c(),d("option",{key:s.id,value:s.id},a(s.name),9,B))),128))],544),[[k,l.filters.documentType]])]),e("div",O,[t[24]||(t[24]=e("label",null,"Đơn vị ban hành:",-1)),b(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>l.filters.department=s),onChange:t[5]||(t[5]=(...s)=>i.applyFilters&&i.applyFilters(...s)),class:"filter-select"},[t[23]||(t[23]=e("option",{value:""},"Tất cả đơn vị",-1)),(c(!0),d(h,null,v(l.departments,s=>(c(),d("option",{key:s.id,value:s.id},a(s.name),9,E))),128))],544),[[k,l.filters.department]])]),e("div",j,[t[26]||(t[26]=e("label",null,"Tìm kiếm theo tên:",-1)),e("div",R,[t[25]||(t[25]=e("i",{class:"fas fa-search"},null,-1)),b(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>l.filters.search=s),onInput:t[7]||(t[7]=(...s)=>i.debounceSearch&&i.debounceSearch(...s)),type:"text",placeholder:"Nhập từ khóa...",class:"search-input"},null,544),[[T,l.filters.search]])])]),e("button",{onClick:t[8]||(t[8]=(...s)=>i.clearFilters&&i.clearFilters(...s)),class:"btn-clear-filter"},t[27]||(t[27]=[e("i",{class:"fas fa-times"},null,-1),u(" Xóa bộ lọc ")]))])]),l.loading?(c(),d("div",H,t[28]||(t[28]=[e("div",{class:"spinner"},null,-1),e("p",null,"Đang tải dữ liệu...",-1)]))):l.filteredDocuments.length===0?(c(),d("div",z,[_(M,{image:"https://gw.alipayobjects.com/mdn/miniapp_social/afts/img/A*pevERLJC9v0AAAAAAAAAAABjAQAAAQ/original","image-style":{height:"60px"}},{description:f(()=>t[29]||(t[29]=[e("span",null," Chưa có văn bản nào được phê duyệt. Hãy tạo văn bản mới để bắt đầu. ",-1)])),default:f(()=>[_(P,{type:"primary"},{default:f(()=>[_(C,{class:"text-decoration-none",to:"documents/create"},{default:f(()=>t[30]||(t[30]=[u("Tạo mới ")])),_:1})]),_:1})]),_:1})])):l.viewMode==="card"?(c(),d("div",J,[e("div",K,[(c(!0),d(h,null,v(i.paginatedDocuments,s=>(c(),d("div",{key:s.id,class:"document-card",onClick:p=>i.viewDocument(s)},[e("div",X,[e("div",q,a(s.document_type.name),1),e("div",G,[e("button",{onClick:w(p=>i.downloadDocument(s),["stop"]),class:"btn-icon",title:"Tải xuống"},t[31]||(t[31]=[e("i",{class:"fas fa-download"},null,-1)]),8,Y)])]),e("div",W,[e("h3",Z,a(s.title),1),e("p",$,a(i.truncateText(s.description,100)),1),e("div",tt,[e("img",{src:i.getAvatarUrl(s.creator),alt:s.creator.name,class:"creator-avatar"},null,8,et),e("div",st,[e("p",nt,a(s.creator.name),1),e("p",lt,a(s.creator.position),1)])])]),e("div",it,[e("span",ot,[t[32]||(t[32]=e("i",{class:"far fa-calendar"},null,-1)),u(" "+a(i.formatDate(s.created_at)),1)])])],8,Q))),128))])])):l.viewMode==="table"?(c(),d("div",rt,[e("table",at,[e("thead",null,[e("tr",null,[e("th",{onClick:t[9]||(t[9]=s=>i.sortBy("title")),class:"sortable"},[t[33]||(t[33]=u(" Tiêu đề ")),e("i",{class:m(i.getSortIcon("title"))},null,2)]),e("th",{onClick:t[10]||(t[10]=s=>i.sortBy("document_type.name")),class:"sortable"},[t[34]||(t[34]=u(" Loại văn bản ")),e("i",{class:m(i.getSortIcon("document_type.name"))},null,2)]),t[36]||(t[36]=e("th",null,"Người ban hành",-1)),t[37]||(t[37]=e("th",null,"Đơn vị",-1)),e("th",{onClick:t[11]||(t[11]=s=>i.sortBy("created_at")),class:"sortable"},[t[35]||(t[35]=u(" Ngày ban hành ")),e("i",{class:m(i.getSortIcon("created_at"))},null,2)]),t[38]||(t[38]=e("th",null,"Thao tác",-1))])]),e("tbody",null,[(c(!0),d(h,null,v(i.paginatedDocuments,s=>(c(),d("tr",{key:s.id,onClick:p=>i.viewDocument(s),class:"table-row"},[e("td",ct,[e("div",ut,[t[39]||(t[39]=e("i",{class:"fas fa-file-alt"},null,-1)),u(" "+a(s.title),1)])]),e("td",null,[e("span",mt,a(s.document_type.name),1)]),e("td",null,[e("div",pt,[e("img",{src:i.getAvatarUrl(s.creator),alt:s.creator.name,class:"creator-avatar-small"},null,8,ht),u(" "+a(s.creator.name),1)])]),e("td",null,a(i.getDepartmentFromPosition(s.creator.position)),1),e("td",null,a(i.formatDate(s.created_at)),1),e("td",{onClick:t[12]||(t[12]=w(()=>{},["stop"]))},[e("div",vt,[e("button",{onClick:p=>i.viewDocument(s),class:"btn-action",title:"Xem chi tiết"},t[40]||(t[40]=[e("i",{class:"fas fa-eye"},null,-1)]),8,ft),e("button",{onClick:p=>i.downloadDocument(s),class:"btn-action",title:"Tải xuống"},t[41]||(t[41]=[e("i",{class:"fas fa-download"},null,-1)]),8,gt)])])],8,dt))),128))])])])):g("",!0),i.totalPages>1?(c(),d("div",bt,[e("button",{onClick:t[13]||(t[13]=s=>l.currentPage=l.currentPage-1),disabled:l.currentPage===1,class:"page-btn"},t[42]||(t[42]=[e("i",{class:"fas fa-chevron-left"},null,-1)]),8,_t),e("div",yt,[(c(!0),d(h,null,v(i.visiblePages,s=>(c(),d("button",{key:s,onClick:p=>l.currentPage=s,class:m(["page-number",{active:l.currentPage===s}])},a(s),11,wt))),128))]),e("button",{onClick:t[14]||(t[14]=s=>l.currentPage=l.currentPage+1),disabled:l.currentPage===i.totalPages,class:"page-btn"},t[43]||(t[43]=[e("i",{class:"fas fa-chevron-right"},null,-1)]),8,kt)])):g("",!0),l.selectedDocument?(c(),d("div",{key:5,class:"modal-overlay",onClick:t[17]||(t[17]=(...s)=>i.closeModal&&i.closeModal(...s))},[e("div",{class:"modal-content",onClick:t[16]||(t[16]=w(()=>{},["stop"]))},[e("div",Dt,[t[45]||(t[45]=e("h2",null,"Chi tiết văn bản",-1)),e("button",{onClick:t[15]||(t[15]=(...s)=>i.closeModal&&i.closeModal(...s)),class:"btn-close"},t[44]||(t[44]=[e("i",{class:"fas fa-times"},null,-1)]))]),e("div",Ct,[e("div",Pt,[e("h3",Mt,a(l.selectedDocument.title),1),e("div",At,a(l.selectedDocument.document_type.name),1)]),e("div",Tt,[e("div",xt,[t[46]||(t[46]=e("label",null,"Người ban hành:",-1)),e("div",Ft,[e("img",{src:i.getAvatarUrl(l.selectedDocument.creator),alt:l.selectedDocument.creator.name,class:"creator-avatar-modal"},null,8,Vt),e("div",null,[e("span",Nt,a(l.selectedDocument.creator.name),1),e("span",St,a(l.selectedDocument.creator.position),1)])])]),e("div",It,[t[47]||(t[47]=e("label",null,"Ngày ban hành:",-1)),e("span",Ut,a(i.formatDate(l.selectedDocument.created_at)),1)]),e("div",Lt,[t[48]||(t[48]=e("label",null,"Mô tả:",-1)),e("p",Bt,a(l.selectedDocument.description),1)]),e("div",Ot,[t[49]||(t[49]=e("label",null,"Chứng chỉ số:",-1)),e("a",{href:`${l.apiUrl}/documents/certificates/${l.selectedDocument.certificate_path}`,target:"_blank",class:"text-decoration-none fst-italic"}," Mở ",8,Et)])]),e("div",jt,[e("a",{href:`${l.apiUrl}/documents/${l.selectedDocument.file_path}`,target:"_blank",class:"btn-view-external"},t[50]||(t[50]=[e("i",{class:"fas fa-external-link-alt"},null,-1),u(" Mở trong tab mới ")]),8,Rt)])])])])):g("",!0)])}const Jt=A(x,[["render",Ht],["__scopeId","data-v-af6af808"]]);export{Jt as N};
