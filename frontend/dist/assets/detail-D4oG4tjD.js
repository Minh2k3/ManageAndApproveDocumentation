import{u as ut}from"./use-menu-Ch1M1A0s.js";import{a0 as pt,g as v,G as O,_ as mt,e as vt,c as r,a as t,b as i,d as l,r as k,I as u,N as g,x as m,q as p,F as q,T as W,z as bt,s as ft,C as ht,U as yt,i as _t,t as gt,k as wt,H as j,m as kt,M as G,o,u as Z}from"./index-CoRCteip.js";import{u as Ct}from"./document-store-Cfsn0uBy.js";import{P as Tt}from"./PDFViewer-D58croor.js";import{N as Nt,r as jt}from"./ProgressDocument-Dpum7Iqu.js";const St=pt("certificate",()=>{const s=v([]),e=v(!1),b=v(null);async function K(w=!1,d=null){if(!(e.value&&!w))try{const N=await O.get(`/api/users/${d}/certificates`);N.data&&(s.value=N.data.certificates,e.value=!0)}catch(N){console.error("Error fetching certificate:",N)}}async function J(w){try{const d=await O.post("/api/certificates/request-issue-certificate",{user_id:w});if(console.log("response request issue certificate: ",d.data),d.data)return d.data}catch(d){console.error("Error requesting issue certificate:",d)}}async function P(w){try{const d=await O.post("/api/certificates/request-extend-certificate",{certificate_id:w});if(console.log("response request extend certificate: ",d.data),d.data)return d.data}catch(d){console.error("Error requesting extend certificate:",d)}}async function S(w){try{const d=await O.get(`api/document-certificate-id/${w}`);return d.data?(console.log("Certificate found:",d.data.certificate),b.value=d.data,d.data.certificate):(console.warn("No certificate found with code:",code),null)}catch(d){throw console.error("Error fetching certificate by code:",d),d}}function h(){s.value=[],e.value=!1}return{certificates:s,fetchCertificates:K,currentCertificate:b,findCertificateByDocumentId:S,requestIssueCertificate:J,requestExtendCertificate:P,resetCertificates:h}}),Vt=vt({components:{PDFViewer:Tt,NestedProgressSteps:Nt},setup(){W.extend(jt);const s=v("document"),e=v(!1);ut().onSelectedKeys(["approver-documents-detail"]);const b=Ct(),K=St(),P=bt().user,S=yt(),h=v([]),w=v(""),d=v([]),N=v([]),_=v([]),y=ft([]),E=ht(()=>y.value.length>0?y.value[0].version+1:1),U=v(!1),A=v(""),T=parseInt(S.params.id);_t(async()=>{const a=S.query.from_me==="1";await b.fetchDocumentById(T,a),h.value=b.current_document,console.log("Document Data:",h.value),await b.getDocumentVersions(T),y.value=gt(b.current_document_versions);for(let f=0;f<y.value.length;f++)y.value[f].document_data=JSON.parse(y.value[f].document_data);if(console.log("Document versions: ",y.value),w.value=h.value.file_path,await b.fetchDocumentComments(T),N.value=b.document_comments,await b.fetchStepsByDocumentFlowId(h.value.document_flow_id),_.value=b.current_document_flow_steps,_.value.is_completed){await b.createCertificate(T),U.value=!0;const f=await K.findCertificateByDocumentId(T);console.log("Certificate found:",f),A.value=f?f.file_path:""}await b.fetchDocumentTypes(),d.value=b.document_types,console.log(d.value)});const C=v(""),M="http://localhost:8000",F=a=>a?`${M}/images/avatars/${a}`:null,V=v(!1),n=v(!1),D=async()=>{const a=parseInt(h.value.document_flow_step_id);console.log("Step ID:",a),V.value=!0,n.value=!0;try{console.log("Approve response version:",y.value[0].id),await b.signDocument(y.value[0].id,a,T),await b.approveDocument(a),j.success("Bạn vừa đồng ý phê duyệt"),window.location.reload()}catch(f){j.error("Có lỗi xảy ra khi đồng ý phê duyệt văn bản"),console.error("Error approving document:",f)}finally{V.value=!1,n.value=!1}},c=v(!1),x=v(""),tt=async()=>{if(x.value.trim()===""){j.error("Vui lòng nhập lý do từ chối");return}const a={document_version_id:h.value.version_id,reason:x.value},f=parseInt(h.value.document_flow_step_id);console.log("Rejecting document with data:",a),console.log("Step ID:",f),V.value=!0,n.value=!0;try{await b.rejectDocument(f,a),window.location.reload(),j.success("Bạn vừa từ chối văn bản với lý do: "+x.value)}catch(I){j.error("Có lỗi xảy ra khi từ chối văn bản"),console.error("Error rejecting document:",I)}finally{c.value=!1,V.value=!1,n.value=!1}},et=async()=>{c.value=!0},L=v(null),B=v("Nhận xét"),st=async()=>{console.log("Comment clicked"),e.value=!e.value,s.value!=="comment"?(s.value="comment",B.value="Văn bản",await kt(),L.value.focus()):(s.value="document",B.value="Nhận xét")};wt(s,a=>{a!=="comment"?(e.value=!1,B.value="Nhận xét"):(e.value=!0,B.value="Văn bản")});const H=v(!1),nt=(a,f=null)=>{try{H.value=!0;const I=`http://localhost:8000/documents/${a}`,$=document.createElement("a");$.href=I,$.download=f||a.split("/").pop(),$.style.display="none",document.body.appendChild($),$.click(),document.body.removeChild($),j.success("Đang tải file..."),setTimeout(()=>{H.value=!1},2e3)}catch(I){console.error("Error downloading file:",I),j.error("Có lỗi xảy ra khi tải file!"),H.value=!1}},X=v(!1),ot=async()=>{if(C.value===""){j.error("Vui lòng nhập bình luận");return}X.value=!0;try{const a=parseInt(S.params.id);await axios.post(`/api/documents/${a}/comments`,{creator_id:h.value.creator_id,comment:C.value,document_flow_step_id:parseInt(h.value.document_flow_step_id)}),j.success("Nhận xét gửi thành công"),await b.fetchDocumentComments(a),N.value=b.document_comments,C.value=""}catch(a){j.error("Có lỗi xảy ra khi gửi nhận xét"),console.error("Error sending comment:",a)}finally{X.value=!1,L.value.focus()}},lt=()=>{G.info({title:"Thông báo",content:i("p",null,"Chưa đến lượt bạn phê duyệt văn bản này."),okText:"Đóng"})},it=()=>{G.info({title:"Thông báo",content:i("p",null,"Bạn đã phê duyệt văn bản này rồi!"),okText:"Đóng"})},at=()=>{G.info({title:"Thông báo",content:i("p",null,"Bạn đã từ chối văn bản này rồi!"),okText:"Đóng"})},dt=a=>a>100||a==null?"https://avatar.iran.liara.run/public":`https://avatar.iran.liara.run/public/${a}`,rt=async()=>{L.value.focus()},ct=[{title:"Bản",dataIndex:"version",key:"version",width:60,customRender:({version:a})=>a+1,align:"center"},{title:"Tên văn bản",dataIndex:"title",key:"title",width:200,customHeaderCell:()=>({style:{textAlign:"center"}})},{title:"Loại văn bản",dataIndex:"type",key:"type",width:150,align:"center",responsive:["xxl"]},{title:"Trạng thái",dataIndex:"status",key:"status",width:100,align:"center"},{title:"Ngày tạo",dataIndex:"created_at",key:"created_at",width:150,align:"center"},{title:"Thao tác",key:"action",width:150,align:"center",fixed:"right"}],Y=a=>{const f=d.value.find(I=>I.value===a);return f?f.label:"Không xác định"},R=v([]),z=v({visible:!1,title:"",description:"",type:"",version:0,file_path:""}),Q=a=>{console.log("Changing version to:",a),R.value=JSON.parse(JSON.stringify(a.document_data)),console.log("Version data:",R.value),z.value={visible:!0,title:R.value.title,description:R.value.description,type:Y(R.value.document_type_id),version:a.version,file_path:R.value.file_path}};return{user:P,document:h,pdfUrl:w,activeKey:s,commentSection:e,comment:C,document_comments:N,dayjs:W,btnCommentText:B,commentTextarea:L,loadingSendComment:X,isDownloading:H,btnApproveDisabled:V,btnRejectDisabled:n,rejectVisible:c,reasonReject:x,document_flow_steps:_,show_certificate:U,certificate_file_path:A,getAvatarUrl:F,randomAvatar:dt,handleClickApprove:D,handleClickReject:et,handleClickComment:st,handleClickDownload:nt,handleSendComment:ot,handleClickNotYourTurn:lt,handleRejectDocument:tt,handleClickApproved:it,handleClickRejected:at,handleFocusCommentInput:rt,version_columns:ct,max_version:E,document_versions:y,detailVersion:z,mapTypeIdToName:Y,changeVersion:Q,customRow:a=>({onClick:()=>{Q(a)},style:{cursor:"pointer"}}),createNewVersion:a=>{G.confirm({title:"Tạo phiên bản mới",content:"Bạn có chắc chắn muốn tạo phiên bản mới từ phiên bản này?",okText:"Tạo mới",cancelText:"Hủy",onOk:()=>{try{console.log(a.document_data),a.document_data.version=a.status==="draft"?0:a.version,b.setCurrentDocumentData(a.document_data),router.push({name:"approver-documents-create"})}catch(f){console.error("Error creating new version:",f),j.error("Có lỗi xảy ra khi tạo phiên bản mới")}},onCancel:()=>{console.log("Create new version cancelled")}})}}}}),xt={class:"container-fluid"},Dt={key:0},It={class:"container py-1"},Rt={class:"row justify-content-between gap-3"},$t={class:"col-xl-7"},Ut={class:"row"},At={class:"col text-end mb-2 mb-xl-0 align-self-top ps-3 pt-1"},Bt=["href"],qt={key:0,class:"row"},Kt={class:"col text-end mb-2 mb-xl-0 align-self-top ps-3 pt-1"},Pt=["href"],Et={key:1,class:"row"},Mt={class:"col text-end mb-2 mb-xl-0 align-self-top ps-3 pt-1"},Ft=["href"],Lt={class:"col"},Ht={class:"row mb-3"},Ot={class:"d-flex justify-content-center"},Gt={class:"fs-5 fw-bold"},Jt={class:"row mb-3 border-1 border border-dark rounded-3 bg-light py-1"},Xt={class:"col align-self-center"},Yt={class:"col-10"},zt={class:"row"},Qt={class:"fw-bold"},Wt={class:"row"},Zt={class:"text-muted"},te={class:"row text-end"},ee={class:"text-muted"},se={key:1,class:"row mb-3"},ne={class:"col d-flex justify-content-center"},oe={class:"row mb-3"},le={key:0},ie={class:""},ae={class:""},de={key:2,class:""},re={class:"col-xl"},ce={key:0,class:"row border-1 rounded-3 p-4 mb-4 bg-light"},ue={class:"col"},pe={class:"row mb-3"},me={class:"col"},ve={class:"row mb-3"},be={class:"col"},fe={class:"row border-1 rounded-3 p-4 mb-4 bg-light"},he={class:"col"},ye={class:"row mt-3"},_e={class:"col-8"},ge={class:"row mt-3"},we={class:"col-8"},ke={class:"row mt-3"},Ce={class:"col-8"},Te={class:"d-flex"},Ne={class:"row mt-3"},je={class:"col-12 mt-1"},Se={class:"row mt-3"},Ve={class:"col-8"},xe={class:"row border-1 rounded-3 p-4 mb-4 bg-light"},De={class:"col"},Ie={class:"row mb-3"},Re={class:"text-center"},$e={key:0,class:"fst-italic text-success"},Ue={key:1,class:"fst-italic text-danger"},Ae={key:2,class:"fst-italic text-secondary"},Be={key:1},qe={class:"container py-1"},Ke={class:"row justify-content-between gap-3"},Pe={class:"col-xl-7"},Ee={class:"row"},Me={class:"col text-end mb-2 mb-xl-0 align-self-top ps-3 pt-1"},Fe=["href"],Le={key:0,class:"row"},He={class:"col text-end mb-2 mb-xl-0 align-self-top ps-3 pt-1"},Oe=["href"],Ge={key:1,class:"row"},Je={class:"col text-end mb-2 mb-xl-0 align-self-top ps-3 pt-1"},Xe=["href"],Ye={class:"col"},ze={class:"row mb-3"},Qe={class:"d-flex justify-content-center"},We={class:"fs-5 fw-bold"},Ze={class:"row mb-3 border-1 border border-dark rounded-3 bg-light py-1"},ts={class:"col align-self-center"},es={class:"col-10"},ss={class:"row"},ns={class:"fw-bold"},os={class:"row"},ls={class:"text-muted"},is={class:"row text-end"},as={class:"text-muted"},ds={key:1,class:"row mb-3"},rs={class:"col d-flex justify-content-center"},cs={class:"row mb-3"},us={key:0},ps={class:""},ms={class:""},vs={key:2,class:""},bs={class:"col-xl"},fs={class:"row border-1 rounded-3 p-4 mb-4 bg-light"},hs={class:"col"},ys={key:0,class:"row mb-3"},_s={class:"col"},gs=["disabled"],ws={class:"col"},ks=["disabled"],Cs={key:1,class:"row mb-3"},Ts={class:"col"},Ns={key:2,class:"row mb-3"},js={class:"col"},Ss={key:3,class:"row mb-3"},Vs={class:"col"},xs={class:"row mb-3"},Ds={class:"col"},Is={class:"col"},Rs=["disabled"],$s={key:0},Us={key:1},As={key:0,class:"row border-1 rounded-3 p-4 mb-4 bg-light"},Bs={class:"col"},qs={class:"row mb-3"},Ks={class:"col"},Ps={class:"row mb-3"},Es={class:"col"},Ms=["disabled"],Fs={key:0},Ls={key:1},Hs={class:"row border-1 rounded-3 p-4 mb-4 bg-light"},Os={class:"col"},Gs={class:"row mt-3"},Js={class:"col-8"},Xs={class:"row mt-3"},Ys={class:"col-8"},zs={class:"row mt-3"},Qs={class:"col-8"},Ws={class:"d-flex"},Zs={class:"row mt-3"},tn={class:"col-12 mt-1"},en={class:"row mt-3"},sn={class:"col-8"},nn={class:"row border-1 rounded-3 p-4 mb-4 bg-light"},on={class:"col"},ln={class:"row mb-3"},an={class:"text-center"},dn={key:0,class:"fst-italic text-success"},rn={key:1,class:"fst-italic text-danger"},cn={key:2,class:"fst-italic text-secondary"},un={class:"modal-content"},pn={class:"modal-body"},mn={class:"info-grid"},vn={class:"info-item"},bn={class:"info-value"},fn={class:"info-item"},hn={class:"info-value"},yn={class:"info-row"},_n={class:"info-item half"},gn={class:"info-value"},wn={class:"document-type-badge"},kn={class:"info-item half"},Cn={class:"info-value"},Tn={class:"version-badge"},Nn={class:"info-item"},jn={class:"info-value"},Sn=["href"],Vn={class:"modal-footer"};function xn(s,e,b,K,J,P){const S=k("PDFViewer"),h=k("a-tab-pane"),w=k("a-avatar"),d=k("a-button"),N=k("a-empty"),_=k("a-tooltip"),y=k("a-tag"),E=k("a-space"),U=k("a-table"),A=k("a-tabs"),T=k("a-textarea"),C=k("a-input"),M=k("NestedProgressSteps"),F=k("a-divider"),V=k("a-modal");return o(),r(q,null,[t("div",xt,[e[88]||(e[88]=t("h2",{class:"fw-bold mb-3"},"Chi tiết văn bản",-1)),s.document.from_me?(o(),r("div",Dt,[t("div",It,[t("div",Rt,[t("div",$t,[i(A,{activeKey:s.activeKey,"onUpdate:activeKey":e[0]||(e[0]=n=>s.activeKey=n),type:"card",class:"row border-1 rounded-3 p-4 mb-2 bg-light"},{default:l(()=>[i(h,{key:"document",tab:"Văn bản"},{default:l(()=>[t("div",Ut,[t("div",At,[t("label",null,[t("a",{href:`http://localhost:8000/documents/${s.document.file_path}`,target:"_blank",class:"text-decoration-none fst-italic"}," Mở tệp trong tab mới ",8,Bt)])])]),s.show_certificate?(o(),r("div",qt,[t("div",Kt,[t("label",null,[t("a",{href:`http://localhost:8000/documents/certificates/${s.document.certificate_path}`,target:"_blank",class:"text-decoration-none fst-italic"}," Chứng chỉ số ",8,Pt)])])])):u("",!0),s.show_certificate?(o(),r("div",Et,[t("div",Mt,[t("label",null,[t("a",{href:`http://localhost:8000/documents/certificates/${s.certificate_file_path}`,target:"_blank",class:"text-decoration-none fst-italic"}," Văn bản đã ký số ",8,Ft)])])])):u("",!0),t("div",null,[t("div",Lt,[t("div",Ht,[t("div",Ot,[e[28]||(e[28]=t("span",{class:"fs-5"},"Tên tài liệu:",-1)),e[29]||(e[29]=g("   ")),t("span",Gt,p(s.document.title),1)])])]),t("div",null,[i(S,{"pdf-url":s.pdfUrl},null,8,["pdf-url"])])])]),_:1}),i(h,{key:"comment",tab:`Nhận xét (${s.document_comments.total_current_comments})`,"force-render":""},{default:l(()=>[s.document_comments.total_current_comments>0?(o(!0),r(q,{key:0},Z(s.document_comments.current_comments,(n,D)=>(o(),r("div",{key:D},[t("div",Jt,[t("div",Xt,[n.user.avatar?(o(),m(w,{key:0,class:"",src:s.getAvatarUrl(n.user.avatar)},null,8,["src"])):(o(),m(w,{key:1,class:"",src:s.randomAvatar(n.user.id),alt:"Random Avatar"},null,8,["src"]))]),t("div",Yt,[t("div",zt,[t("span",Qt,p(n.user.id===s.user.id?`Tôi (${n.user.name})`:n.user.name),1)]),t("div",Wt,[t("span",Zt,p(n.content),1)]),t("div",te,[t("span",ee,p(n.commented_at),1)])])])]))),128)):(o(),r("div",se,[t("div",ne,[i(N,{image:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTNvPNFo6a-PV4l-vMo8Hcsoj5rRr2I5XIJUQ&s","image-style":{height:"50px"}},{description:l(()=>e[30]||(e[30]=[t("span",{class:"fw-bold fs-5"},"Chưa có bình luận nào",-1),t("br",null,null,-1),t("span",null,"Hãy là người đầu tiên chia sẻ ý kiến về văn bản này",-1)])),default:l(()=>[i(d,{type:"primary",onClick:s.handleFocusCommentInput},{default:l(()=>e[31]||(e[31]=[g("Nhận xét ngay")])),_:1},8,["onClick"])]),_:1})])]))]),_:1},8,["tab"]),i(h,{key:"versions",tab:`Phiên bản (${s.document.version_count})`},{default:l(()=>[e[40]||(e[40]=t("div",{class:"row mb-3"},[t("h4",{class:"fw-bold"},"Các phiên bản")],-1)),t("div",oe,[i(U,{dataSource:s.document_versions,columns:s.version_columns,scroll:{x:576},bordered:"",customRow:s.customRow,showSorterTooltip:!1,locale:{triggerDesc:"Nhấn để sắp xếp giảm dần",triggerAsc:"Nhấn để sắp xếp tăng dần",cancelSort:"Nhấn để hủy sắp xếp"}},{headerCell:l(({column:n})=>[n.key==="title"?(o(),m(_,{key:0,title:"Sắp xếp theo tên văn bản"},{default:l(()=>[t("span",null,p(n.title),1)]),_:2},1024)):n.key==="status"?(o(),m(_,{key:1,title:"Sắp xếp theo trạng thái"},{default:l(()=>[t("span",null,p(n.title),1)]),_:2},1024)):n.key==="created_at"?(o(),m(_,{key:2,title:"Sắp xếp theo ngày tạo"},{default:l(()=>[t("span",null,p(n.title),1)]),_:2},1024)):u("",!0)]),bodyCell:l(({column:n,index:D,record:c})=>[n.key==="version"?(o(),r("span",le,p(c.version),1)):u("",!0),n.key==="title"?(o(),m(_,{key:1},{title:l(()=>[t("span",ie,p(c.document_data.description),1)]),default:l(()=>[t("span",ae,p(c.document_data.title),1)]),_:2},1024)):u("",!0),n.key==="type"?(o(),r("span",de,p(s.mapTypeIdToName(c.document_data.document_type_id)),1)):u("",!0),n.key==="status"?(o(),r(q,{key:3},[c.status==="approved"?(o(),m(y,{key:0,color:"green"},{default:l(()=>e[32]||(e[32]=[t("span",null,"Đã duyệt",-1)])),_:1})):u("",!0),c.status==="in_review"?(o(),m(y,{key:1,color:"orange"},{default:l(()=>e[33]||(e[33]=[t("span",null,"Chờ duyệt",-1)])),_:1})):u("",!0),c.status==="rejected"?(o(),m(y,{key:2,color:"red"},{default:l(()=>e[34]||(e[34]=[t("span",null,"Bị từ chối",-1)])),_:1})):u("",!0),c.status==="draft"?(o(),m(y,{key:3,color:"blue"},{default:l(()=>e[35]||(e[35]=[t("span",null,"Bản nháp",-1)])),_:1})):u("",!0)],64)):u("",!0),n.key==="action"?(o(),m(E,{key:4,class:"d-flex justify-content-center gap-3"},{default:l(()=>[i(_,null,{title:l(()=>e[36]||(e[36]=[t("span",{class:""},"Xem chi tiết",-1)])),default:l(()=>[i(d,{onClick:x=>s.changeVersion(c),class:"bg-primary text-white"},{default:l(()=>e[37]||(e[37]=[t("i",{class:"bi bi-eye"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024),c.status==="rejected"&&c.version===s.max_version||c.status==="draft"?(o(),m(_,{key:0},{title:l(()=>e[38]||(e[38]=[t("span",{class:""},"Tạo phiên bản mới",-1)])),default:l(()=>[i(d,{onClick:x=>s.createNewVersion(c),class:"bg-success text-white"},{default:l(()=>e[39]||(e[39]=[t("i",{class:"bi bi-plus-circle"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024)):u("",!0)]),_:2},1024)):u("",!0)]),_:1},8,["dataSource","columns","customRow"])])]),_:1},8,["tab"])]),_:1},8,["activeKey"])]),t("div",re,[s.commentSection?(o(),r("div",ce,[t("div",ue,[e[42]||(e[42]=t("div",{class:"row mb-3"},[t("div",{class:"col d-flex justify-content-center"},[t("span",{class:"fs-5 fw-bold"},"Nhận xét")])],-1)),t("div",pe,[t("div",me,[i(T,{placeholder:"Nhập nhận xét của bạn",value:s.comment,"onUpdate:value":e[1]||(e[1]=n=>s.comment=n),"show-count":"",maxlength:1e3,ref:"commentTextarea"},null,8,["value"])])]),t("div",ve,[t("div",be,[t("button",{class:"border border-2 rounded-2 w-100 py-2 bg-secondary text-white button-click-effect",style:{"--bs-bg-opacity":".9"},onClick:e[2]||(e[2]=(...n)=>s.handleSendComment&&s.handleSendComment(...n))},e[41]||(e[41]=[t("span",null,[t("i",{class:"bi bi-chat-square-dots me-2"}),g("Gửi bình luận ")],-1)]))])])])])):u("",!0),t("div",fe,[t("div",he,[e[50]||(e[50]=t("div",{class:"row mb-3"},[t("div",{class:"col d-flex justify-content-center"},[t("span",{class:"fs-5 fw-bold"},"Thông tin văn bản")])],-1)),t("div",ye,[e[44]||(e[44]=t("div",{class:"col text-start mb-2 mb-xl-0 align-self-center ps-3"},[t("label",null,[t("span",null,"Người tạo:")])],-1)),t("div",_e,[i(C,{value:s.document.creator_name,"onUpdate:value":e[3]||(e[3]=n=>s.document.creator_name=n),placeholder:"Văn bản số 1",disabled:""},null,8,["value"]),e[43]||(e[43]=t("div",{class:"w-100"},null,-1))])]),t("div",ge,[e[46]||(e[46]=t("div",{class:"col text-start mb-2 mb-xl-0 align-self-center ps-3"},[t("label",null,[t("span",null,"Tên văn bản:")])],-1)),t("div",we,[i(C,{value:s.document.title,"onUpdate:value":e[4]||(e[4]=n=>s.document.title=n),placeholder:"Văn bản số 1",disabled:""},null,8,["value"]),e[45]||(e[45]=t("div",{class:"w-100"},null,-1))])]),t("div",ke,[e[47]||(e[47]=t("div",{class:"col text-start mb-2 mb-xl-0 align-self-center ps-3"},[t("label",null,[t("span",null,"Loại văn bản:")])],-1)),t("div",Ce,[t("div",Te,[i(C,{value:s.document.type,"onUpdate:value":e[5]||(e[5]=n=>s.document.type=n),placeholder:"Love",disabled:""},null,8,["value"])])])]),t("div",Ne,[e[48]||(e[48]=t("div",{class:"col text-start mb-2 mb-xl-0 align-self-center ps-3"},[t("label",null,[t("span",null,"Mô tả:")])],-1)),t("div",je,[i(T,{placeholder:"Mô tả đơn giản",value:s.document.description,"onUpdate:value":e[6]||(e[6]=n=>s.document.description=n),"show-count":"",maxlength:1e3,disabled:""},null,8,["value"])])]),t("div",Se,[e[49]||(e[49]=t("div",{class:"col text-start mb-2 mb-xl-0 align-self-center ps-3"},[t("label",null,[t("span",null,"Ngày tạo:")])],-1)),t("div",Ve,[i(C,{value:s.document.created_at,"onUpdate:value":e[7]||(e[7]=n=>s.document.created_at=n),placeholder:"Ngày chờ, tháng nhớ, năm mong",disabled:""},null,8,["value"])])])])]),t("div",xe,[t("div",De,[t("div",Ie,[t("div",Re,[e[51]||(e[51]=t("span",{class:"fs-5 fw-bold"},"Luồng phê duyệt",-1)),e[52]||(e[52]=t("br",null,null,-1)),s.document.status==="approved"?(o(),r("span",$e,"Đã được duyệt")):s.document.status==="rejected"?(o(),r("span",Ue,"Bị từ chối")):(o(),r("span",Ae,"Tiến độ: "+p(s.document_flow_steps.progress_percentage)+"%",1))]),s.document_flow_steps&&Object.keys(s.document_flow_steps).length>0?(o(),m(M,{key:0,steps:s.document_flow_steps},null,8,["steps"])):u("",!0)])])])])])])])):(o(),r("div",Be,[t("div",qe,[t("div",Ke,[t("div",Pe,[i(A,{activeKey:s.activeKey,"onUpdate:activeKey":e[8]||(e[8]=n=>s.activeKey=n),type:"card",class:"row border-1 rounded-3 p-4 mb-2 bg-light"},{default:l(()=>[i(h,{key:"document",tab:"Văn bản"},{default:l(()=>[t("div",Ee,[t("div",Me,[t("label",null,[t("a",{href:`http://localhost:8000/documents/${s.document.file_path}`,target:"_blank",class:"text-decoration-none fst-italic"}," Mở tệp trong tab mới ",8,Fe)])])]),s.show_certificate?(o(),r("div",Le,[t("div",He,[t("label",null,[t("a",{href:`http://localhost:8000/documents/certificates/${s.document.certificate_path}`,target:"_blank",class:"text-decoration-none fst-italic"}," Chứng chỉ số ",8,Oe)])])])):u("",!0),s.show_certificate?(o(),r("div",Ge,[t("div",Je,[t("label",null,[t("a",{href:`http://localhost:8000/documents/certificates/${s.certificate_file_path}`,target:"_blank",class:"text-decoration-none fst-italic"}," Văn bản đã ký số ",8,Xe)])])])):u("",!0),t("div",null,[t("div",Ye,[t("div",ze,[t("div",Qe,[e[53]||(e[53]=t("span",{class:"fs-5"},"Tên tài liệu:",-1)),e[54]||(e[54]=g("   ")),t("span",We,p(s.document.title),1)])])]),t("div",null,[i(S,{"pdf-url":s.pdfUrl},null,8,["pdf-url"])])])]),_:1}),i(h,{key:"comment",tab:`Nhận xét (${s.document_comments.total_current_comments})`,"force-render":""},{default:l(()=>[s.document_comments.total_current_comments>0?(o(!0),r(q,{key:0},Z(s.document_comments.current_comments,(n,D)=>(o(),r("div",{key:D},[t("div",Ze,[t("div",ts,[n.user.avatar?(o(),m(w,{key:0,class:"",src:s.getAvatarUrl(n.user.avatar)},null,8,["src"])):(o(),m(w,{key:1,class:"",src:s.randomAvatar(n.user.id),alt:"Random Avatar"},null,8,["src"]))]),t("div",es,[t("div",ss,[t("span",ns,p(n.user.id===s.user.id?`Tôi (${n.user.name})`:n.user.name),1)]),t("div",os,[t("span",ls,p(n.content),1)]),t("div",is,[t("span",as,p(n.commented_at),1)])])])]))),128)):(o(),r("div",ds,[t("div",rs,[i(N,{image:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTNvPNFo6a-PV4l-vMo8Hcsoj5rRr2I5XIJUQ&s","image-style":{height:"50px"}},{description:l(()=>e[55]||(e[55]=[t("span",{class:"fw-bold fs-5"},"Chưa có bình luận nào",-1),t("br",null,null,-1),t("span",null,"Hãy là người đầu tiên chia sẻ ý kiến về văn bản này",-1)])),default:l(()=>[i(d,{type:"primary",onClick:s.handleFocusCommentInput},{default:l(()=>e[56]||(e[56]=[g("Nhận xét ngay")])),_:1},8,["onClick"])]),_:1})])]))]),_:1},8,["tab"]),i(h,{key:"versions",tab:`Phiên bản (${s.document.version_count})`},{default:l(()=>[e[65]||(e[65]=t("div",{class:"row mb-3"},[t("h4",{class:"fw-bold"},"Các phiên bản")],-1)),t("div",cs,[i(U,{dataSource:s.document_versions,columns:s.version_columns,scroll:{x:576},bordered:"",customRow:s.customRow,showSorterTooltip:!1,locale:{triggerDesc:"Nhấn để sắp xếp giảm dần",triggerAsc:"Nhấn để sắp xếp tăng dần",cancelSort:"Nhấn để hủy sắp xếp"}},{headerCell:l(({column:n})=>[n.key==="title"?(o(),m(_,{key:0,title:"Sắp xếp theo tên văn bản"},{default:l(()=>[t("span",null,p(n.title),1)]),_:2},1024)):n.key==="status"?(o(),m(_,{key:1,title:"Sắp xếp theo trạng thái"},{default:l(()=>[t("span",null,p(n.title),1)]),_:2},1024)):n.key==="created_at"?(o(),m(_,{key:2,title:"Sắp xếp theo ngày tạo"},{default:l(()=>[t("span",null,p(n.title),1)]),_:2},1024)):u("",!0)]),bodyCell:l(({column:n,index:D,record:c})=>[n.key==="version"?(o(),r("span",us,p(c.version),1)):u("",!0),n.key==="title"?(o(),m(_,{key:1},{title:l(()=>[t("span",ps,p(c.document_data.description??"Không có mô tả"),1)]),default:l(()=>[t("span",ms,p(c.document_data.title),1)]),_:2},1024)):u("",!0),n.key==="type"?(o(),r("span",vs,p(s.mapTypeIdToName(c.document_data.document_type_id)),1)):u("",!0),n.key==="status"?(o(),r(q,{key:3},[c.status==="approved"?(o(),m(y,{key:0,color:"green"},{default:l(()=>e[57]||(e[57]=[t("span",null,"Đã duyệt",-1)])),_:1})):u("",!0),c.status==="in_review"?(o(),m(y,{key:1,color:"orange"},{default:l(()=>e[58]||(e[58]=[t("span",null,"Chờ duyệt",-1)])),_:1})):u("",!0),c.status==="rejected"?(o(),m(y,{key:2,color:"red"},{default:l(()=>e[59]||(e[59]=[t("span",null,"Bị từ chối",-1)])),_:1})):u("",!0),c.status==="draft"?(o(),m(y,{key:3,color:"blue"},{default:l(()=>e[60]||(e[60]=[t("span",null,"Bản nháp",-1)])),_:1})):u("",!0)],64)):u("",!0),n.key==="action"?(o(),m(E,{key:4,class:"d-flex justify-content-center gap-3"},{default:l(()=>[i(_,null,{title:l(()=>e[61]||(e[61]=[t("span",{class:""},"Xem chi tiết",-1)])),default:l(()=>[i(d,{onClick:x=>s.changeVersion(c),class:"bg-primary text-white"},{default:l(()=>e[62]||(e[62]=[t("i",{class:"bi bi-eye"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024),c.status==="rejected"&&c.version===s.max_version||c.status==="draft"?(o(),m(_,{key:0},{title:l(()=>e[63]||(e[63]=[t("span",{class:""},"Tạo phiên bản mới",-1)])),default:l(()=>[i(d,{onClick:x=>s.createNewVersion(c),class:"bg-success text-white"},{default:l(()=>e[64]||(e[64]=[t("i",{class:"bi bi-plus-circle"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024)):u("",!0)]),_:2},1024)):u("",!0)]),_:1},8,["dataSource","columns","customRow"])])]),_:1},8,["tab"])]),_:1},8,["activeKey"])]),t("div",bs,[t("div",fs,[t("div",hs,[e[74]||(e[74]=t("div",{class:"row mb-3"},[t("div",{class:"col d-flex justify-content-center"},[t("span",{class:"fs-5 fw-bold"},"Phê duyệt văn bản")])],-1)),s.document.step_status==="in_review"?(o(),r("div",ys,[t("div",_s,[t("button",{class:"border border-2 rounded-2 text-white bg-success w-100 py-2 button-click-effect",style:{"--bs-bg-opacity":".9"},onClick:e[9]||(e[9]=(...n)=>s.handleClickApprove&&s.handleClickApprove(...n)),disabled:s.btnApproveDisabled},e[66]||(e[66]=[t("span",null,[t("i",{class:"bi bi-check-lg me-1"}),g("Chấp thuận ")],-1)]),8,gs)]),t("div",ws,[t("button",{class:"border border-2 rounded-2 text-white bg-danger w-100 py-2 button-click-effect",style:{"--bs-bg-opacity":".9"},onClick:e[10]||(e[10]=(...n)=>s.handleClickReject&&s.handleClickReject(...n)),disabled:s.btnRejectDisabled},e[67]||(e[67]=[t("span",null,[t("i",{class:"bi bi-x-lg me-2"}),g("Từ chối ")],-1)]),8,ks)])])):s.document.step_status==="pending"?(o(),r("div",Cs,[t("div",Ts,[t("button",{class:"border border-2 rounded-2 text-white bg-warning w-100 py-2 button-click-effect",style:{"--bs-bg-opacity":"1"},onClick:e[11]||(e[11]=(...n)=>s.handleClickNotYourTurn&&s.handleClickNotYourTurn(...n))},e[68]||(e[68]=[t("span",null,[t("i",{class:"bi bi-hourglass-split me-2"}),g("Chưa đến lượt bạn đâu ")],-1)]))])])):s.document.step_status==="approved"?(o(),r("div",Ns,[t("div",js,[t("button",{class:"border border-2 rounded-2 text-white bg-success w-100 py-2 button-click-effect",style:{"--bs-bg-opacity":"1"},onClick:e[12]||(e[12]=(...n)=>s.handleClickApproved&&s.handleClickApproved(...n))},e[69]||(e[69]=[t("span",null," Bạn đã đồng ý văn bản này rồi! ",-1)]))])])):s.document.step_status==="rejected"?(o(),r("div",Ss,[t("div",Vs,[t("button",{class:"border border-2 rounded-2 text-white bg-danger w-100 py-2 button-click-effect",style:{"--bs-bg-opacity":"1"},onClick:e[13]||(e[13]=(...n)=>s.handleClickRejected&&s.handleClickRejected(...n))},e[70]||(e[70]=[t("span",null," Bạn đã từ chối văn bản này rồi! ",-1)]))])])):u("",!0),t("div",xs,[t("div",Ds,[t("button",{class:"border border-2 rounded-2 w-100 py-2 bg-secondary text-white button-click-effect",style:{"--bs-bg-opacity":".9"},onClick:e[14]||(e[14]=(...n)=>s.handleClickComment&&s.handleClickComment(...n))},[t("span",null,[e[71]||(e[71]=t("i",{class:"bi bi-chat-square-dots me-2"},null,-1)),g(p(s.btnCommentText),1)])])]),t("div",Is,[t("button",{class:"border border-2 rounded-2 w-100 py-2 text-white bg-primary button-click-effect",style:{"--bs-bg-opacity":".9"},onClick:e[15]||(e[15]=n=>s.handleClickDownload(s.document.file_path,s.document.title)),disabled:s.isDownloading},[s.isDownloading?(o(),r("span",Us,e[73]||(e[73]=[t("i",{class:"bi bi-hourglass-split me-2"},null,-1),g("Đang tải... ")]))):(o(),r("span",$s,e[72]||(e[72]=[t("i",{class:"bi bi-download me-2"},null,-1),g("Tải xuống ")])))],8,Rs)])])])]),s.commentSection?(o(),r("div",As,[t("div",Bs,[e[77]||(e[77]=t("div",{class:"row mb-3"},[t("div",{class:"col d-flex justify-content-center"},[t("span",{class:"fs-5 fw-bold"},"Nhận xét")])],-1)),t("div",qs,[t("div",Ks,[i(T,{placeholder:"Nhập nhận xét của bạn",value:s.comment,"onUpdate:value":e[16]||(e[16]=n=>s.comment=n),"show-count":"",maxlength:1e3,ref:"commentTextarea"},null,8,["value"])])]),t("div",Ps,[t("div",Es,[t("button",{class:"border border-2 rounded-2 w-100 py-2 bg-secondary text-white button-click-effect",style:{"--bs-bg-opacity":".9"},onClick:e[17]||(e[17]=(...n)=>s.handleSendComment&&s.handleSendComment(...n)),disabled:s.loadingSendComment},[s.loadingSendComment?(o(),r("span",Fs,e[75]||(e[75]=[t("i",{class:"spinner-border spinner-border-sm me-2"},null,-1),g(" Đang gửi nhận xét... ")]))):(o(),r("span",Ls,e[76]||(e[76]=[t("i",{class:"bi bi-chat-square-dots me-2"},null,-1),g("Gửi nhận xét ")])))],8,Ms)])])])])):u("",!0),t("div",Hs,[t("div",Os,[e[85]||(e[85]=t("div",{class:"row mb-3"},[t("div",{class:"col d-flex justify-content-center"},[t("span",{class:"fs-5 fw-bold"},"Thông tin văn bản")])],-1)),t("div",Gs,[e[79]||(e[79]=t("div",{class:"col text-start mb-2 mb-xl-0 align-self-center ps-3"},[t("label",null,[t("span",null,"Người tạo:")])],-1)),t("div",Js,[i(C,{value:s.document.creator_name,"onUpdate:value":e[18]||(e[18]=n=>s.document.creator_name=n),placeholder:"Văn bản số 1",disabled:""},null,8,["value"]),e[78]||(e[78]=t("div",{class:"w-100"},null,-1))])]),t("div",Xs,[e[81]||(e[81]=t("div",{class:"col text-start mb-2 mb-xl-0 align-self-center ps-3"},[t("label",null,[t("span",null,"Tên văn bản:")])],-1)),t("div",Ys,[i(C,{value:s.document.title,"onUpdate:value":e[19]||(e[19]=n=>s.document.title=n),placeholder:"Văn bản số 1",disabled:""},null,8,["value"]),e[80]||(e[80]=t("div",{class:"w-100"},null,-1))])]),t("div",zs,[e[82]||(e[82]=t("div",{class:"col text-start mb-2 mb-xl-0 align-self-center ps-3"},[t("label",null,[t("span",null,"Loại văn bản:")])],-1)),t("div",Qs,[t("div",Ws,[i(C,{value:s.document.type,"onUpdate:value":e[20]||(e[20]=n=>s.document.type=n),placeholder:"Love",disabled:""},null,8,["value"])])])]),t("div",Zs,[e[83]||(e[83]=t("div",{class:"col text-start mb-2 mb-xl-0 align-self-center ps-3"},[t("label",null,[t("span",null,"Mô tả:")])],-1)),t("div",tn,[i(T,{placeholder:"Mô tả đơn giản",value:s.document.description,"onUpdate:value":e[21]||(e[21]=n=>s.document.description=n),"show-count":"",maxlength:1e3,disabled:""},null,8,["value"])])]),t("div",en,[e[84]||(e[84]=t("div",{class:"col text-start mb-2 mb-xl-0 align-self-center ps-3"},[t("label",null,[t("span",null,"Ngày tạo:")])],-1)),t("div",sn,[i(C,{value:s.document.created_at,"onUpdate:value":e[22]||(e[22]=n=>s.document.created_at=n),placeholder:"Ngày chờ, tháng nhớ, năm mong",disabled:""},null,8,["value"])])])])]),t("div",nn,[t("div",on,[t("div",ln,[t("div",an,[e[86]||(e[86]=t("span",{class:"fs-5 fw-bold"},"Luồng phê duyệt",-1)),e[87]||(e[87]=t("br",null,null,-1)),s.document.document_status==="approved"?(o(),r("span",dn,"Đã được duyệt")):s.document.document_status==="rejected"?(o(),r("span",rn,"Bị từ chối")):(o(),r("span",cn,"Tiến độ: "+p(s.document_flow_steps.progress_percentage)+"%",1))]),s.document_flow_steps&&Object.keys(s.document_flow_steps).length>0?(o(),m(M,{key:0,steps:s.document_flow_steps},null,8,["steps"])):u("",!0)])])])])])])]))]),i(V,{open:s.rejectVisible,"onUpdate:open":e[25]||(e[25]=n=>s.rejectVisible=n),width:"600px"},{footer:l(()=>[i(d,{onClick:e[24]||(e[24]=n=>s.rejectVisible=!1)},{default:l(()=>e[91]||(e[91]=[g("Hủy")])),_:1}),i(d,{type:"primary",onClick:s.handleRejectDocument},{default:l(()=>e[92]||(e[92]=[g("Từ chối")])),_:1},8,["onClick"])]),default:l(()=>[t("div",null,[e[90]||(e[90]=t("h5",null,"❌ Từ chối văn bản",-1)),i(F),t("div",null,[e[89]||(e[89]=t("span",null,"Lý do chia tay là gì, em có biết không???",-1)),i(T,{value:s.reasonReject,"onUpdate:value":e[23]||(e[23]=n=>s.reasonReject=n),placeholder:"Vì em không yêu anh như anh yêu em, vì em xem anh chỉ là nhất thời.","show-count":"",maxlength:1e3,rows:"4",class:"mb-5"},null,8,["value"])]),i(F)])]),_:1},8,["open"]),i(V,{open:s.detailVersion.visible,"onUpdate:open":e[27]||(e[27]=n=>s.detailVersion.visible=n),width:"480px",zIndex:1e4,footer:null,centered:"",class:"document-modal"},{default:l(()=>[t("div",un,[e[99]||(e[99]=t("div",{class:"modal-header"},[t("div",{class:"header-content"},[t("span",{class:"header-icon"},"📄"),t("h3",{class:"modal-title"},"Thông tin văn bản")])],-1)),t("div",pn,[t("div",mn,[t("div",vn,[e[93]||(e[93]=t("div",{class:"info-label"},"📝 Tiêu đề",-1)),t("div",bn,p(s.detailVersion.title),1)]),t("div",fn,[e[94]||(e[94]=t("div",{class:"info-label"},"📋 Mô tả",-1)),t("div",hn,p(s.detailVersion.description??"Không có mô tả"),1)]),t("div",yn,[t("div",_n,[e[95]||(e[95]=t("div",{class:"info-label"},"🏷️ Loại văn bản",-1)),t("div",gn,[t("span",wn,p(s.detailVersion.type),1)])]),t("div",kn,[e[96]||(e[96]=t("div",{class:"info-label"},"🔢 Phiên bản",-1)),t("div",Cn,[t("span",Tn,"v"+p(s.detailVersion.version),1)])])]),t("div",Nn,[e[97]||(e[97]=t("div",{class:"info-label"},"📎 Tệp đính kèm",-1)),t("div",jn,[t("a",{href:`http://localhost:8000/documents/${s.detailVersion.file_path}`,target:"_blank",class:"file-link"}," 📂 Xem tệp 🔗 ",8,Sn)])])])]),t("div",Vn,[i(d,{type:"primary",onClick:e[26]||(e[26]=n=>s.detailVersion.visible=!1),class:"close-button"},{default:l(()=>e[98]||(e[98]=[g(" Đóng ")])),_:1})])])]),_:1},8,["open"])],64)}const qn=mt(Vt,[["render",xn],["__scopeId","data-v-75eefe2c"]]);export{qn as default};
