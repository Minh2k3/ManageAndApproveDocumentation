import{_ as j,c as u,o as c,D as V,b as e,l as d,J as v,e as p,f as T,i as I,g as R,d as E,a0 as O,a1 as $,F as q,m as J,a as C,r as F,k as K,q as A,T as G}from"./index-Ba8l0gpi.js";import{u as H}from"./use-menu-CIRKYwAT.js";import{u as W}from"./document-store-D3-2n2Ps.js";import"./pdfjs-CqkleIqs.js";const Q={name:"PDFViewer",props:{pdfUrl:{type:String,required:!0},initialPage:{type:Number,default:1},initialScale:{type:Number,default:1.5}},setup(n,{emit:o}){const b=p(null),t=p(null),m=p(!0),f=p(null),s=p(n.initialPage),g=p(0),a=p(n.initialScale);let l=null,y=!1,r=null,h=null;const U=async()=>{const i=document.createElement("script");return i.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js",i.async=!0,new Promise((w,k)=>{i.onload=()=>{h=window.pdfjsLib,h.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js",w()},i.onerror=k,document.head.appendChild(i)})},x=i=>{y=!0,l.getPage(i).then(w=>{const k=w.getViewport({scale:a.value}),D=b.value,L=D.getContext("2d");D.height=k.height,D.width=k.width;const B={canvasContext:L,viewport:k};w.render(B).promise.then(()=>{y=!1,r!==null&&(x(r),r=null)})}),o("pageChange",i)},P=i=>{y?r=i:x(i)},_=()=>{s.value<=1||(s.value--,P(s.value))},N=()=>{s.value>=g.value||(s.value++,P(s.value))},S=()=>{a.value>=3||(a.value=Math.min(a.value+.25,3),P(s.value))},z=()=>{a.value<=.5||(a.value=Math.max(a.value-.25,.5),P(s.value))},M=async()=>{try{m.value=!0,f.value=null,h||await U();const w=`http://localhost:8000/api/pdf-proxy?file=${encodeURIComponent(n.pdfUrl)}`;l=await h.getDocument(w).promise,g.value=l.numPages,x(s.value),m.value=!1}catch(i){console.error("Error loading PDF:",i),f.value="Không thể tải file PDF. Vui lòng thử lại.",m.value=!1}};return T(()=>{M()}),I(()=>n.pdfUrl,()=>{s.value=1,M()}),R(()=>{l&&l.destroy()}),{pdfCanvas:b,pdfContainer:t,loading:m,error:f,pageNum:s,totalPages:g,scale:a,previousPage:_,nextPage:N,zoomIn:S,zoomOut:z}}},X={class:"pdf-viewer-container"},Y={key:0,class:"loading-spinner"},Z={key:1,class:"error-message"},ee={key:2,class:"pdf-controls"},oe=["disabled"],ne={class:"page-info"},te=["disabled"],se={class:"zoom-controls"},le=["disabled"],ie={class:"zoom-info"},de=["disabled"],ae={class:"pdf-canvas-container",ref:"pdfContainer"},re={ref:"pdfCanvas"};function ue(n,o,b,t,m,f){return c(),u("div",X,[t.loading?(c(),u("div",Y,o[4]||(o[4]=[e("div",{class:"spinner"},null,-1),e("p",null,"Đang tải PDF...",-1)]))):V("",!0),t.error?(c(),u("div",Z,[e("p",null,d(t.error),1)])):V("",!0),!t.loading&&!t.error?(c(),u("div",ee,[e("button",{onClick:o[0]||(o[0]=(...s)=>t.previousPage&&t.previousPage(...s)),disabled:t.pageNum<=1},o[5]||(o[5]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M15 18l-6-6 6-6","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),v(" Trang trước ")]),8,oe),e("span",ne," Trang "+d(t.pageNum)+" / "+d(t.totalPages),1),e("button",{onClick:o[1]||(o[1]=(...s)=>t.nextPage&&t.nextPage(...s)),disabled:t.pageNum>=t.totalPages},o[6]||(o[6]=[v(" Trang sau "),e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M9 18l6-6-6-6","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]),8,te),e("div",se,[e("button",{onClick:o[2]||(o[2]=(...s)=>t.zoomOut&&t.zoomOut(...s)),disabled:t.scale<=.5},o[7]||(o[7]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("circle",{cx:"11",cy:"11",r:"8","stroke-width":"2"}),e("path",{d:"M21 21l-4.35-4.35M8 11h6","stroke-width":"2","stroke-linecap":"round"})],-1)]),8,le),e("span",ie,d(Math.round(t.scale*100))+"%",1),e("button",{onClick:o[3]||(o[3]=(...s)=>t.zoomIn&&t.zoomIn(...s)),disabled:t.scale>=3},o[8]||(o[8]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("circle",{cx:"11",cy:"11",r:"8","stroke-width":"2"}),e("path",{d:"M21 21l-4.35-4.35M11 8v6M8 11h6","stroke-width":"2","stroke-linecap":"round"})],-1)]),8,de)])])):V("",!0),e("div",ae,[e("canvas",re,null,512)],512)])}const ce=j(Q,[["render",ue],["__scopeId","data-v-e24fb881"]]),pe=E({components:{PDFViewer:ce},setup(){H().onSelectedKeys(["approver-documents-detail"]);const n=W(),b=A().user,t=G(),m=p([]);let f=p([]);const s=p("3374b893-4fe4-4f5c-8f31-c75ef448bc9c.pdf"),g="http://localhost:8000";T(async()=>{await n.fetchDocuments(b.id),m.value=n.documents;const r=parseInt(t.params.id);f.value=m.value.find(h=>h.id===r)||null,console.log(f.value)});const a=p("http://localhost:8000/documents/3374b893-4fe4-4f5c-8f31-c75ef448bc9c.pdf");return{document:f,documentFilename:s,apiBaseUrl:g,pdfUrl:a,onPdfLoaded:r=>{console.log("PDF loaded:",r.filename),console.log("View URL:",r.url)},onPdfError:r=>{console.error("PDF error:",r.message)}}}}),ve={key:0},me={key:1},fe={class:"container py-4"},ge={class:"row justify-content-between gap-2"},be={class:"col-xl-7"},he={class:"row border-1 rounded-3 p-4 mb-4 bg-light"},we={class:"col"},ke={class:"row mb-3"},ye={class:"col d-flex justify-content-center"},Pe={class:"fs-5 fw-bold"},Ce={class:"document-viewer-page"},xe={class:"header"},De={class:"document-selector"},Ve=["value"],Fe={key:0,class:"viewer-container"},Me={key:1,class:"no-document"},je={class:"col-xl"},Te={class:"row border-1 rounded-3 p-4 mb-4 bg-light"},Ue={class:"col"},_e={class:"row mt-3"},Ne={class:"col-xl-10"},Se={class:"row mt-3"},ze={class:"col-xl-4"},Le={class:"d-flex"},Be={class:"row mt-3"},Ie={class:"col-xl-10"};function Re(n,o,b,t,m,f){const s=F("PDFViewer"),g=F("a-input"),a=F("a-textarea");return c(),u("div",null,[o[24]||(o[24]=e("h2",{class:"fw-bold mb-3"},"Chi tiết văn bản",-1)),n.document.from_me?(c(),u("div",ve,[o[11]||(o[11]=v(" Văn bản tôi tạo ")),e("div",null,[e("p",null,[o[5]||(o[5]=e("strong",null,"ID:",-1)),v(" "+d(n.document.id),1)]),e("p",null,[o[6]||(o[6]=e("strong",null,"Tên văn bản:",-1)),v(" "+d(n.document.title),1)]),e("p",null,[o[7]||(o[7]=e("strong",null,"Loại:",-1)),v(" "+d(n.document.type),1)]),e("p",null,[o[8]||(o[8]=e("strong",null,"Trạng thái:",-1)),v(" "+d(n.document.status),1)]),e("p",null,[o[9]||(o[9]=e("strong",null,"Ngày tạo:",-1)),v(" "+d(n.document.created_at),1)]),e("p",null,[o[10]||(o[10]=e("strong",null,"Ngày cập nhật:",-1)),v(" "+d(n.document.updated_at),1)])])])):(c(),u("div",me,[o[23]||(o[23]=v(" Văn bản cần tôi duyệt ")),e("div",fe,[e("div",ge,[e("div",be,[e("div",he,[e("div",we,[e("div",ke,[e("div",ye,[e("span",Pe,d(n.document.title),1)])])]),e("div",Ce,[e("div",xe,[o[14]||(o[14]=e("h1",null,"Trình xem tài liệu PDF",-1)),e("div",De,[o[13]||(o[13]=e("label",{for:"document-select"},"Chọn tài liệu:",-1)),O(e("select",{id:"document-select","onUpdate:modelValue":o[0]||(o[0]=l=>n.selectedDocument=l),onChange:o[1]||(o[1]=(...l)=>n.onDocumentChange&&n.onDocumentChange(...l))},[o[12]||(o[12]=e("option",{value:""},"-- Chọn file PDF --",-1)),(c(!0),u(q,null,J(n.pdfFiles,l=>(c(),u("option",{key:l.name,value:l.name},d(l.name)+" ("+d(n.formatFileSize(l.size))+") ",9,Ve))),128))],544),[[$,n.selectedDocument]])])]),n.selectedDocument?(c(),u("div",Fe,[C(s,{"pdf-url":n.selectedDocument,"initial-scale":1.2,onPageChange:n.onPageChange},null,8,["pdf-url","onPageChange"])])):(c(),u("div",Me,o[15]||(o[15]=[K('<svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke-width="2"></path><polyline points="14 2 14 8 20 8" stroke-width="2"></polyline><line x1="16" y1="13" x2="8" y2="13" stroke-width="2"></line><line x1="16" y1="17" x2="8" y2="17" stroke-width="2"></line><polyline points="10 9 9 9 8 9" stroke-width="2"></polyline></svg><p>Vui lòng chọn một tài liệu PDF để xem</p>',2)])))])])]),e("div",je,[e("div",Te,[e("div",Ue,[o[21]||(o[21]=e("div",{class:"row mb-3"},[e("div",{class:"col d-flex justify-content-center"},[e("span",{class:"fs-5 fw-bold"},"Thông tin văn bản")])],-1)),e("div",_e,[o[17]||(o[17]=e("div",{class:"col-xl-3 text-start mb-2 mb-xl-0 align-self-center ps-3"},[e("label",null,[e("span",null,"Tên văn bản:")])],-1)),e("div",Ne,[C(g,{value:n.document.title,"onUpdate:value":o[2]||(o[2]=l=>n.document.title=l),placeholder:"Văn bản số 1",disabled:""},null,8,["value"]),o[16]||(o[16]=e("div",{class:"w-100"},null,-1))])]),e("div",Se,[o[18]||(o[18]=e("div",{class:"col-xl-3 text-start mb-2 mb-xl-0 align-self-center ps-3"},[e("label",null,[e("span",null,"Loại văn bản:")])],-1)),e("div",ze,[e("div",Le,[C(g,{value:n.document.type,"onUpdate:value":o[3]||(o[3]=l=>n.document.type=l),placeholder:"Văn bản số 1",disabled:""},null,8,["value"])])])]),e("div",Be,[o[20]||(o[20]=e("div",{class:"col-xl-3 text-start mb-2 mb-xl-0 align-self-center ps-3"},[e("label",null,[e("span",null,"Mô tả:")])],-1)),e("div",Ie,[C(a,{placeholder:"Mô tả đơn giản",value:n.document.description,"onUpdate:value":o[4]||(o[4]=l=>n.document.description=l),"show-count":"",maxlength:1e3,disabled:""},null,8,["value"]),o[19]||(o[19]=e("div",{class:"w-100"},null,-1))])]),o[22]||(o[22]=e("div",{class:"row mt-3"},[e("div",{class:"col-xl-3 text-start mb-2 mb-xl-0 align-self-top ps-3 pt-3"},[e("label",null,[e("span",null,"Tệp đính kèm:")])])],-1))])])])])])]))])}const Ke=j(pe,[["render",Re]]);export{Ke as default};
