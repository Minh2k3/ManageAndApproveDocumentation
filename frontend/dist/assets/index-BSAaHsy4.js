import{_ as A,e as H,x as m,d as s,r as p,y as O,g as $,i as T,M as x,G as w,H as _,D as M,o as d,a as e,b as r,c as D,I as u,q as h,F as G}from"./index-ixtV8ZqQ.js";import{u as K}from"./use-menu-Dt9qxgnu.js";import{u as N}from"./certificate-store-C7KnW6pf.js";const V=H({setup(){K().onSelectedKeys(["admin-users"]);const n=O(),t=N();M();let v=$([]);const b=[{title:"Họ tên",dataIndex:"name",key:"name",width:200,sorter:(a,i)=>{const o=a.name.split(" ").slice(-1).join(" "),f=i.name.split(" ").slice(-1).join(" ");return o.localeCompare(f)},sortDirections:["ascend","descend"],customHeaderCell:()=>({style:{textAlign:"center"}})},{title:"Email",dataIndex:"email",key:"email",width:200,customHeaderCell:()=>({style:{textAlign:"center"}})},{title:"Chức vụ",dataIndex:"roll",key:"roll",responsive:["xl"],width:250,align:"center"},{title:"Trạng thái",dataIndex:"status",key:"status",width:150,sorter:(a,i)=>{const o={active:1,banned:2,pending:3,inactive:4};return o[a.status]-o[i.status]},sortDirections:["ascend","descend"],align:"center"},{title:"Thao tác",key:"action",fixed:"right",width:100,customHeaderCell:()=>({style:{textAlign:"center"}})}];T(async()=>{await n.fetchUsers(),v.value=n.users});const g=$(!1);return{users:v,columns:b,viewDetail:a=>{g.value=!0},showConfirm:(a,i)=>{x.confirm({title:`Bạn có chắc chắn muốn ${i==="ban"?"cấm":"kích hoạt tài khoản cho"} ${a.name}?`,async onOk(){i==="ban"?(await w.post("/api/users/banned",{id:a.id}),_.success(`Đã cấm ${a.name}!`)):(await w.post("/api/users/active",{id:a.id}),await t.issueCertificate(a.id),_.success(`Đã kích hoạt ${a.name}!`));const o=v.value.findIndex(f=>f.id===a.id);o!==-1&&(v.value[o].status=i==="ban"?"banned":"active")},onCancel(){}})},showConfirmUnban:a=>{x.confirm({title:`Bạn có chắc chắn muốn bỏ cấm cho ${a.name}?`,async onOk(){await w.post("/api/users/unban",{id:a.id});const i=v.value.findIndex(o=>o.id===a.id);i!==-1&&(v.value[i].status="active"),_.success("Bỏ cám thành công!")},onCancel(){}})}}}}),E={class:"row mb-3"},F={class:"col-12 align-items-center justify-content-end d-flex"},Q={class:"row mb-3"},q={class:"col-12"},R={class:"row g-2"},X={class:"col-12 col-md-4 align-items-center"},z={class:"col-12 col-md-8"},J={class:"row g-2"},L={class:"col-6 col-md-4"},P={class:"col-6 col-md-4"},W={class:"col-6 col-md-3"},Y={class:"col-6 col-md-1 d-flex align-items-center justify-content-end"},Z={class:"row"},tt={class:"col-12"},et={key:0},st={class:""},nt=["href"];function at(n,t,v,b,g,B){const C=p("router-link"),k=p("a-button"),a=p("a-input-search"),i=p("a-select"),o=p("a-tooltip"),f=p("a-tag"),I=p("a-space"),S=p("a-table"),U=p("a-card");return d(),m(U,{title:"",style:{width:"100%"},class:"rounded-0 mt-1"},{default:s(()=>[t[18]||(t[18]=e("h2",{class:""},"Quản lý người dùng",-1)),t[19]||(t[19]=e("span",{class:"text-secondary fst-italic"},"Quản lý thông tin tài khoản người dùng",-1)),e("div",E,[e("div",F,[r(k,{type:"primary"},{default:s(()=>[r(C,{to:{name:"admin-users-create"},class:"text-white"},{default:s(()=>t[3]||(t[3]=[e("i",{class:"fa-solid fa-plus"},null,-1)])),_:1})]),_:1})])]),e("div",Q,[e("div",q,[e("div",R,[e("div",X,[r(a,{placeholder:"Tìm kiếm","allow-clear":"","enter-button":"",class:"w-100"})]),e("div",z,[e("div",J,[e("div",L,[r(i,{value:n.status_id,"onUpdate:value":t[0]||(t[0]=c=>n.status_id=c),"show-search":"",placeholder:"Tất cả trạng thái",options:n.users_status,"filter-option":n.filterOption,"allow-clear":"",class:"w-100"},null,8,["value","options","filter-option"])]),e("div",P,[r(i,{value:n.role_id,"onUpdate:value":t[1]||(t[1]=c=>n.role_id=c),"show-search":"",placeholder:"Tất cả vai trò",options:n.users_role,"filter-option":n.filterOption,"allow-clear":"",class:"w-100"},null,8,["value","options","filter-option"])]),e("div",W,[r(i,{value:n.department_id,"onUpdate:value":t[2]||(t[2]=c=>n.department_id=c),"show-search":"",placeholder:"Tất cả đơn vị",options:n.users_department,"filter-option":n.filterOption,"allow-clear":"",class:"w-100"},null,8,["value","options","filter-option"])]),e("div",Y,[r(k,{type:"primary",class:""},{default:s(()=>t[4]||(t[4]=[e("i",{class:"fa-solid fa-filter"},null,-1)])),_:1})])])])])])]),e("div",Z,[e("div",tt,[r(S,{dataSource:n.users,columns:n.columns,scroll:{x:576}},{bodyCell:s(({column:c,index:j,record:l})=>[c.key==="index"?(d(),D("span",et,h(j+1),1)):u("",!0),c.key==="name"?(d(),m(o,{key:1},{title:s(()=>[e("span",st,h(l.roll),1)]),default:s(()=>[e("span",null,h(l.name),1)]),_:2},1024)):u("",!0),c.key==="email"?(d(),m(o,{key:2},{title:s(()=>t[5]||(t[5]=[e("span",null,"Click để gửi mail",-1)])),default:s(()=>[e("a",{href:`mailto:${l.email}?subject=Gửi tới ${l.name}&body=Chào ${l.name},%0D%0A%0D%0A`,class:"text-decoration-none fst-italic"},h(l.email),9,nt)]),_:2},1024)):u("",!0),c.key==="status"?(d(),D(G,{key:3},[l.status==="active"?(d(),m(f,{key:0,color:"green"},{default:s(()=>t[6]||(t[6]=[e("span",null,"Hoạt động",-1)])),_:1})):u("",!0),l.status==="inactive"?(d(),m(f,{key:1,color:"gray"},{default:s(()=>t[7]||(t[7]=[e("span",null,"Chưa kích hoạt mail",-1)])),_:1})):u("",!0),l.status==="pending"?(d(),m(f,{key:2,color:"orange"},{default:s(()=>t[8]||(t[8]=[e("span",null,"Chờ duyệt",-1)])),_:1})):u("",!0),l.status==="banned"?(d(),m(f,{key:3,color:"red"},{default:s(()=>t[9]||(t[9]=[e("span",null,"Bị cấm",-1)])),_:1})):u("",!0)],64)):u("",!0),c.key==="action"?(d(),m(I,{key:4,class:"d-flex justify-content-center gap-3"},{default:s(()=>[r(o,null,{title:s(()=>t[10]||(t[10]=[e("span",{class:""},"Xem chi tiết",-1)])),default:s(()=>[r(k,{onClick:y=>n.viewDetail(l),class:"bg-primary text-white"},{default:s(()=>t[11]||(t[11]=[e("i",{class:"bi bi-eye"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024),l.status==="pending"?(d(),m(o,{key:0},{title:s(()=>t[12]||(t[12]=[e("span",{class:""},"Kích hoạt tài khoản",-1)])),default:s(()=>[r(k,{onClick:y=>n.showConfirm(l,"activate"),class:"bg-success text-white"},{default:s(()=>t[13]||(t[13]=[e("i",{class:"bi bi-check"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024)):u("",!0),l.status==="active"?(d(),m(o,{key:1},{title:s(()=>t[14]||(t[14]=[e("span",{class:""},"Khóa tài khoản",-1)])),default:s(()=>[r(k,{onClick:y=>n.showConfirm(l,"ban"),class:"bg-danger text-white"},{default:s(()=>t[15]||(t[15]=[e("i",{class:"bi bi-ban"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024)):u("",!0),l.status==="banned"?(d(),m(o,{key:2},{title:s(()=>t[16]||(t[16]=[e("span",{class:""},"Gỡ khóa tài khoản",-1)])),default:s(()=>[r(k,{onClick:y=>n.showConfirmUnban(l),class:"bg-danger-subtle border-danger text-white"},{default:s(()=>t[17]||(t[17]=[e("i",{class:"bi bi-ban"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024)):u("",!0)]),_:2},1024)):u("",!0)]),_:1},8,["dataSource","columns"])])])]),_:1})}const dt=A(V,[["render",at]]);export{dt as default};
