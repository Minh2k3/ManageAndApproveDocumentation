import{u as j}from"./use-menu-B0v-_Hey.js";import{_ as X,e as G,c as p,b as n,d as a,r as i,F as M,S as J,A as P,g as h,C as H,i as Q,H as q,o as d,a as e,I as w,q as m,x as D,N as u,u as O}from"./index-WEoVCage.js";import{u as W}from"./department-store-DwK1AY3R.js";const Y=G({components:{CheckCircleOutlined:J},setup(){j().onSelectedKeys(["admin-documents-type"]);const s=P(),t=W(),S=h([]),_=h([]),L=h(!1),R=h(!1),T=h({}),F=h(!1),k=h(),c=h([]),b=h(""),v=h({id:null,name:"",description:"",is_active:!0,roll_at_departments:[]}),A={name:[{required:!0,message:"Vui lòng nhập tên loại văn bản",trigger:"blur"},{min:2,max:100,message:"Tên phải từ 2-100 ký tự",trigger:"blur"}],description:[{max:500,message:"Mô tả không được quá 500 ký tự",trigger:"blur"}]},C=H(()=>_.value?b.value?_.value.filter(l=>l.name.toLowerCase().includes(b.value.toLowerCase())||l.description.toLowerCase().includes(b.value.toLowerCase())):_.value:[]),I=H(()=>C.value.length>0&&c.value.length===C.value.length),B=H(()=>c.value.length>0&&c.value.length<C.value.length);Q(async()=>{await s.fetchDocumentTypes(),S.value=s.document_types,console.log(S.value),await t.fetchRollAtDepartment(),_.value=t.roll_at_department,console.log(_.value)});const U=[{title:"Loại văn bản",dataIndex:"name",key:"name",fixed:"left",width:200,customHeaderCell:()=>({style:{textAlign:"center"}})},{title:"Mô tả",dataIndex:"description",key:"description",width:300,customHeaderCell:()=>({style:{textAlign:"center"}})},{title:"Số lượt dùng",dataIndex:"documents_count",key:"documents_count",width:150,align:"center"},{title:"Trạng thái",dataIndex:"is_active",key:"is_active",width:150,align:"center"},{title:"Thao tác",key:"action",fixed:"right",width:100,align:"center"}],N=l=>{T.value=l,v.value={id:l.id,name:l.name,description:l.description,is_active:l.is_active,roll_at_departments:[...l.roll_at_departments||[]]},c.value=(l.roll_at_departments||[]).map(r=>r.id),R.value=!0},$=()=>{R.value=!1,g()},z=async()=>{try{await k.value.validate(),F.value=!0;const l=_.value.filter(y=>c.value.includes(y.id)),r={...v.value,roll_at_departments:c.value};console.log("Saving form data:",r),await s.updateDocumentType(v.value.id,r),await s.fetchDocumentTypes(!0),S.value=s.document_types,q.success("Cập nhật loại văn bản thành công!"),R.value=!1,g()}catch(l){console.error("Save failed:",l),q.error("Cập nhật thất bại!")}finally{F.value=!1}},E=l=>{l.target.checked?c.value=C.value.map(r=>r.id):c.value=[]},V=()=>{c.value=[]},o=l=>{const r=c.value.indexOf(l);r>-1&&c.value.splice(r,1)},f=l=>{const r=_.value.find(y=>y.id===l);return r?r.name:""},g=()=>{v.value={id:null,name:"",description:"",is_active:!0,roll_at_departments:[]},c.value=[],b.value=""};return{document_types:S,columns:U,detailTypeModal:L,editTypeModal:R,selectedType:T,editForm:v,editFormRef:k,rules:A,selectedRoleIds:c,roleSearchTerm:b,filteredRoles:C,isAllSelected:I,isIndeterminate:B,saving:F,handleClickEdit:N,handleCancelEdit:$,handleSave:z,handleSelectAll:E,clearAllSelection:V,removeFromSelection:o,getRoleName:f,customRow:l=>({style:{cursor:"pointer"},onClick:r=>{const y=r.target;y.closest("[data-action-column]")||y.closest(".btn")||y.closest(".ant-popconfirm")||y.closest("button")||(T.value=l,L.value=!0)}}),documentStore:s}}}),Z={class:"row mb-3"},x={class:"col-12"},ee={class:"row g-2 d-md-flex justify-content-md-between"},te={class:"col-10 col-md-4"},se={class:"row"},oe={class:"col-12"},ne={key:0},le={key:1,class:"gap-2 d-flex","data-action-column":""},ae=["onClick"],ie={class:"modal-content"},de={class:"modal-body"},ce={class:"info-card"},re={class:"info-item"},ue={class:"info-value"},me={class:"info-item"},pe={class:"info-value"},ve={class:"info-item"},he={class:"info-value badge"},_e={class:"roles-section"},fe={class:"roles-container"},ge={class:"role-name"},ye={class:"role-description"},ke={key:0,class:"empty-state"},be={class:"modal-footer"},Ce={class:"modal-content"},we={class:"modal-body"},Te={class:"info-card"},Se={class:"roles-selection-section"},Re={class:"roles-selection-container"},Fe={class:"roles-search"},Ie={class:"select-all-section"},Me={class:"roles-list"},Ae={class:"role-info"},Ne={class:"role-name"},De={class:"role-description"},Le={key:0,class:"empty-search"},Be={key:0,class:"selected-summary"},Ue={class:"summary-header"},$e={class:"summary-title"},ze={class:"selected-roles-preview"},Ee={class:"modal-footer"};function Ve(s,t,S,_,L,R){const T=i("a-input-search"),F=i("a-popconfirm"),k=i("a-tag"),c=i("a-table"),b=i("a-card"),v=i("a-button"),A=i("a-modal"),C=i("a-input"),I=i("a-form-item"),B=i("a-textarea"),U=i("a-switch"),N=i("a-checkbox"),$=i("a-checkbox-group"),z=i("CheckCircleOutlined"),E=i("a-form"),V=i("a-space");return d(),p(M,null,[n(b,{title:"",style:{width:"100%"}},{default:a(()=>[t[11]||(t[11]=e("h2",{class:"fw-bold mb-3"},"Loại Văn Bản",-1)),e("div",Z,[e("div",x,[e("div",ee,[e("div",te,[n(T,{placeholder:"Tìm kiếm","allow-clear":"","enter-button":"",class:"w-100"})])])])]),e("div",se,[e("div",oe,[n(c,{dataSource:s.document_types,columns:s.columns,scroll:{x:576},bordered:"",customRow:s.customRow},{bodyCell:a(({column:o,index:f,record:g})=>[o.key==="index"?(d(),p("span",ne,m(f+1),1)):w("",!0),o.key==="action"?(d(),p("div",le,[e("button",{class:"btn btn-warning",onClick:K=>s.handleClickEdit(g)},"Sửa",8,ae),n(F,{title:"Bạn có chắc chắn muốn xóa?",onConfirm:()=>s.documentStore.deleteDocumentType(g.id),placement:"topRight"},{default:a(()=>t[8]||(t[8]=[e("button",{class:"btn btn-danger"},"Xóa",-1)])),_:2},1032,["onConfirm"])])):w("",!0),o.key==="is_active"?(d(),p(M,{key:2},[g.is_active?(d(),D(k,{key:0,color:"green"},{default:a(()=>t[9]||(t[9]=[u("Đang sử dụng")])),_:1})):(d(),D(k,{key:1,color:"red"},{default:a(()=>t[10]||(t[10]=[u("Ngừng hoạt động")])),_:1}))],64)):w("",!0)]),_:1},8,["dataSource","columns","customRow"])])])]),_:1}),n(A,{open:s.detailTypeModal,"onUpdate:open":t[1]||(t[1]=o=>s.detailTypeModal=o),width:"650px","z-index":"10000",footer:null,class:"detail-type-modal"},{default:a(()=>{var o;return[e("div",ie,[t[18]||(t[18]=e("div",{class:"modal-header"},[e("h3",{class:"modal-title"},[e("span",{class:"title-icon"},"📄"),u(" Thông tin loại văn bản ")])],-1)),e("div",de,[e("div",ce,[e("div",re,[t[12]||(t[12]=e("span",{class:"info-label"},"Tên:",-1)),e("span",ue,m(s.selectedType.name),1)]),e("div",me,[t[13]||(t[13]=e("span",{class:"info-label"},"Mô tả:",-1)),e("span",pe,m(s.selectedType.description),1)]),e("div",ve,[t[14]||(t[14]=e("span",{class:"info-label"},"Số lượng chức vụ được ký:",-1)),e("span",he,m(((o=s.selectedType.roll_at_departments)==null?void 0:o.length)||0),1)])]),e("div",_e,[t[16]||(t[16]=e("h4",{class:"section-title"},[e("span",{class:"section-icon"},"👥"),u(" Chức vụ được ký ")],-1)),e("div",fe,[(d(!0),p(M,null,O(s.selectedType.roll_at_departments,(f,g)=>(d(),p("div",{key:g,class:"role-item"},[e("div",ge,m(f.name),1),e("div",ye,m(f.description),1)]))),128)),!s.selectedType.roll_at_departments||s.selectedType.roll_at_departments.length===0?(d(),p("div",ke,t[15]||(t[15]=[e("span",{class:"empty-icon"},"📝",-1),e("p",null,"Chưa có chức vụ nào được phép ký",-1)]))):w("",!0)])])]),e("div",be,[n(v,{type:"primary",onClick:t[0]||(t[0]=f=>s.detailTypeModal=!1),class:"close-btn"},{default:a(()=>t[17]||(t[17]=[u(" Đóng ")])),_:1})])])]}),_:1},8,["open"]),n(A,{open:s.editTypeModal,"onUpdate:open":t[7]||(t[7]=o=>s.editTypeModal=o),width:"800px","z-index":"10000",footer:null,class:"edit-type-modal",maskClosable:!1},{default:a(()=>[e("div",Ce,[t[25]||(t[25]=e("div",{class:"modal-header edit-header"},[e("h3",{class:"modal-title"},[e("span",{class:"title-icon"},"✏️"),u(" Chỉnh sửa loại văn bản ")])],-1)),e("div",we,[n(E,{model:s.editForm,rules:s.rules,ref:"editFormRef",layout:"vertical",class:"edit-form"},{default:a(()=>[e("div",Te,[t[19]||(t[19]=e("h4",{class:"card-title"},[e("span",{class:"card-icon"},"📋"),u(" Thông tin cơ bản ")],-1)),n(I,{label:"Tên loại văn bản",name:"name"},{default:a(()=>[n(C,{value:s.editForm.name,"onUpdate:value":t[2]||(t[2]=o=>s.editForm.name=o),placeholder:"Nhập tên loại văn bản",size:"large"},null,8,["value"])]),_:1}),n(I,{label:"Mô tả",name:"description"},{default:a(()=>[n(B,{value:s.editForm.description,"onUpdate:value":t[3]||(t[3]=o=>s.editForm.description=o),placeholder:"Nhập mô tả cho loại văn bản",rows:3,size:"large"},null,8,["value"])]),_:1}),n(I,{label:"Trạng thái",name:"is_active"},{default:a(()=>[n(U,{checked:s.editForm.is_active,"onUpdate:checked":t[4]||(t[4]=o=>s.editForm.is_active=o),"checked-children":"Đang sử dụng","un-checked-children":"Ngừng hoạt động"},null,8,["checked"])]),_:1})]),e("div",Se,[t[22]||(t[22]=e("h4",{class:"section-title"},[e("span",{class:"section-icon"},"👥"),u(" Chọn chức vụ được phép ký ")],-1)),e("div",Re,[e("div",Fe,[n(T,{value:s.roleSearchTerm,"onUpdate:value":t[5]||(t[5]=o=>s.roleSearchTerm=o),placeholder:"Tìm kiếm chức vụ...",allowClear:"",size:"large"},null,8,["value"])]),e("div",Ie,[n(N,{indeterminate:s.isIndeterminate,checked:s.isAllSelected,onChange:s.handleSelectAll},{default:a(()=>[e("strong",null,"Chọn tất cả ("+m(s.selectedRoleIds.length)+"/"+m(s.filteredRoles.length)+")",1)]),_:1},8,["indeterminate","checked","onChange"])]),e("div",Me,[n($,{value:s.selectedRoleIds,"onUpdate:value":t[6]||(t[6]=o=>s.selectedRoleIds=o),class:"w-100"},{default:a(()=>[(d(!0),p(M,null,O(s.filteredRoles,o=>(d(),p("div",{key:o.id,class:"role-checkbox-item"},[n(N,{value:o.id,class:"role-checkbox"},{default:a(()=>[e("div",Ae,[e("div",Ne,m(o.name),1),e("div",De,m(o.description),1)])]),_:2},1032,["value"])]))),128))]),_:1},8,["value"]),s.filteredRoles.length===0?(d(),p("div",Le,t[20]||(t[20]=[e("span",{class:"empty-icon"},"🔍",-1),e("p",null,"Không tìm thấy chức vụ nào phù hợp",-1)]))):w("",!0)]),s.selectedRoleIds.length>0?(d(),p("div",Be,[e("div",Ue,[e("span",$e,[n(z,{class:"summary-icon"}),u(" Đã chọn "+m(s.selectedRoleIds.length)+" chức vụ ",1)]),n(v,{type:"link",size:"small",onClick:s.clearAllSelection},{default:a(()=>t[21]||(t[21]=[u(" Bỏ chọn tất cả ")])),_:1},8,["onClick"])]),e("div",ze,[(d(!0),p(M,null,O(s.selectedRoleIds.slice(0,5),o=>(d(),D(k,{key:o,color:"blue",closable:"",onClose:f=>s.removeFromSelection(o)},{default:a(()=>[u(m(s.getRoleName(o)),1)]),_:2},1032,["onClose"]))),128)),s.selectedRoleIds.length>5?(d(),D(k,{key:0,color:"default"},{default:a(()=>[u(" +"+m(s.selectedRoleIds.length-5)+" khác... ",1)]),_:1})):w("",!0)])])):w("",!0)])])]),_:1},8,["model","rules"])]),e("div",Ee,[n(V,null,{default:a(()=>[n(v,{onClick:s.handleCancelEdit},{default:a(()=>t[23]||(t[23]=[u(" Hủy ")])),_:1},8,["onClick"]),n(v,{type:"primary",onClick:s.handleSave,loading:s.saving},{default:a(()=>t[24]||(t[24]=[u(" Lưu thay đổi ")])),_:1},8,["onClick","loading"])]),_:1})])])]),_:1},8,["open"])],64)}const je=X(Y,[["render",Ve],["__scopeId","data-v-3dc5afdc"]]);export{je as default};
