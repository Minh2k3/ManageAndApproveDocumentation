import{u as ue}from"./use-menu-vCLX-e5I.js";import{a0 as pe,g as v,G as O,_ as me,e as ve,c as r,a as e,b as i,d as l,r as k,I as u,N as _,x as m,q as p,F as K,T as W,z as be,s as fe,C as ye,U as he,i as ge,t as _e,k as we,H as j,m as ke,M as G,o,u as Z}from"./index-qeq2zkB_.js";import{u as Ce}from"./document-store-UblJpyvs.js";import{P as Te}from"./PDFViewer-BuIQDaNu.js";import{N as Ne,r as je}from"./ProgressDocument-CdhAQZuB.js";const Se=pe("certificate",()=>{const s=v([]),t=v(!1),b=v(null);async function P(w=!1,d=null){if(!(t.value&&!w))try{const N=await O.get(`/api/users/${d}/certificates`);N.data&&(s.value=N.data.certificates,t.value=!0)}catch(N){console.error("Error fetching certificate:",N)}}async function J(w){try{const d=await O.post("/api/certificates/request-issue-certificate",{user_id:w});if(console.log("response request issue certificate: ",d.data),d.data)return d.data}catch(d){console.error("Error requesting issue certificate:",d)}}async function E(w){try{const d=await O.post("/api/certificates/request-extend-certificate",{certificate_id:w});if(console.log("response request extend certificate: ",d.data),d.data)return d.data}catch(d){console.error("Error requesting extend certificate:",d)}}async function S(w){try{const d=await O.get(`api/document-certificate-id/${w}`);return d.data?(console.log("Certificate found:",d.data.certificate),b.value=d.data,d.data.certificate):(console.warn("No certificate found with code:",code),null)}catch(d){throw console.error("Error fetching certificate by code:",d),d}}function y(){s.value=[],t.value=!1}return{certificates:s,fetchCertificates:P,currentCertificate:b,findCertificateByDocumentId:S,requestIssueCertificate:J,requestExtendCertificate:E,resetCertificates:y}}),Ve=ve({components:{PDFViewer:Te,NestedProgressSteps:Ne},setup(){W.extend(je);const s=v("document"),t=v(!1);ue().onSelectedKeys(["approver-documents-detail"]);const b=Ce(),P=Se(),E=be().user,S=he(),y=v([]),w=v(""),d=v([]),N=v([]),g=v([]),h=fe([]),M=ye(()=>h.value.length>0?h.value[0].version+1:1),A=v(!1),B=v(""),T=parseInt(S.params.id);ge(async()=>{const a=S.query.from_me==="1";await b.fetchDocumentById(T,a),y.value=b.current_document,console.log("Document Data:",y.value),await b.getDocumentVersions(T),h.value=_e(b.current_document_versions);for(let f=0;f<h.value.length;f++)h.value[f].document_data=JSON.parse(h.value[f].document_data);if(console.log("Document versions: ",h.value),w.value=y.value.file_path,await b.fetchDocumentComments(T),N.value=b.document_comments,await b.fetchStepsByDocumentFlowId(y.value.document_flow_id),g.value=b.current_document_flow_steps,g.value.is_completed){await b.createCertificate(T),A.value=!0;const f=await P.findCertificateByDocumentId(T);console.log("Certificate found:",f),B.value=f?f.file_path:""}await b.fetchDocumentTypes(),d.value=b.document_types,console.log(d.value)});const C=v(""),x="https://tminh.id.vn",F=a=>a?`${x}/images/avatars/${a}`:null,V=v(!1),n=v(!1),D=async()=>{const a=parseInt(y.value.document_flow_step_id);console.log("Step ID:",a),V.value=!0,n.value=!0;try{console.log("Approve response version:",h.value[0].id),await b.signDocument(h.value[0].id,a,T),await b.approveDocument(a),j.success("Bạn vừa đồng ý phê duyệt"),window.location.reload()}catch(f){j.error("Có lỗi xảy ra khi đồng ý phê duyệt văn bản"),console.error("Error approving document:",f)}finally{V.value=!1,n.value=!1}},c=v(!1),$=v(""),ee=async()=>{if($.value.trim()===""){j.error("Vui lòng nhập lý do từ chối");return}const a={document_version_id:y.value.version_id,reason:$.value},f=parseInt(y.value.document_flow_step_id);console.log("Rejecting document with data:",a),console.log("Step ID:",f),V.value=!0,n.value=!0;try{await b.rejectDocument(f,a),window.location.reload(),j.success("Bạn vừa từ chối văn bản với lý do: "+$.value)}catch(U){j.error("Có lỗi xảy ra khi từ chối văn bản"),console.error("Error rejecting document:",U)}finally{c.value=!1,V.value=!1,n.value=!1}},te=async()=>{c.value=!0},L=v(null),q=v("Nhận xét"),se=async()=>{console.log("Comment clicked"),t.value=!t.value,s.value!=="comment"?(s.value="comment",q.value="Văn bản",await ke(),L.value.focus()):(s.value="document",q.value="Nhận xét")};we(s,a=>{a!=="comment"?(t.value=!1,q.value="Nhận xét"):(t.value=!0,q.value="Văn bản")});const H=v(!1),ne=(a,f=null)=>{try{H.value=!0;const U=`${x}/documents/${a}`,R=document.createElement("a");R.href=U,R.download=f||a.split("/").pop(),R.style.display="none",document.body.appendChild(R),R.click(),document.body.removeChild(R),j.success("Đang tải file..."),setTimeout(()=>{H.value=!1},2e3)}catch(U){console.error("Error downloading file:",U),j.error("Có lỗi xảy ra khi tải file!"),H.value=!1}},X=v(!1),oe=async()=>{if(C.value===""){j.error("Vui lòng nhập bình luận");return}X.value=!0;try{const a=parseInt(S.params.id);await axios.post(`/api/documents/${a}/comments`,{creator_id:y.value.creator_id,comment:C.value,document_flow_step_id:parseInt(y.value.document_flow_step_id)}),j.success("Nhận xét gửi thành công"),await b.fetchDocumentComments(a),N.value=b.document_comments,C.value=""}catch(a){j.error("Có lỗi xảy ra khi gửi nhận xét"),console.error("Error sending comment:",a)}finally{X.value=!1,L.value.focus()}},le=()=>{G.info({title:"Thông báo",content:i("p",null,"Chưa đến lượt bạn phê duyệt văn bản này."),okText:"Đóng"})},ie=()=>{G.info({title:"Thông báo",content:i("p",null,"Bạn đã phê duyệt văn bản này rồi!"),okText:"Đóng"})},ae=()=>{G.info({title:"Thông báo",content:i("p",null,"Bạn đã từ chối văn bản này rồi!"),okText:"Đóng"})},de=a=>a>100||a==null?"https://avatar.iran.liara.run/public":`https://avatar.iran.liara.run/public/${a}`,re=async()=>{L.value.focus()},ce=[{title:"Bản",dataIndex:"version",key:"version",width:60,customRender:({version:a})=>a+1,align:"center"},{title:"Tên văn bản",dataIndex:"title",key:"title",width:200,customHeaderCell:()=>({style:{textAlign:"center"}})},{title:"Loại văn bản",dataIndex:"type",key:"type",width:150,align:"center",responsive:["xxl"]},{title:"Trạng thái",dataIndex:"status",key:"status",width:100,align:"center"},{title:"Ngày tạo",dataIndex:"created_at",key:"created_at",width:150,align:"center"},{title:"Thao tác",key:"action",width:150,align:"center",fixed:"right"}],Y=a=>{const f=d.value.find(U=>U.value===a);return f?f.label:"Không xác định"},I=v([]),z=v({visible:!1,title:"",description:"",type:"",version:0,file_path:""}),Q=a=>{console.log("Changing version to:",a),I.value=JSON.parse(JSON.stringify(a.document_data)),console.log("Version data:",I.value),z.value={visible:!0,title:I.value.title,description:I.value.description,type:Y(I.value.document_type_id),version:a.version,file_path:I.value.file_path}};return{apiUrl:x,user:E,document:y,pdfUrl:w,activeKey:s,commentSection:t,comment:C,document_comments:N,dayjs:W,btnCommentText:q,commentTextarea:L,loadingSendComment:X,isDownloading:H,btnApproveDisabled:V,btnRejectDisabled:n,rejectVisible:c,reasonReject:$,document_flow_steps:g,show_certificate:A,certificate_file_path:B,getAvatarUrl:F,randomAvatar:de,handleClickApprove:D,handleClickReject:te,handleClickComment:se,handleClickDownload:ne,handleSendComment:oe,handleClickNotYourTurn:le,handleRejectDocument:ee,handleClickApproved:ie,handleClickRejected:ae,handleFocusCommentInput:re,version_columns:ce,max_version:M,document_versions:h,detailVersion:z,mapTypeIdToName:Y,changeVersion:Q,customRow:a=>({onClick:()=>{Q(a)},style:{cursor:"pointer"}}),createNewVersion:a=>{G.confirm({title:"Tạo phiên bản mới",content:"Bạn có chắc chắn muốn tạo phiên bản mới từ phiên bản này?",okText:"Tạo mới",cancelText:"Hủy",onOk:()=>{try{console.log(a.document_data),a.document_data.version=a.status==="draft"?0:a.version,b.setCurrentDocumentData(a.document_data),router.push({name:"approver-documents-create"})}catch(f){console.error("Error creating new version:",f),j.error("Có lỗi xảy ra khi tạo phiên bản mới")}},onCancel:()=>{console.log("Create new version cancelled")}})}}}}),$e={class:"container-fluid"},De={key:0},Ue={class:"container py-1"},xe={class:"row justify-content-between gap-3"},Ie={class:"col-xl-7"},Re={class:"row"},Ae={class:"col text-end mb-2 mb-xl-0 align-self-top ps-3 pt-1"},Be=["href"],qe={key:0,class:"row"},Ke={class:"col text-end mb-2 mb-xl-0 align-self-top ps-3 pt-1"},Pe=["href"],Ee={key:1,class:"row"},Me={class:"col text-end mb-2 mb-xl-0 align-self-top ps-3 pt-1"},Fe=["href"],Le={class:"col"},He={class:"row mb-3"},Oe={class:"d-flex justify-content-center"},Ge={class:"fs-5 fw-bold"},Je={class:"row mb-3 border-1 border border-dark rounded-3 bg-light py-1"},Xe={class:"col align-self-center"},Ye={class:"col-10"},ze={class:"row"},Qe={class:"fw-bold"},We={class:"row"},Ze={class:"text-muted"},et={class:"row text-end"},tt={class:"text-muted"},st={key:1,class:"row mb-3"},nt={class:"col d-flex justify-content-center"},ot={class:"row mb-3"},lt={key:0},it={class:""},at={class:""},dt={key:2,class:""},rt={class:"col-xl"},ct={key:0,class:"row border-1 rounded-3 p-4 mb-4 bg-light"},ut={class:"col"},pt={class:"row mb-3"},mt={class:"col"},vt={class:"row mb-3"},bt={class:"col"},ft={class:"row border-1 rounded-3 p-4 mb-4 bg-light"},yt={class:"col"},ht={class:"row mt-3"},gt={class:"col-8"},_t={class:"row mt-3"},wt={class:"col-8"},kt={class:"row mt-3"},Ct={class:"col-8"},Tt={class:"d-flex"},Nt={class:"row mt-3"},jt={class:"col-12 mt-1"},St={class:"row mt-3"},Vt={class:"col-8"},$t={class:"row border-1 rounded-3 p-4 mb-4 bg-light"},Dt={class:"col"},Ut={class:"row mb-3"},xt={class:"text-center"},It={key:0,class:"fst-italic text-success"},Rt={key:1,class:"fst-italic text-danger"},At={key:2,class:"fst-italic text-secondary"},Bt={key:1},qt={class:"container py-1"},Kt={class:"row justify-content-between gap-3"},Pt={class:"col-xl-7"},Et={class:"row"},Mt={class:"col text-end mb-2 mb-xl-0 align-self-top ps-3 pt-1"},Ft=["href"],Lt={key:0,class:"row"},Ht={class:"col text-end mb-2 mb-xl-0 align-self-top ps-3 pt-1"},Ot=["href"],Gt={key:1,class:"row"},Jt={class:"col text-end mb-2 mb-xl-0 align-self-top ps-3 pt-1"},Xt=["href"],Yt={class:"col"},zt={class:"row mb-3"},Qt={class:"d-flex justify-content-center"},Wt={class:"fs-5 fw-bold"},Zt={class:"row mb-3 border-1 border border-dark rounded-3 bg-light py-1"},es={class:"col align-self-center"},ts={class:"col-10"},ss={class:"row"},ns={class:"fw-bold"},os={class:"row"},ls={class:"text-muted"},is={class:"row text-end"},as={class:"text-muted"},ds={key:1,class:"row mb-3"},rs={class:"col d-flex justify-content-center"},cs={class:"row mb-3"},us={key:0},ps={class:""},ms={class:""},vs={key:2,class:""},bs={class:"col-xl"},fs={class:"row border-1 rounded-3 p-4 mb-4 bg-light"},ys={class:"col"},hs={key:0,class:"row mb-3"},gs={class:"col"},_s=["disabled"],ws={class:"col"},ks=["disabled"],Cs={key:1,class:"row mb-3"},Ts={class:"col"},Ns={key:2,class:"row mb-3"},js={class:"col"},Ss={key:3,class:"row mb-3"},Vs={class:"col"},$s={class:"row mb-3"},Ds={class:"col"},Us={class:"col"},xs=["disabled"],Is={key:0},Rs={key:1},As={key:0,class:"row border-1 rounded-3 p-4 mb-4 bg-light"},Bs={class:"col"},qs={class:"row mb-3"},Ks={class:"col"},Ps={class:"row mb-3"},Es={class:"col"},Ms=["disabled"],Fs={key:0},Ls={key:1},Hs={class:"row border-1 rounded-3 p-4 mb-4 bg-light"},Os={class:"col"},Gs={class:"row mt-3"},Js={class:"col-8"},Xs={class:"row mt-3"},Ys={class:"col-8"},zs={class:"row mt-3"},Qs={class:"col-8"},Ws={class:"d-flex"},Zs={class:"row mt-3"},en={class:"col-12 mt-1"},tn={class:"row mt-3"},sn={class:"col-8"},nn={class:"row border-1 rounded-3 p-4 mb-4 bg-light"},on={class:"col"},ln={class:"row mb-3"},an={class:"text-center"},dn={key:0,class:"fst-italic text-success"},rn={key:1,class:"fst-italic text-danger"},cn={key:2,class:"fst-italic text-secondary"},un={class:"modal-content"},pn={class:"modal-body"},mn={class:"info-grid"},vn={class:"info-item"},bn={class:"info-value"},fn={class:"info-item"},yn={class:"info-value"},hn={class:"info-row"},gn={class:"info-item half"},_n={class:"info-value"},wn={class:"document-type-badge"},kn={class:"info-item half"},Cn={class:"info-value"},Tn={class:"version-badge"},Nn={class:"info-item"},jn={class:"info-value"},Sn=["href"],Vn={class:"modal-footer"};function $n(s,t,b,P,J,E){const S=k("PDFViewer"),y=k("a-tab-pane"),w=k("a-avatar"),d=k("a-button"),N=k("a-empty"),g=k("a-tooltip"),h=k("a-tag"),M=k("a-space"),A=k("a-table"),B=k("a-tabs"),T=k("a-textarea"),C=k("a-input"),x=k("NestedProgressSteps"),F=k("a-divider"),V=k("a-modal");return o(),r(K,null,[e("div",$e,[t[88]||(t[88]=e("h2",{class:"fw-bold mb-3"},"Chi tiết văn bản",-1)),s.document.from_me?(o(),r("div",De,[e("div",Ue,[e("div",xe,[e("div",Ie,[i(B,{activeKey:s.activeKey,"onUpdate:activeKey":t[0]||(t[0]=n=>s.activeKey=n),type:"card",class:"row border-1 rounded-3 p-4 mb-2 bg-light"},{default:l(()=>[i(y,{key:"document",tab:"Văn bản"},{default:l(()=>[e("div",Re,[e("div",Ae,[e("label",null,[e("a",{href:`${s.apiUrl}/documents/${s.document.file_path}`,target:"_blank",class:"text-decoration-none fst-italic"}," Mở tệp trong tab mới ",8,Be)])])]),s.show_certificate?(o(),r("div",qe,[e("div",Ke,[e("label",null,[e("a",{href:`${s.apiUrl}/documents/certificates/${s.document.certificate_path}`,target:"_blank",class:"text-decoration-none fst-italic"}," Chứng chỉ số ",8,Pe)])])])):u("",!0),s.show_certificate?(o(),r("div",Ee,[e("div",Me,[e("label",null,[e("a",{href:`${s.apiUrl}/documents/certificates/${s.certificate_file_path}`,target:"_blank",class:"text-decoration-none fst-italic"}," Văn bản đã ký số ",8,Fe)])])])):u("",!0),e("div",null,[e("div",Le,[e("div",He,[e("div",Oe,[t[28]||(t[28]=e("span",{class:"fs-5"},"Tên tài liệu:",-1)),t[29]||(t[29]=_("   ")),e("span",Ge,p(s.document.title),1)])])]),e("div",null,[i(S,{"pdf-url":s.pdfUrl},null,8,["pdf-url"])])])]),_:1}),i(y,{key:"comment",tab:`Nhận xét (${s.document_comments.total_current_comments})`,"force-render":""},{default:l(()=>[s.document_comments.total_current_comments>0?(o(!0),r(K,{key:0},Z(s.document_comments.current_comments,(n,D)=>(o(),r("div",{key:D},[e("div",Je,[e("div",Xe,[n.user.avatar?(o(),m(w,{key:0,class:"",src:s.getAvatarUrl(n.user.avatar)},null,8,["src"])):(o(),m(w,{key:1,class:"",src:s.randomAvatar(n.user.id),alt:"Random Avatar"},null,8,["src"]))]),e("div",Ye,[e("div",ze,[e("span",Qe,p(n.user.id===s.user.id?`Tôi (${n.user.name})`:n.user.name),1)]),e("div",We,[e("span",Ze,p(n.content),1)]),e("div",et,[e("span",tt,p(n.commented_at),1)])])])]))),128)):(o(),r("div",st,[e("div",nt,[i(N,{image:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTNvPNFo6a-PV4l-vMo8Hcsoj5rRr2I5XIJUQ&s","image-style":{height:"50px"}},{description:l(()=>t[30]||(t[30]=[e("span",{class:"fw-bold fs-5"},"Chưa có bình luận nào",-1),e("br",null,null,-1),e("span",null,"Hãy là người đầu tiên chia sẻ ý kiến về văn bản này",-1)])),default:l(()=>[i(d,{type:"primary",onClick:s.handleFocusCommentInput},{default:l(()=>t[31]||(t[31]=[_("Nhận xét ngay")])),_:1},8,["onClick"])]),_:1})])]))]),_:1},8,["tab"]),i(y,{key:"versions",tab:`Phiên bản (${s.document.version_count})`},{default:l(()=>[t[40]||(t[40]=e("div",{class:"row mb-3"},[e("h4",{class:"fw-bold"},"Các phiên bản")],-1)),e("div",ot,[i(A,{dataSource:s.document_versions,columns:s.version_columns,scroll:{x:576},bordered:"",customRow:s.customRow,showSorterTooltip:!1,locale:{triggerDesc:"Nhấn để sắp xếp giảm dần",triggerAsc:"Nhấn để sắp xếp tăng dần",cancelSort:"Nhấn để hủy sắp xếp"}},{headerCell:l(({column:n})=>[n.key==="title"?(o(),m(g,{key:0,title:"Sắp xếp theo tên văn bản"},{default:l(()=>[e("span",null,p(n.title),1)]),_:2},1024)):n.key==="status"?(o(),m(g,{key:1,title:"Sắp xếp theo trạng thái"},{default:l(()=>[e("span",null,p(n.title),1)]),_:2},1024)):n.key==="created_at"?(o(),m(g,{key:2,title:"Sắp xếp theo ngày tạo"},{default:l(()=>[e("span",null,p(n.title),1)]),_:2},1024)):u("",!0)]),bodyCell:l(({column:n,index:D,record:c})=>[n.key==="version"?(o(),r("span",lt,p(c.version),1)):u("",!0),n.key==="title"?(o(),m(g,{key:1},{title:l(()=>[e("span",it,p(c.document_data.description),1)]),default:l(()=>[e("span",at,p(c.document_data.title),1)]),_:2},1024)):u("",!0),n.key==="type"?(o(),r("span",dt,p(s.mapTypeIdToName(c.document_data.document_type_id)),1)):u("",!0),n.key==="status"?(o(),r(K,{key:3},[c.status==="approved"?(o(),m(h,{key:0,color:"green"},{default:l(()=>t[32]||(t[32]=[e("span",null,"Đã duyệt",-1)])),_:1})):u("",!0),c.status==="in_review"?(o(),m(h,{key:1,color:"orange"},{default:l(()=>t[33]||(t[33]=[e("span",null,"Chờ duyệt",-1)])),_:1})):u("",!0),c.status==="rejected"?(o(),m(h,{key:2,color:"red"},{default:l(()=>t[34]||(t[34]=[e("span",null,"Bị từ chối",-1)])),_:1})):u("",!0),c.status==="draft"?(o(),m(h,{key:3,color:"blue"},{default:l(()=>t[35]||(t[35]=[e("span",null,"Bản nháp",-1)])),_:1})):u("",!0)],64)):u("",!0),n.key==="action"?(o(),m(M,{key:4,class:"d-flex justify-content-center gap-3"},{default:l(()=>[i(g,null,{title:l(()=>t[36]||(t[36]=[e("span",{class:""},"Xem chi tiết",-1)])),default:l(()=>[i(d,{onClick:$=>s.changeVersion(c),class:"bg-primary text-white"},{default:l(()=>t[37]||(t[37]=[e("i",{class:"bi bi-eye"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024),c.status==="rejected"&&c.version===s.max_version||c.status==="draft"?(o(),m(g,{key:0},{title:l(()=>t[38]||(t[38]=[e("span",{class:""},"Tạo phiên bản mới",-1)])),default:l(()=>[i(d,{onClick:$=>s.createNewVersion(c),class:"bg-success text-white"},{default:l(()=>t[39]||(t[39]=[e("i",{class:"bi bi-plus-circle"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024)):u("",!0)]),_:2},1024)):u("",!0)]),_:1},8,["dataSource","columns","customRow"])])]),_:1},8,["tab"])]),_:1},8,["activeKey"])]),e("div",rt,[s.commentSection?(o(),r("div",ct,[e("div",ut,[t[42]||(t[42]=e("div",{class:"row mb-3"},[e("div",{class:"col d-flex justify-content-center"},[e("span",{class:"fs-5 fw-bold"},"Nhận xét")])],-1)),e("div",pt,[e("div",mt,[i(T,{placeholder:"Nhập nhận xét của bạn",value:s.comment,"onUpdate:value":t[1]||(t[1]=n=>s.comment=n),"show-count":"",maxlength:1e3,ref:"commentTextarea"},null,8,["value"])])]),e("div",vt,[e("div",bt,[e("button",{class:"border border-2 rounded-2 w-100 py-2 bg-secondary text-white button-click-effect",style:{"--bs-bg-opacity":".9"},onClick:t[2]||(t[2]=(...n)=>s.handleSendComment&&s.handleSendComment(...n))},t[41]||(t[41]=[e("span",null,[e("i",{class:"bi bi-chat-square-dots me-2"}),_("Gửi bình luận ")],-1)]))])])])])):u("",!0),e("div",ft,[e("div",yt,[t[50]||(t[50]=e("div",{class:"row mb-3"},[e("div",{class:"col d-flex justify-content-center"},[e("span",{class:"fs-5 fw-bold"},"Thông tin văn bản")])],-1)),e("div",ht,[t[44]||(t[44]=e("div",{class:"col text-start mb-2 mb-xl-0 align-self-center ps-3"},[e("label",null,[e("span",null,"Người tạo:")])],-1)),e("div",gt,[i(C,{value:s.document.creator_name,"onUpdate:value":t[3]||(t[3]=n=>s.document.creator_name=n),placeholder:"Văn bản số 1",disabled:""},null,8,["value"]),t[43]||(t[43]=e("div",{class:"w-100"},null,-1))])]),e("div",_t,[t[46]||(t[46]=e("div",{class:"col text-start mb-2 mb-xl-0 align-self-center ps-3"},[e("label",null,[e("span",null,"Tên văn bản:")])],-1)),e("div",wt,[i(C,{value:s.document.title,"onUpdate:value":t[4]||(t[4]=n=>s.document.title=n),placeholder:"Văn bản số 1",disabled:""},null,8,["value"]),t[45]||(t[45]=e("div",{class:"w-100"},null,-1))])]),e("div",kt,[t[47]||(t[47]=e("div",{class:"col text-start mb-2 mb-xl-0 align-self-center ps-3"},[e("label",null,[e("span",null,"Loại văn bản:")])],-1)),e("div",Ct,[e("div",Tt,[i(C,{value:s.document.type,"onUpdate:value":t[5]||(t[5]=n=>s.document.type=n),placeholder:"Love",disabled:""},null,8,["value"])])])]),e("div",Nt,[t[48]||(t[48]=e("div",{class:"col text-start mb-2 mb-xl-0 align-self-center ps-3"},[e("label",null,[e("span",null,"Mô tả:")])],-1)),e("div",jt,[i(T,{placeholder:"Mô tả đơn giản",value:s.document.description,"onUpdate:value":t[6]||(t[6]=n=>s.document.description=n),"show-count":"",maxlength:1e3,disabled:""},null,8,["value"])])]),e("div",St,[t[49]||(t[49]=e("div",{class:"col text-start mb-2 mb-xl-0 align-self-center ps-3"},[e("label",null,[e("span",null,"Ngày tạo:")])],-1)),e("div",Vt,[i(C,{value:s.document.created_at,"onUpdate:value":t[7]||(t[7]=n=>s.document.created_at=n),placeholder:"Ngày chờ, tháng nhớ, năm mong",disabled:""},null,8,["value"])])])])]),e("div",$t,[e("div",Dt,[e("div",Ut,[e("div",xt,[t[51]||(t[51]=e("span",{class:"fs-5 fw-bold"},"Luồng phê duyệt",-1)),t[52]||(t[52]=e("br",null,null,-1)),s.document.status==="approved"?(o(),r("span",It,"Đã được duyệt")):s.document.status==="rejected"?(o(),r("span",Rt,"Bị từ chối")):(o(),r("span",At,"Tiến độ: "+p(s.document_flow_steps.progress_percentage)+"%",1))]),s.document_flow_steps&&Object.keys(s.document_flow_steps).length>0?(o(),m(x,{key:0,steps:s.document_flow_steps},null,8,["steps"])):u("",!0)])])])])])])])):(o(),r("div",Bt,[e("div",qt,[e("div",Kt,[e("div",Pt,[i(B,{activeKey:s.activeKey,"onUpdate:activeKey":t[8]||(t[8]=n=>s.activeKey=n),type:"card",class:"row border-1 rounded-3 p-4 mb-2 bg-light"},{default:l(()=>[i(y,{key:"document",tab:"Văn bản"},{default:l(()=>[e("div",Et,[e("div",Mt,[e("label",null,[e("a",{href:`${s.apiUrl}/documents/${s.document.file_path}`,target:"_blank",class:"text-decoration-none fst-italic"}," Mở tệp trong tab mới ",8,Ft)])])]),s.show_certificate?(o(),r("div",Lt,[e("div",Ht,[e("label",null,[e("a",{href:`${s.apiUrl}/documents/certificates/${s.document.certificate_path}`,target:"_blank",class:"text-decoration-none fst-italic"}," Chứng chỉ số ",8,Ot)])])])):u("",!0),s.show_certificate?(o(),r("div",Gt,[e("div",Jt,[e("label",null,[e("a",{href:`${s.apiUrl}/documents/certificates/${s.certificate_file_path}`,target:"_blank",class:"text-decoration-none fst-italic"}," Văn bản đã ký số ",8,Xt)])])])):u("",!0),e("div",null,[e("div",Yt,[e("div",zt,[e("div",Qt,[t[53]||(t[53]=e("span",{class:"fs-5"},"Tên tài liệu:",-1)),t[54]||(t[54]=_("   ")),e("span",Wt,p(s.document.title),1)])])]),e("div",null,[i(S,{"pdf-url":s.pdfUrl},null,8,["pdf-url"])])])]),_:1}),i(y,{key:"comment",tab:`Nhận xét (${s.document_comments.total_current_comments})`,"force-render":""},{default:l(()=>[s.document_comments.total_current_comments>0?(o(!0),r(K,{key:0},Z(s.document_comments.current_comments,(n,D)=>(o(),r("div",{key:D},[e("div",Zt,[e("div",es,[n.user.avatar?(o(),m(w,{key:0,class:"",src:s.getAvatarUrl(n.user.avatar)},null,8,["src"])):(o(),m(w,{key:1,class:"",src:s.randomAvatar(n.user.id),alt:"Random Avatar"},null,8,["src"]))]),e("div",ts,[e("div",ss,[e("span",ns,p(n.user.id===s.user.id?`Tôi (${n.user.name})`:n.user.name),1)]),e("div",os,[e("span",ls,p(n.content),1)]),e("div",is,[e("span",as,p(n.commented_at),1)])])])]))),128)):(o(),r("div",ds,[e("div",rs,[i(N,{image:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTNvPNFo6a-PV4l-vMo8Hcsoj5rRr2I5XIJUQ&s","image-style":{height:"50px"}},{description:l(()=>t[55]||(t[55]=[e("span",{class:"fw-bold fs-5"},"Chưa có bình luận nào",-1),e("br",null,null,-1),e("span",null,"Hãy là người đầu tiên chia sẻ ý kiến về văn bản này",-1)])),default:l(()=>[i(d,{type:"primary",onClick:s.handleFocusCommentInput},{default:l(()=>t[56]||(t[56]=[_("Nhận xét ngay")])),_:1},8,["onClick"])]),_:1})])]))]),_:1},8,["tab"]),i(y,{key:"versions",tab:`Phiên bản (${s.document.version_count})`},{default:l(()=>[t[65]||(t[65]=e("div",{class:"row mb-3"},[e("h4",{class:"fw-bold"},"Các phiên bản")],-1)),e("div",cs,[i(A,{dataSource:s.document_versions,columns:s.version_columns,scroll:{x:576},bordered:"",customRow:s.customRow,showSorterTooltip:!1,locale:{triggerDesc:"Nhấn để sắp xếp giảm dần",triggerAsc:"Nhấn để sắp xếp tăng dần",cancelSort:"Nhấn để hủy sắp xếp"}},{headerCell:l(({column:n})=>[n.key==="title"?(o(),m(g,{key:0,title:"Sắp xếp theo tên văn bản"},{default:l(()=>[e("span",null,p(n.title),1)]),_:2},1024)):n.key==="status"?(o(),m(g,{key:1,title:"Sắp xếp theo trạng thái"},{default:l(()=>[e("span",null,p(n.title),1)]),_:2},1024)):n.key==="created_at"?(o(),m(g,{key:2,title:"Sắp xếp theo ngày tạo"},{default:l(()=>[e("span",null,p(n.title),1)]),_:2},1024)):u("",!0)]),bodyCell:l(({column:n,index:D,record:c})=>[n.key==="version"?(o(),r("span",us,p(c.version),1)):u("",!0),n.key==="title"?(o(),m(g,{key:1},{title:l(()=>[e("span",ps,p(c.document_data.description??"Không có mô tả"),1)]),default:l(()=>[e("span",ms,p(c.document_data.title),1)]),_:2},1024)):u("",!0),n.key==="type"?(o(),r("span",vs,p(s.mapTypeIdToName(c.document_data.document_type_id)),1)):u("",!0),n.key==="status"?(o(),r(K,{key:3},[c.status==="approved"?(o(),m(h,{key:0,color:"green"},{default:l(()=>t[57]||(t[57]=[e("span",null,"Đã duyệt",-1)])),_:1})):u("",!0),c.status==="in_review"?(o(),m(h,{key:1,color:"orange"},{default:l(()=>t[58]||(t[58]=[e("span",null,"Chờ duyệt",-1)])),_:1})):u("",!0),c.status==="rejected"?(o(),m(h,{key:2,color:"red"},{default:l(()=>t[59]||(t[59]=[e("span",null,"Bị từ chối",-1)])),_:1})):u("",!0),c.status==="draft"?(o(),m(h,{key:3,color:"blue"},{default:l(()=>t[60]||(t[60]=[e("span",null,"Bản nháp",-1)])),_:1})):u("",!0)],64)):u("",!0),n.key==="action"?(o(),m(M,{key:4,class:"d-flex justify-content-center gap-3"},{default:l(()=>[i(g,null,{title:l(()=>t[61]||(t[61]=[e("span",{class:""},"Xem chi tiết",-1)])),default:l(()=>[i(d,{onClick:$=>s.changeVersion(c),class:"bg-primary text-white"},{default:l(()=>t[62]||(t[62]=[e("i",{class:"bi bi-eye"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024),c.status==="rejected"&&c.version===s.max_version||c.status==="draft"?(o(),m(g,{key:0},{title:l(()=>t[63]||(t[63]=[e("span",{class:""},"Tạo phiên bản mới",-1)])),default:l(()=>[i(d,{onClick:$=>s.createNewVersion(c),class:"bg-success text-white"},{default:l(()=>t[64]||(t[64]=[e("i",{class:"bi bi-plus-circle"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024)):u("",!0)]),_:2},1024)):u("",!0)]),_:1},8,["dataSource","columns","customRow"])])]),_:1},8,["tab"])]),_:1},8,["activeKey"])]),e("div",bs,[e("div",fs,[e("div",ys,[t[74]||(t[74]=e("div",{class:"row mb-3"},[e("div",{class:"col d-flex justify-content-center"},[e("span",{class:"fs-5 fw-bold"},"Phê duyệt văn bản")])],-1)),s.document.step_status==="in_review"?(o(),r("div",hs,[e("div",gs,[e("button",{class:"border border-2 rounded-2 text-white bg-success w-100 py-2 button-click-effect",style:{"--bs-bg-opacity":".9"},onClick:t[9]||(t[9]=(...n)=>s.handleClickApprove&&s.handleClickApprove(...n)),disabled:s.btnApproveDisabled},t[66]||(t[66]=[e("span",null,[e("i",{class:"bi bi-check-lg me-1"}),_("Chấp thuận ")],-1)]),8,_s)]),e("div",ws,[e("button",{class:"border border-2 rounded-2 text-white bg-danger w-100 py-2 button-click-effect",style:{"--bs-bg-opacity":".9"},onClick:t[10]||(t[10]=(...n)=>s.handleClickReject&&s.handleClickReject(...n)),disabled:s.btnRejectDisabled},t[67]||(t[67]=[e("span",null,[e("i",{class:"bi bi-x-lg me-2"}),_("Từ chối ")],-1)]),8,ks)])])):s.document.step_status==="pending"?(o(),r("div",Cs,[e("div",Ts,[e("button",{class:"border border-2 rounded-2 text-white bg-warning w-100 py-2 button-click-effect",style:{"--bs-bg-opacity":"1"},onClick:t[11]||(t[11]=(...n)=>s.handleClickNotYourTurn&&s.handleClickNotYourTurn(...n))},t[68]||(t[68]=[e("span",null,[e("i",{class:"bi bi-hourglass-split me-2"}),_("Chưa đến lượt bạn đâu ")],-1)]))])])):s.document.step_status==="approved"?(o(),r("div",Ns,[e("div",js,[e("button",{class:"border border-2 rounded-2 text-white bg-success w-100 py-2 button-click-effect",style:{"--bs-bg-opacity":"1"},onClick:t[12]||(t[12]=(...n)=>s.handleClickApproved&&s.handleClickApproved(...n))},t[69]||(t[69]=[e("span",null," Bạn đã đồng ý văn bản này rồi! ",-1)]))])])):s.document.step_status==="rejected"?(o(),r("div",Ss,[e("div",Vs,[e("button",{class:"border border-2 rounded-2 text-white bg-danger w-100 py-2 button-click-effect",style:{"--bs-bg-opacity":"1"},onClick:t[13]||(t[13]=(...n)=>s.handleClickRejected&&s.handleClickRejected(...n))},t[70]||(t[70]=[e("span",null," Bạn đã từ chối văn bản này rồi! ",-1)]))])])):u("",!0),e("div",$s,[e("div",Ds,[e("button",{class:"border border-2 rounded-2 w-100 py-2 bg-secondary text-white button-click-effect",style:{"--bs-bg-opacity":".9"},onClick:t[14]||(t[14]=(...n)=>s.handleClickComment&&s.handleClickComment(...n))},[e("span",null,[t[71]||(t[71]=e("i",{class:"bi bi-chat-square-dots me-2"},null,-1)),_(p(s.btnCommentText),1)])])]),e("div",Us,[e("button",{class:"border border-2 rounded-2 w-100 py-2 text-white bg-primary button-click-effect",style:{"--bs-bg-opacity":".9"},onClick:t[15]||(t[15]=n=>s.handleClickDownload(s.document.file_path,s.document.title)),disabled:s.isDownloading},[s.isDownloading?(o(),r("span",Rs,t[73]||(t[73]=[e("i",{class:"bi bi-hourglass-split me-2"},null,-1),_("Đang tải... ")]))):(o(),r("span",Is,t[72]||(t[72]=[e("i",{class:"bi bi-download me-2"},null,-1),_("Tải xuống ")])))],8,xs)])])])]),s.commentSection?(o(),r("div",As,[e("div",Bs,[t[77]||(t[77]=e("div",{class:"row mb-3"},[e("div",{class:"col d-flex justify-content-center"},[e("span",{class:"fs-5 fw-bold"},"Nhận xét")])],-1)),e("div",qs,[e("div",Ks,[i(T,{placeholder:"Nhập nhận xét của bạn",value:s.comment,"onUpdate:value":t[16]||(t[16]=n=>s.comment=n),"show-count":"",maxlength:1e3,ref:"commentTextarea"},null,8,["value"])])]),e("div",Ps,[e("div",Es,[e("button",{class:"border border-2 rounded-2 w-100 py-2 bg-secondary text-white button-click-effect",style:{"--bs-bg-opacity":".9"},onClick:t[17]||(t[17]=(...n)=>s.handleSendComment&&s.handleSendComment(...n)),disabled:s.loadingSendComment},[s.loadingSendComment?(o(),r("span",Fs,t[75]||(t[75]=[e("i",{class:"spinner-border spinner-border-sm me-2"},null,-1),_(" Đang gửi nhận xét... ")]))):(o(),r("span",Ls,t[76]||(t[76]=[e("i",{class:"bi bi-chat-square-dots me-2"},null,-1),_("Gửi nhận xét ")])))],8,Ms)])])])])):u("",!0),e("div",Hs,[e("div",Os,[t[85]||(t[85]=e("div",{class:"row mb-3"},[e("div",{class:"col d-flex justify-content-center"},[e("span",{class:"fs-5 fw-bold"},"Thông tin văn bản")])],-1)),e("div",Gs,[t[79]||(t[79]=e("div",{class:"col text-start mb-2 mb-xl-0 align-self-center ps-3"},[e("label",null,[e("span",null,"Người tạo:")])],-1)),e("div",Js,[i(C,{value:s.document.creator_name,"onUpdate:value":t[18]||(t[18]=n=>s.document.creator_name=n),placeholder:"Văn bản số 1",disabled:""},null,8,["value"]),t[78]||(t[78]=e("div",{class:"w-100"},null,-1))])]),e("div",Xs,[t[81]||(t[81]=e("div",{class:"col text-start mb-2 mb-xl-0 align-self-center ps-3"},[e("label",null,[e("span",null,"Tên văn bản:")])],-1)),e("div",Ys,[i(C,{value:s.document.title,"onUpdate:value":t[19]||(t[19]=n=>s.document.title=n),placeholder:"Văn bản số 1",disabled:""},null,8,["value"]),t[80]||(t[80]=e("div",{class:"w-100"},null,-1))])]),e("div",zs,[t[82]||(t[82]=e("div",{class:"col text-start mb-2 mb-xl-0 align-self-center ps-3"},[e("label",null,[e("span",null,"Loại văn bản:")])],-1)),e("div",Qs,[e("div",Ws,[i(C,{value:s.document.type,"onUpdate:value":t[20]||(t[20]=n=>s.document.type=n),placeholder:"Love",disabled:""},null,8,["value"])])])]),e("div",Zs,[t[83]||(t[83]=e("div",{class:"col text-start mb-2 mb-xl-0 align-self-center ps-3"},[e("label",null,[e("span",null,"Mô tả:")])],-1)),e("div",en,[i(T,{placeholder:"Mô tả đơn giản",value:s.document.description,"onUpdate:value":t[21]||(t[21]=n=>s.document.description=n),"show-count":"",maxlength:1e3,disabled:""},null,8,["value"])])]),e("div",tn,[t[84]||(t[84]=e("div",{class:"col text-start mb-2 mb-xl-0 align-self-center ps-3"},[e("label",null,[e("span",null,"Ngày tạo:")])],-1)),e("div",sn,[i(C,{value:s.document.created_at,"onUpdate:value":t[22]||(t[22]=n=>s.document.created_at=n),placeholder:"Ngày chờ, tháng nhớ, năm mong",disabled:""},null,8,["value"])])])])]),e("div",nn,[e("div",on,[e("div",ln,[e("div",an,[t[86]||(t[86]=e("span",{class:"fs-5 fw-bold"},"Luồng phê duyệt",-1)),t[87]||(t[87]=e("br",null,null,-1)),s.document.document_status==="approved"?(o(),r("span",dn,"Đã được duyệt")):s.document.document_status==="rejected"?(o(),r("span",rn,"Bị từ chối")):(o(),r("span",cn,"Tiến độ: "+p(s.document_flow_steps.progress_percentage)+"%",1))]),s.document_flow_steps&&Object.keys(s.document_flow_steps).length>0?(o(),m(x,{key:0,steps:s.document_flow_steps},null,8,["steps"])):u("",!0)])])])])])])]))]),i(V,{open:s.rejectVisible,"onUpdate:open":t[25]||(t[25]=n=>s.rejectVisible=n),width:"600px"},{footer:l(()=>[i(d,{onClick:t[24]||(t[24]=n=>s.rejectVisible=!1)},{default:l(()=>t[91]||(t[91]=[_("Hủy")])),_:1}),i(d,{type:"primary",onClick:s.handleRejectDocument},{default:l(()=>t[92]||(t[92]=[_("Từ chối")])),_:1},8,["onClick"])]),default:l(()=>[e("div",null,[t[90]||(t[90]=e("h5",null,"❌ Từ chối văn bản",-1)),i(F),e("div",null,[t[89]||(t[89]=e("span",null,"Lý do chia tay là gì, em có biết không???",-1)),i(T,{value:s.reasonReject,"onUpdate:value":t[23]||(t[23]=n=>s.reasonReject=n),placeholder:"Vì em không yêu anh như anh yêu em, vì em xem anh chỉ là nhất thời.","show-count":"",maxlength:1e3,rows:"4",class:"mb-5"},null,8,["value"])]),i(F)])]),_:1},8,["open"]),i(V,{open:s.detailVersion.visible,"onUpdate:open":t[27]||(t[27]=n=>s.detailVersion.visible=n),width:"480px",zIndex:1e4,footer:null,centered:"",class:"document-modal"},{default:l(()=>[e("div",un,[t[99]||(t[99]=e("div",{class:"modal-header"},[e("div",{class:"header-content"},[e("span",{class:"header-icon"},"📄"),e("h3",{class:"modal-title"},"Thông tin văn bản")])],-1)),e("div",pn,[e("div",mn,[e("div",vn,[t[93]||(t[93]=e("div",{class:"info-label"},"📝 Tiêu đề",-1)),e("div",bn,p(s.detailVersion.title),1)]),e("div",fn,[t[94]||(t[94]=e("div",{class:"info-label"},"📋 Mô tả",-1)),e("div",yn,p(s.detailVersion.description??"Không có mô tả"),1)]),e("div",hn,[e("div",gn,[t[95]||(t[95]=e("div",{class:"info-label"},"🏷️ Loại văn bản",-1)),e("div",_n,[e("span",wn,p(s.detailVersion.type),1)])]),e("div",kn,[t[96]||(t[96]=e("div",{class:"info-label"},"🔢 Phiên bản",-1)),e("div",Cn,[e("span",Tn,"v"+p(s.detailVersion.version),1)])])]),e("div",Nn,[t[97]||(t[97]=e("div",{class:"info-label"},"📎 Tệp đính kèm",-1)),e("div",jn,[e("a",{href:`${s.apiUrl}/documents/${s.detailVersion.file_path}`,target:"_blank",class:"file-link"}," 📂 Xem tệp 🔗 ",8,Sn)])])])]),e("div",Vn,[i(d,{type:"primary",onClick:t[26]||(t[26]=n=>s.detailVersion.visible=!1),class:"close-button"},{default:l(()=>t[98]||(t[98]=[_(" Đóng ")])),_:1})])])]),_:1},8,["open"])],64)}const qn=me(Ve,[["render",$n],["__scopeId","data-v-3af52b70"]]);export{qn as default};
