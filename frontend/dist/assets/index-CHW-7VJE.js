import{P as z}from"./PDFViewer-Otsyj74_.js";import{a0 as M,g as c,G as F,m as q,_ as G,c as b,a as t,I as P,b as o,d as n,r as m,n as Q,q as S,N as r,C as H,k as A,i as J,j as O,H as d,o as w,x as W}from"./index-CqN3-FrM.js";import{_ as X}from"./logo_tlu-B7rE08lr.js";const Z=M("certificate",()=>{const a=c(null);async function e(_){try{const i=await F.get(`api/document-certificates/${_}`);return i.data&&i.data.certificate?(console.log("Certificate found:",i.data.certificate),a.value=null,await q(),a.value=i.data.certificate,console.log("Current certificate set:",a.value),i.data.certificate):(a.value=null,null)}catch(i){throw console.error("Error fetching certificate:",i),a.value=null,i}}return{certificates:a,findCertificateByCode:e}}),$={name:"DocumentLookup",components:{PDFViewer:z},setup(){const a=c(""),e=c(!1),_=c(!1),i=c(0),V=c(null),D=c(null),f=c(!1),l=c(null),y=c(0),u=Z(),x=c("Minh2k3"),p=H(()=>new Date().getFullYear()),k=s=>s.toLocaleDateString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit"}),C=s=>s.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),h=H(()=>{var s;if((s=u.certificates)!=null&&s.file_path){const v=u.certificates.file_path;return v.includes("/")?v.split("/").pop():v}return null});A(h,(s,v)=>{s&&s!==v&&(i.value+=1,d.info("Đang tải tài liệu...",2))});const g=()=>{const s=window.scrollY;s>y.value&&s>100?(l.value&&clearTimeout(l.value),l.value=setTimeout(()=>{f.value=!0},4e3)):(l.value&&(clearTimeout(l.value),l.value=null),f.value=!1),y.value=s},U=()=>{l.value&&(clearTimeout(l.value),l.value=null),f.value=!1},N=async()=>{if(!a.value.trim()){d.warning("Vui lòng nhập mã tài liệu");return}e.value=!0,_.value=!0;try{u.certificates=null,await u.findCertificateByCode(a.value.trim())||d.info("Không tìm thấy tài liệu với mã này")}catch(s){console.error("Search error:",s),d.error("Có lỗi xảy ra khi tìm kiếm tài liệu")}finally{e.value=!1}},E=()=>{a.value="",_.value=!1,u.certificates=null,i.value+=1},I=()=>{window.scrollTo({top:0,behavior:"smooth"})},K=()=>{var s;(s=document.querySelector(".search-section"))==null||s.scrollIntoView({behavior:"smooth"})},R=()=>{var s;if(h.value){const L=`https://tminh.id.vn/api/pdf-proxy?file=${encodeURIComponent(h.value)}`,T=document.createElement("a");T.href=L,T.download=`${((s=u.certificates)==null?void 0:s.code)||"document"}.pdf`,T.click(),d.success("Đang tải xuống tài liệu...",3)}else d.error("Không có tài liệu để tải xuống")},j=()=>{if(h.value){const v=`https://tminh.id.vn/api/pdf-proxy?file=${encodeURIComponent(h.value)}`;window.open(v,"_blank"),d.info("Đang mở tài liệu để in...",3)}else d.error("Không có tài liệu để in")},B=s=>{d.success(`Tài liệu đã được tải thành công (${s.totalPages} trang)`,3)},Y=s=>{d.error("Không thể tải tài liệu PDF. Vui lòng thử lại sau.")};return J(()=>{window.addEventListener("scroll",g)}),O(()=>{window.removeEventListener("scroll",g),l.value&&clearTimeout(l.value)}),{searchCode:a,loading:e,hasSearched:_,certificateStore:u,pdfUrl:h,pdfViewerKey:i,pdfViewerRef:V,pdfContainer:D,isHeaderHidden:f,currentUser:x,currentYear:p,handleSearch:N,clearSearch:E,scrollToTop:I,scrollToSearch:K,downloadDocument:R,printDocument:j,onPdfLoaded:B,onPdfError:Y,showHeader:U,formatDate:k,formatTime:C}}},tt={class:"document-lookup-container"},et={class:"container d-flex justify-content-between align-items-center"},it={class:"d-none d-md-flex"},st={class:"gap-2 d-flex align-items-center"},ot={class:"search-section"},nt={class:"container"},lt={class:"row justify-content-center"},at={class:"col-lg-8 col-md-10"},ct={class:"search-form"},rt={key:0,class:"document-section"},dt={class:"container"},ut={class:"row"},mt={class:"col-12"},ft={class:"d-flex justify-content-between align-items-center flex-wrap"},ht={class:"document-actions"},vt={class:"pdf-section"},pt={class:"pdf-viewer-container",ref:"pdfContainer"},_t={key:1,class:"no-results-section"},gt={class:"container"},wt={class:"row justify-content-center"},bt={class:"col-lg-6"},yt={class:"text-center py-5"},kt={class:"no-result-text"},xt={class:"text-primary"},Ct={class:"mt-4"},Tt={key:2,class:"welcome-section"},St={class:"container"},Vt={class:"row justify-content-center"},Dt={class:"col-lg-8"},Lt={key:3,class:"loading-section"},Pt={class:"container"},Ht={class:"row justify-content-center"},Ut={class:"col-lg-6"},Nt={class:"text-center py-5"},Et={class:"floating-actions d-md-none"},It={class:"footer-section bg-header text-white py-4"},Kt={class:"container-fluid"},Rt={class:"text-center"},jt={class:"footer-text mb-3"},Bt={class:"text-white-50"};function Yt(a,e,_,i,V,D){const f=m("router-link"),l=m("a-button"),y=m("a-input-search"),u=m("a-form-item"),x=m("a-form"),p=m("a-card"),k=m("a-tooltip"),C=m("PDFViewer"),h=m("a-spin");return w(),b("div",tt,[t("header",{class:Q(["bg-header text-white py-4",{"header-hidden":i.isHeaderHidden}])},[t("div",et,[e[5]||(e[5]=t("div",{class:"d-flex align-items-center"},[t("img",{src:X,alt:"Logo ĐH Thủy Lợi",class:"me-2",style:{height:"40px",width:"40px"}}),t("span",{class:"fs-4 mb-0 fw-bold"},"ĐH THỦY LỢI")],-1)),t("nav",it,[o(f,{to:"/",class:"text-white mx-3 text-decoration-none fw-medium"},{default:n(()=>e[2]||(e[2]=[t("span",{class:"fw-bold text-uppercase fs-3"},"tra cứu chứng chỉ",-1)])),_:1})]),t("div",st,[o(f,{to:"/"},{default:n(()=>[o(l,{type:"primary",ghost:"",class:"bg-white text-primary btn-link"},{default:n(()=>e[3]||(e[3]=[r("Trang chủ")])),_:1})]),_:1}),o(f,{to:"/login"},{default:n(()=>[o(l,{type:"primary",ghost:"",class:"bg-white text-primary btn-link"},{default:n(()=>e[4]||(e[4]=[r("Đăng nhập")])),_:1})]),_:1})])])],2),t("div",{class:"header-trigger",onMouseenter:e[0]||(e[0]=(...g)=>i.showHeader&&i.showHeader(...g))},null,32),t("div",ot,[t("div",nt,[t("div",lt,[t("div",at,[o(p,{class:"search-card",bordered:!1},{default:n(()=>[t("div",ct,[o(x,{onSubmit:i.handleSearch,layout:"vertical"},{default:n(()=>[o(u,{label:"Mã tài liệu",class:"mb-3"},{default:n(()=>[o(y,{value:i.searchCode,"onUpdate:value":e[1]||(e[1]=g=>i.searchCode=g),placeholder:"Nhập mã tài liệu cần tra cứu (VD: 20-1751203066)...",size:"large","enter-button":"Tìm kiếm",loading:i.loading,onSearch:i.handleSearch,class:"search-input"},{enterButton:n(()=>[o(l,{type:"primary",loading:i.loading},{default:n(()=>e[6]||(e[6]=[t("i",{class:"bi bi-search me-1"},null,-1),r(" Tìm kiếm ")])),_:1},8,["loading"])]),_:1},8,["value","loading","onSearch"])]),_:1})]),_:1},8,["onSubmit"])])]),_:1})])])])]),i.certificateStore.certificates?(w(),b("div",rt,[t("div",dt,[t("div",ut,[t("div",mt,[o(p,{class:"document-card"},{title:n(()=>[t("div",ft,[t("div",ht,[o(k,{title:"Tải xuống tài liệu"},{default:n(()=>[o(l,{type:"primary",shape:"circle",size:"large",onClick:i.downloadDocument,class:"action-btn download-btn me-2"},{default:n(()=>e[7]||(e[7]=[t("i",{class:"bi bi-download"},null,-1)])),_:1},8,["onClick"])]),_:1}),o(k,{title:"In tài liệu"},{default:n(()=>[o(l,{shape:"circle",size:"large",onClick:i.printDocument,class:"action-btn print-btn"},{default:n(()=>e[8]||(e[8]=[t("i",{class:"bi bi-printer"},null,-1)])),_:1},8,["onClick"])]),_:1})])])]),default:n(()=>[t("div",vt,[e[9]||(e[9]=t("div",{class:"pdf-header"},[t("h5",{class:"section-title"},[t("i",{class:"bi bi-file-earmark-pdf me-2"}),r(" Nội dung tài liệu ")])],-1)),t("div",pt,[(w(),W(C,{key:i.pdfViewerKey,"pdf-url":i.pdfUrl,onPdfLoaded:i.onPdfLoaded,onPdfError:i.onPdfError,ref:"pdfViewerRef"},null,8,["pdf-url","onPdfLoaded","onPdfError"]))],512)])]),_:1})])])])])):i.hasSearched&&!i.loading?(w(),b("div",_t,[t("div",gt,[t("div",wt,[t("div",bt,[o(p,{class:"empty-state-card"},{default:n(()=>[t("div",yt,[e[14]||(e[14]=t("div",{class:"empty-icon"},[t("i",{class:"bi bi-file-earmark-x"})],-1)),e[15]||(e[15]=t("h4",{class:"mt-3 no-result-title"},"Không tìm thấy tài liệu",-1)),t("p",kt,[e[10]||(e[10]=r(' Không tìm thấy tài liệu với mã "')),t("strong",xt,S(i.searchCode),1),e[11]||(e[11]=r('" '))]),e[16]||(e[16]=t("p",{class:"no-result-hint"}," Vui lòng kiểm tra lại mã tài liệu và thử lại. ",-1)),t("div",Ct,[o(l,{type:"primary",onClick:i.clearSearch,class:"me-2"},{default:n(()=>e[12]||(e[12]=[t("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),r(" Tìm kiếm lại ")])),_:1},8,["onClick"]),o(l,{onClick:i.scrollToSearch},{default:n(()=>e[13]||(e[13]=[t("i",{class:"bi bi-arrow-up me-1"},null,-1),r(" Về đầu trang ")])),_:1},8,["onClick"])])])]),_:1})])])])])):!i.hasSearched&&!i.loading?(w(),b("div",Tt,[t("div",St,[t("div",Vt,[t("div",Dt,[o(p,{class:"welcome-card"},{default:n(()=>e[17]||(e[17]=[t("div",{class:"text-center py-5"},[t("div",{class:"welcome-icon"},[t("i",{class:"bi bi-search"})]),t("h4",{class:"mt-3 welcome-title"},"Tra cứu tài liệu đã ký số"),t("p",{class:"welcome-text"}," Nhập mã tài liệu vào ô tìm kiếm phía trên để xem thông tin chi tiết và nội dung tài liệu đã được ký số. "),t("div",{class:"search-tips mt-5"},[t("h6",{class:"tips-title"},[t("i",{class:"bi bi-lightbulb me-2"}),r(" Hướng dẫn sử dụng ")]),t("div",{class:"tips-content"},[t("div",{class:"row g-4 mt-2"},[t("div",{class:"col-md-4"},[t("div",{class:"tip-item"},[t("div",{class:"tip-icon"},[t("i",{class:"bi bi-123"})]),t("h6",null,"Mã tài liệu"),t("p",null,"Mã có dạng: 20-1751203066, QĐ-123/2024")])]),t("div",{class:"col-md-4"},[t("div",{class:"tip-item"},[t("div",{class:"tip-icon"},[t("i",{class:"bi bi-shield-check"})]),t("h6",null,"Tài liệu đã ký"),t("p",null,"Chỉ hiển thị văn bản đã được ký số")])]),t("div",{class:"col-md-4"},[t("div",{class:"tip-item"},[t("div",{class:"tip-icon"},[t("i",{class:"bi bi-download"})]),t("h6",null,"Tải xuống"),t("p",null,"Có thể tải về và in tài liệu")])])])])])],-1)])),_:1})])])])])):P("",!0),i.loading?(w(),b("div",Lt,[t("div",Pt,[t("div",Ht,[t("div",Ut,[o(p,{class:"loading-card"},{default:n(()=>[t("div",Nt,[o(h,{size:"large"}),e[18]||(e[18]=t("h5",{class:"mt-3 loading-text"},"Đang tìm kiếm tài liệu...",-1)),e[19]||(e[19]=t("p",{class:"loading-hint"},"Vui lòng chờ trong giây lát",-1))])]),_:1})])])])])):P("",!0),t("div",Et,[o(l,{type:"primary",shape:"circle",size:"large",onClick:i.scrollToTop,class:"fab-scroll-top"},{default:n(()=>e[20]||(e[20]=[t("i",{class:"bi bi-arrow-up"},null,-1)])),_:1},8,["onClick"])]),t("div",It,[t("div",Kt,[t("div",Rt,[t("p",jt," © "+S(i.currentYear)+" Đại học Thủy lợi - Hệ thống quản lý tài liệu điện tử ",1),t("small",Bt,[e[21]||(e[21]=t("i",{class:"bi bi-calendar me-1"},null,-1)),r(" "+S(i.formatDate(new Date)),1)])])])])])}const qt=G($,[["render",Yt],["__scopeId","data-v-115de582"]]);export{qt as default};
