import{_ as A,c as I,a as s,b as c,J as u,r as i,d as o,A as K,z as N,g as w,C as B,B as L,i as M,H as V,D as H,o as d,x as p,I as j,q as m}from"./index-u6IXU-LR.js";import{u as E}from"./use-menu-CupLMQve.js";const J={name:"DocumentFlowsManagement",setup(){const k=H();E().onSelectedKeys(["admin-approval-flows"]);const a=K();N();const y=w(!1),n=w([]),_=w(""),g=w(""),b=B(()=>{let e=[...n.value];if(_.value){const t=_.value.toLowerCase();e=e.filter(l=>{var f,v;return((f=l.name)==null?void 0:f.toLowerCase().includes(t))||((v=l.description)==null?void 0:v.toLowerCase().includes(t))})}if(g.value!==""){const t=g.value==="1";e=e.filter(l=>l.is_active===t)}return r.total=e.length,e}),h=async()=>{try{y.value=!0,await a.fetchDocumentFlowTemplates(),n.value=a.document_flow_templates,console.log("Document Flow Templates:",n.value)}catch(e){console.error("Error fetching flows:",e),V.error("Không thể tải danh sách luồng phê duyệt")}finally{y.value=!1}};M(async()=>{await h()});const r=L({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`${t[0]}-${t[1]} của ${e} bản ghi`});return{loading:y,flowsData:n,filteredFlowsData:b,searchText:_,statusFilter:g,pagination:r,columns:[{title:"Tên luồng",dataIndex:"name",key:"name",sorter:!0,ellipsis:!0},{title:"Mô tả",dataIndex:"description",key:"description",ellipsis:!0,width:200},{title:"Người tạo",dataIndex:"created_by",key:"created_by",width:120,align:"center"},{title:"Số bước",dataIndex:"process",key:"process",width:80,align:"center",sorter:!0},{title:"Trạng thái",dataIndex:"is_active",key:"is_active",width:100,align:"center"},{title:"Ngày tạo",dataIndex:"created_at",key:"created_at",width:120,align:"center",sorter:!0},{title:"Thao tác",key:"action",width:180,align:"center",fixed:"right"}],fetchFlows:h,handleSearch:e=>{r.current=1},handleStatusFilter:e=>{r.current=1},handleTableChange:(e,t,l)=>{r.current=e.current,r.pageSize=e.pageSize,e.current,e.pageSize,_.value,g.value,l.field&&(l.field,l.order)},formatDate:e=>{if(!e)return"";try{const t=new Date(e),l=t.getDate().toString().padStart(2,"0"),f=(t.getMonth()+1).toString().padStart(2,"0"),v=t.getFullYear();return`${l}/${f}/${v}`}catch{return""}},handleClickAddFlow:()=>{k.push({name:"admin-approval-flows-create"})},viewFlow:e=>{k.push({name:"admin-approval-flows-detail",params:{id:e.id}})}}}},Q={class:"document-flows-management"},U={class:"mb-3 d-flex justify-content-end"},q={class:"row mb-3"},R={class:"col-md-6"},X={class:"col-md-6"},Y={key:4};function G(k,a,y,n,_,g){const b=i("a-input-search"),h=i("a-select-option"),r=i("a-select"),x=i("a-typography-text"),C=i("a-tooltip"),S=i("a-badge"),F=i("a-tag"),T=i("a-button"),D=i("a-space"),z=i("a-table");return d(),I("div",Q,[a[8]||(a[8]=s("div",{class:"d-flex justify-content-between align-items-center mb-4"},[s("h1",{class:"mb-0"},"Quản lý luồng phê duyệt mẫu")],-1)),s("div",U,[s("button",{class:"btn btn-primary",onClick:a[0]||(a[0]=(...e)=>n.handleClickAddFlow&&n.handleClickAddFlow(...e))},a[3]||(a[3]=[s("i",{class:"bi bi-plus-circle me-2"},null,-1),u(" Thêm luồng mới ")]))]),s("div",q,[s("div",R,[c(b,{value:n.searchText,"onUpdate:value":a[1]||(a[1]=e=>n.searchText=e),placeholder:"Tìm kiếm theo tên luồng...",onSearch:n.handleSearch,"allow-clear":""},null,8,["value","onSearch"])]),s("div",X,[c(r,{value:n.statusFilter,"onUpdate:value":a[2]||(a[2]=e=>n.statusFilter=e),placeholder:"Lọc theo trạng thái",style:{width:"200px"},onChange:n.handleStatusFilter},{default:o(()=>[c(h,{value:""},{default:o(()=>a[4]||(a[4]=[u("Tất cả")])),_:1}),c(h,{value:"1"},{default:o(()=>a[5]||(a[5]=[u("Hoạt động")])),_:1}),c(h,{value:"0"},{default:o(()=>a[6]||(a[6]=[u("Không hoạt động")])),_:1})]),_:1},8,["value","onChange"])])]),c(z,{columns:n.columns,"data-source":n.filteredFlowsData,loading:n.loading,pagination:n.pagination,onChange:n.handleTableChange,scroll:{x:1e3},"row-key":"id"},{bodyCell:o(({column:e,record:t,index:l})=>[e.key==="name"?(d(),p(x,{key:0,strong:""},{default:o(()=>[u(m(t.name),1)]),_:2},1024)):e.key==="description"?(d(),p(x,{key:1},{default:o(()=>[u(m(t.description||"Không có mô tả"),1)]),_:2},1024)):e.key==="created_by"?(d(),p(C,{key:2},{title:o(()=>[s("span",null,m(t.created_by.position_title||"Không xác định"),1)]),default:o(()=>[s("span",null,m(t.created_by.name||"Không xác định"),1)]),_:2},1024)):e.key==="process"?(d(),p(S,{key:3,count:t.process||0,"number-style":{backgroundColor:"#0099bf"},"show-zero":""},null,8,["count"])):e.key==="created_at"?(d(),I("span",Y,m(n.formatDate(t.created_at)),1)):e.key==="is_active"?(d(),p(F,{key:5,color:t.is_active?"success":"default"},{default:o(()=>[u(m(t.is_active?"Hoạt động":"Không hoạt động"),1)]),_:2},1032,["color"])):e.key==="action"?(d(),p(D,{key:6},{default:o(()=>[c(C,{title:"Xem chi tiết"},{default:o(()=>[c(T,{type:"text",size:"small",onClick:f=>n.viewFlow(t)},{default:o(()=>a[7]||(a[7]=[s("i",{class:"bi bi-eye text-primary"},null,-1)])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):j("",!0)]),_:1},8,["columns","data-source","loading","pagination","onChange"])])}const W=A(J,[["render",G],["__scopeId","data-v-da2a6c49"]]);export{W as default};
